#!/usr/bin/env node
var Ue=Object.defineProperty,Pr=Object.prototype.hasOwnProperty,Cr=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),Tr=e=>Ue(e,"__esModule",{value:!0}),vr=(e,t)=>{if(Tr(e),typeof t=="object"||typeof t=="function")for(let r in t)!Pr.call(e,r)&&r!=="default"&&Ue(e,r,{get:()=>t[r],enumerable:!0});return e},I=e=>e&&e.__esModule?e:vr(Ue({},"default",{value:e,enumerable:!0}),e);var ft=Cr((Ie,ct)=>{!function(e,t){typeof Ie=="object"&&typeof ct!="undefined"?t(Ie):typeof define=="function"&&define.amd?define(["exports"],t):t(e.miniglob={})}(Ie,function(e){"use strict";const{readdirSync:t,statSync:r}=require("fs"),n=(()=>{try{return require("path").sep}catch(i){return"/"}})(),o=n.charCodeAt(0),s=n==":"?/\:+/g:n=="\\"?/\\+/g:/\/+/g,a=process.platform=="win32";class u extends Error{constructor(){super("bad pattern")}}const m=a?i=>{if(i.length<2)return 0;let d=i[0];return i[1]==":"&&("a"<=d&&d<="z"||"A"<=d&&d<="Z")?2:0}:i=>0,f=a?(i,d)=>{const w=d(i);return i==""?[0,"."]:w+1==i.length&&y(i,i.length-1)?[w+1,i]:w==i.length&&i.length==2?[w,i+"."]:(w>=i.length&&(w=i.length-1),[w,i.substr(0,i.length-1)])}:(i,d)=>i==""?[d,"."]:i==n?[d,i]:[d,i.substr(0,i.length-1)];function y(i,d){return i.charCodeAt(d)===o}function E(i,d){i=function(l){let p=l.length-1,b=p;for(;b&&l.charCodeAt(b)===o;)--b;return b!=p&&(l=l.substr(0,b+1)),l.split(s).join(n)}(i);let w=r(i);w.isDirectory()&&function l(p,b,g){for(let T of t(p)){let j=k(p,T),A=B(j),$=b(j,A);($||$===void 0)&&A&&A.isDirectory()&&!g.has(A.ino)&&(g.add(A.ino),l(j,b,g))}}(i,d,new Set([w.ino]))}function v(i){let d=[];if(!W(i))return B(i)?[i]:d;let w=m(i),l=i.length-1;for(;l>=w&&!y(i,l);)l--;let p=i.substr(0,l+1),b=i.substr(l+1);if([w,p]=f(p,w),W(p.substr(w))){if(p==i)throw new u;const g=v(p);for(let T of g)N(T,b,d)}else N(p,b,d);return d}function N(i,d,w){const l=B(i);if(l===null)return;if(!l.isDirectory())return;let p;try{p=t(i)}catch(b){return}p.sort();for(let b of p)h(d,b)&&w.push(k(i,b))}function W(i){for(let d=0;d<i.length;++d)switch(i.charCodeAt(d)){case 42:case 63:case 91:case 123:return!0}return!1}function R(i,d){for(let w=0;w<i.length;++w)if(i.charCodeAt(w)===d)return!0;return!1}function h(i,d){e:for(;i.length>0;){let w=!1,l="";if([w,l,i]=S(i),w&&l=="")return!R(d,o);let[p,b]=C(l,d);if(!b||!(p.length==0||i.length>0)){if(w){for(let g=0;g<d.length&&d.charCodeAt(g)!=o;g++)if([p,b]=C(l,d.substr(g+1)),b){if(i.length==0&&p.length>0)continue;d=p;continue e}}return!1}d=p}return d.length==0}function S(i){let d=!1;for(;i.length>0&&i.charCodeAt(0)==42;)i=i.substr(1),d=!0;let w=!1,l=0;e:for(;l<i.length;l++)switch(i.charCodeAt(l)){case 92:a||l+1<i.length&&l++;break;case 91:w=!0;break;case 93:w=!1;break;case 42:if(!w)break e}return[d,i.substr(0,l),i.substr(l)]}function C(i,d){for(;i.length>0;){if(d.length==0)return["",!1];switch(i.charCodeAt(0)){case 91:{let l=d.codePointAt(0),p=l<=65535?1:2;if(d=d.substr(p),i=i.substr(1),l.toString(16),i.length==0)throw new u;let b=i.charCodeAt(0)==94;b&&(i=i.substr(1));let g=!1,T=0;for(;;){if(i.length>0&&i.charCodeAt(0)==93&&T>0){i=i.substr(1);break}let j,A;if([A,i,j]=F(i),!j)return["",!1];let $=A;if(i.charCodeAt(0)==45&&([$,i,j]=F(i.substr(1)),!j))return["",!1];A<=l&&l<=$&&(g=!0),T++}if(g==b)return["",!1];break}case 63:if(d.charCodeAt(0)==o)return["",!1];let w=d.codePointAt(0)<=65535?1:2;d=d.substr(w),i=i.substr(1);break;case 92:if(!a&&(i=i.substr(1)).length==0)throw new u;default:if(i.charCodeAt(0)!=d.charCodeAt(0))return i[0],d[0],i.charCodeAt(0).toString(16),d.charCodeAt(0).toString(16),["",!1];d=d.substr(1),i=i.substr(1)}}return[d,!0]}function F(i){let d=0,w="",l=i.charCodeAt(0);if(i.length==0||l==45||l==93)throw new u;if(l==92&&!a&&(i=i.substr(1)).length==0)throw new u;let p=(d=i.codePointAt(0))<=65535?1:2;if(d==65535&&p==1)throw new u;if((w=i.substr(p)).length==0)throw new u;return[d,w,!0]}function B(i){try{return r(i)}catch(d){}return null}function k(i,d){return i=="."||i==""?d:i+n+d}e.PatternError=u,e.glob=function(i){if(i.indexOf("**")<0)return v(i);let d=[],w=new Set;return function l(p,b,g,T,j){g>=b.length&&(g=b.length-1);let A=b[g],$=A;function ue(P){return!j.has(P)&&(j.add(P),!0)}function ve(P){let _=P,O=_.lastIndexOf(n);O!=-1&&(_=_.substr(O+1));let H=Math.min(g+1,b.length-1),de=b.slice(H).join("*");de.charCodeAt(0)==o?de=function(Ge){let Ee=0;for(;Ge.charCodeAt(Ee)===o;)Ee++;return Ee!=0?Ge.substr(Ee):Ge}(de):de[0]!="*"&&(de="*"+de),h(de,_)&&T.push(P)}g===0?A.charCodeAt(A.length-1)!=o&&($+="*"):g===b.length-1?A.charCodeAt(0)!=o&&($="*"+$):(A.charCodeAt(0)!=o&&($="*"+$),A.charCodeAt(A.length-1)!=o&&($+="*")),p&&($=$[0]!=n?p+n+$:p+$);let ke=!1;$.charCodeAt($.length-1)===o&&(ke=!0,$=function(P){let _=P.length-1,O=_;for(;P.charCodeAt(O)===o;)O--;return O!=_?P.substr(0,O+1):P}($));let x=v($);for(let P of x){let _=r(P);_.isDirectory()?ue(P)&&E(P,(O,H)=>{ue(O)&&(H.isDirectory()?l(O,b,g+1,T,j):ve(O))}):!ke&&ue(P)&&ve(P)}return T}("",i.split(/\*{2,}/),0,d,w),d},e.match=h,Object.defineProperty(e,"__esModule",{value:!0})})});function pt(e,t,r){}pt.throws=!1;global.assert=pt;function mt(e,t){let r=0;if(t===!0){let n=process.env.TERM||"";r=n&&["xterm","screen","vt100"].some(o=>n.indexOf(o)!=-1)?n.indexOf("256color")!=-1?8:4:2}else t!==!1&&e.isTTY&&(r=e.getColorDepth());return r}function _e(e,t){return gt(mt(e,t),t)}function gt(e,t){const r=s=>`[${s}m`,n=e>0||t?(s,a)=>{const u=r(s),m=r(a);return f=>u+f+m}:s=>a=>a,o=e>=8?(s,a,u)=>{let m="["+a+"m",f="["+u+"m";return y=>m+y+f}:e>0?(s,a,u)=>{let m="["+s+"m",f="["+u+"m";return y=>m+y+f}:(s,a,u)=>m=>m;return{_hint:t,ncolors:e,reset:t||e>0?"e[0m":"",bold:n("1","22"),italic:n("3","23"),underline:n("4","24"),inverse:n("7","27"),white:o("37","38;2;255;255;255","39"),grey:o("90","38;5;244","39"),black:o("30","38;5;16","39"),blue:o("34","38;5;75","39"),cyan:o("36","38;5;87","39"),green:o("32","38;5;84","39"),magenta:o("35","38;5;213","39"),purple:o("35","38;5;141","39"),pink:o("35","38;5;211","39"),red:o("31","38;2;255;110;80","39"),yellow:o("33","38;5;227","39"),lightyellow:o("93","38;5;229","39"),orange:o("33","38;5;215","39"),reconfigure(s,a){const u=mt(s,a);return u!=this.ncolors&&a!=this._hint&&Object.assign(this,gt(u,a)),this}}}const M=_e(process.stdout),se=_e(process.stderr);const te=I(require("fs")),V=I(require("path")),xe=I(require("os")),ht=I(require("perf_hooks")),bt=I(require("util")),L=(e,t,r)=>JSON.stringify(e,r,t),ae=()=>ht.performance.now(),ce=process.platform.startsWith("win"),ge=Symbol("TYPE"),yt=eval("require");function G(e,t){let r={colors:M.ncolors>0};return typeof t=="object"?r={...t}:t!==void 0&&(r.compact=!t),bt.inspect(e,r)}let ze="";function Oe(){return ze||(ze=te.realpathSync.native(xe.tmpdir())),ze}function Fe(e){return e>=59500?(e/6e4).toFixed(0)+"min":e>=999.5?(e/1e3).toFixed(1)+"s":e.toFixed(2)+"ms"}function wt(e){return e>=1024*1e3?(e/(1024*1e3)).toFixed(1)+"MB":e>=1e3?(e/1024).toFixed(1)+"kB":e+"B"}function Be(e){const t=ce?4294967295:te.constants.X_OK,r=new Set((process.env.PATH||"").split(V.delimiter));for(let n of r){let o=V.join(V.resolve(n),e);for(ce&&(o+=".cmd");;){try{let s=te.statSync(o);if(s.isSymbolicLink()){o=te.realpathSync.native(o);continue}else if(s.isFile()&&s.mode&t)return o}catch(s){if(ce&&o.endsWith(".cmd")){o=V.join(V.resolve(n),e)+".exe";continue}}break}}return null}function Ke(e,t){try{return JSON.parse(L)}catch(r){return require("vm").runInNewContext("("+e+")",{},{filename:t,displayErrors:!0})}}function Re(e){const t=te.readFileSync(e,"utf8");try{return Ke(t)}catch(r){throw new Error(`failed to parse ${e}: ${r.message||r}`)}}function xt(e){const t=xe.homedir();return e=="~"?t:e.startsWith("~"+V.sep)?t+e.substr(1):e}function le(e){const t=V.resolve(e),r=xe.homedir();return t.startsWith(r)?"~"+t.substr(r.length):t}const Y=I(require("path")),X=(()=>{const e=process.env._,t=process.argv[1];if(!t)return e||process.argv[0];if(e&&!Y.isAbsolute(e))return e;let r="";if(e){const n=Y.basename(process.execPath);e.endsWith(Y.sep+n)&&(r=n+" ")}if(t.startsWith(process.cwd())){let n=Y.relative(process.cwd(),t);if(!n.startsWith("node_modules"+Y.sep)&&n.indexOf(Y.sep+"node_modules"+Y.sep)==-1)return Y.sep=="/"&&(n="./"+n),n}return r+Y.basename(t)})();function je(e,t){let[r,n]=kr(t.flags.filter(f=>f)),o={},s=!1,a=[],u=0;const m=()=>{a.push(e.splice(u,1)[0]),u--};for(;u<e.length;u++){let f=e[u];if(f=="--"){u++;break}if(f[0]!="-"){m();continue}f=f.replace(/^\-+/,"");let y=f.indexOf("="),E;y!=-1&&(E=f.substr(y+1),f=f.substr(0,y));let v=r.get(f);if(!v){if(f=="h"||f=="help")s=!0,t.help||(console.log(He(n,t.usage,t.trailer)),process.exit(0));else if(t.unknownFlagAsArg){m();continue}else qe([e[u]]);break}let N=!0;if(v.valueName){if(E===void 0)if(E=e[u+1],E!==void 0&&E[0]!="-")u++;else{console.error(`missing value for option -${f} (see ${X} -help)`),process.exit(1);break}try{N=v.valueParser?v.valueParser(E):E}catch(W){console.error(`invalid value for option -${f} (${W.message})`)}}else E!==void 0&&(console.error(`unexpected value provided for flag -${f}`),process.exit(1));o[f]=N;for(let W of v.names){if(W==f)continue;o[W]=N}}return u<e.length&&(a=a.concat(e.slice(u))),s&&t.help&&t.help(n,o,a),[o,a]}function qe(e){console.error(`unknown option${e.length>1?"s":""} ${e.join(", ")} (see ${X} -help)`),process.exit(1)}function kr(e){let t=new Map,r=[];for(let n of e){let o=Er(n);r.push(o);for(let s of o.names){if(t.has(s))throw new Error(`duplicate CLI flag ${L(s)} in definition ${L(n)}`);t.set(s,o)}}return[t,r]}function Er(e){const t=o=>o.replace(/(?:^|[\s,])\-+/g,""),r=o=>o.split(/\s*,\s*/);if(typeof e=="string")return{names:r(t(e))};let n={names:typeof e[0]=="string"?r(t(e[0])):e[0].map(t),description:e[1]||void 0};if(e[2]){let[o,s]=e[2].replace(/^[<>]+|[<>]+$/g,"").split(/:/,2);if(s)switch(s.toLowerCase()){case"string":case"str":s="string";break;case"bool":case"boolean":s="boolean",n.valueParser=a=>(a=a.toLowerCase(),a!="false"&&a!="0"&&a!="no"&&a!="off");break;case"number":case"num":case"float":case"int":s="number",n.valueParser=a=>{let u=Number(a);if(isNaN(u))throw new Error(`${L(a)} is not a number`);return u};break;default:throw new Error(`invalid argument type "${s}"`)}else s="string";n.valueName=o||s,n.valueType=s}return n}function He(e,t,r){let n={prog:X,"0":X};const o=a=>a.replace(/\$(\w+)/g,(u,m)=>{let f=n[m];if(!f)throw new Error(`unknown variable $${m} (to print a dollar sign, use '\\$')`);return f});let s=o(t?typeof t=="function"?t():String(t):e.length>0?"Usage: $prog [options]":"Usage: $prog");if(e.length>0){s+=`
options:
`;let a=0,u=[];for(let m of e){let f="  -"+(m.valueName?m.names.join("=,-")+"="+(m.valueType=="boolean"?"on|off":"<"+m.valueName+">"):m.names.join(", -"));a=Math.max(a,f.length),u.push(f)}for(let m=0;m<e.length;m++){let f=e[m],y=u[m],E=f.description;f.description||(E=f.valueType?"Set ":"Enable "+f.names.reduce((v,N)=>N.length>v.length?N:v,"")),s+=`${y.padEnd(a," ")}  ${E}`,m+1<e.length&&(s+=`
`)}}return r&&(s+=`
`+o(r.replace(/[\n\s]+$/,""))),s}const St=I(require("console"));var re;(function(e){e[e.Error=0]="Error",e[e.Warn=1]="Warn",e[e.Info=2]="Info",e[e.Debug=3]="Debug"})(re||(re={}));let he=console,Ye;const fe=new class{constructor(){this.ERROR=0;this.WARN=1;this.INFO=2;this.DEBUG=3;this.level=2;this.infoOnce=this.info;this.debug=Ir}error(...t){Ae(t),he.error(se.red(`${X}:`),...t)}warn(...t){fe.level>=1&&(Ae(t),he.error(se.magenta(`${X}:`),...t))}info(...t){fe.level>=2&&(Ae(t),he.log(...t))}get colorMode(){return Ye}set colorMode(t){if(Ye===t)return;Ye=t,t===void 0?he=console:he=new St.Console({stdout:process.stdout,stderr:process.stderr,colorMode:t})}};var c=fe;function Ae(e){typeof e[0]=="function"&&(e[0]=e[0]())}function Ir(...e){if(fe.level>=3){let t="";if(Ae(e),e.length==0||e.length==1&&(e[0]===""||e[0]===void 0))return;he.log(M.bold(M.blue(`[DEBUG${t}]`)),...e)}}const Pt=I(require("path"));let _r=__dirname;function Ct(e){let t=null;return function(){return t||(fe.debug(`loading ${e} module`),t=yt(Pt.join(_r,e)),t.initModule(fe.level)),t}}const be=Ct("debug.js"),Je=Ct("watch.js");class pe extends Error{constructor(e){super(e);this.name="UserError"}}function Tt(e,t){return be().bugReportMessage(e,t)}function vt(e,t){return be().printErrorAndExit(e,t)}function kt(e,t){Error.prepareStackTrace=void 0;try{if(be().installSourceMapSupport(),Error.prepareStackTrace!==kt)return Error.prepareStackTrace(e,t)}catch(r){}return e.stack||String(e)}Error.prepareStackTrace=kt;process.on("uncaughtException",vt);process.on("unhandledRejection",(e,t)=>{vt(e||"PromiseRejection","unhandledRejection")});const vn=new Map,kn=Symbol("isMemoized");const Et=!!process.stdout.isTTY,Or=!!process.stderr.isTTY,ne={width:60,height:20,clear(){},banner(e){return e||(e="-"),e.repeat(Math.floor((ne.width-1)/e.length))}};if(Et||Or){const e=Et&&process.stdout||process.stderr,t=()=>{ne.width=e.columns,ne.height=e.rows};e.on("resize",t),t(),ne.clear=()=>{e.write("c")}}const K=I(require("path")),It=I(require("fs")),_t=Symbol("TS_CONFIG_FILE"),Ot=Symbol("TS_CONFIG"),{dirname:Fr,basename:Fn}=K;function Ft(e){let t="",r=process.cwd();const n=ce?"tsc.cmd":"tsc";e&&process.chdir(e);try{t=require.resolve("typescript")}catch(o){}if(e&&process.chdir(r),t){const o=K.sep+"node_modules"+K.sep;let s=t.indexOf(o);if(s!=-1)return K.join(t.substr(0,s+o.length-K.sep.length),".bin",n)}return n}function Xe(e,t){for(let r of Ve(e,t))try{const n=It.statSync(r);if(n.isFile())return r}catch(n){}return null}function*Ve(e,t){e=K.resolve(e);const r=K.parse(e).root;for(t=t?K.resolve(t):r;!(yield K.join(e,"tsconfig.json"),e==t);)if(e=Fr(e),e==r)break}function Ze(e){let t=e.cwd||process.cwd();return e.entryPoints&&e.entryPoints.length>0&&(t=K.resolve(t,K.dirname(e.entryPoints[0]))),t}function ye(e){let t=e[_t];if(t===void 0){if(e.tslint==="off"||e.tslint===!1||e.tsc==="off"||e.tsc===!1)t=null;else{let r=Ze(e);t=Xe(r,e.cwd)}Object.defineProperty(e,_t,{value:t})}return t}function Se(e){let t=e[Ot];if(t===void 0){const r=ye(e);if(r)try{t=Re(r)}catch(n){c.warn(()=>`failed to parse ${r}: ${n.stack||n}`)}t||(t=null),Object.defineProperty(e,Ot,{value:t})}return t}const Pe=I(require("path")),Rn=I(require("fs")),Bt=I(require("child_process")),{dirname:Br,basename:Gn}=Pe,Qe={6031:"IGNORE",6194:"IGNORE",6133:"WARNING",2531:"WARNING",7006:"WARNING",7015:"WARNING",7053:"WARNING"},Rt=0,jt=1,At=2,Rr=3,$t={IGNORE:Rt,INFO:jt,WARNING:At,ERROR:Rr};function Nt(e,t){for(let r of Object.keys(t)){let n=$t[String(t[r]).toUpperCase()];if(n===void 0)throw new pe(`Invalid value for TS rule ${r}: ${L(n)} -- expected value to be one of: `+Object.keys($t).map(L).join(", "));e[r]=n}}function et(e){e||(e={});let t={cancelled:!1,cancel(){}},r=new Promise((n,o)=>{if(e.mode=="off")return n(!0);const s=e.cwd||process.cwd();let a=e.tsconfigFile;if(a===void 0&&(a=Xe(e.srcdir?Pe.resolve(s,e.srcdir):s)),e.mode!="on"&&!a)return n(!0);const u=e.format?e.format.toLowerCase():"",m=u.startsWith("short"),f=u.startsWith("short"),y=u=="short-all";let E=Ft(e.cwd);if(E=="tsc"&&e.mode!="on"&&!(E=Be(E)))return c.warn("tsc not found in node_modules or PATH. However a tsconfig.json file was found in "+Pe.relative(process.cwd(),Br(a))+'. Set tslint options.tslint="off" or pass -no-diag on the command line to disable tsc.'),n(!0);const v={};Nt(v,Qe),e.rules&&Nt(v,e.rules);let N=["--noEmit",e.colors&&"--pretty",e.watch&&"--watch",a&&"--project",a].concat(e.args||[]).filter(x=>x);c.debug(()=>`spawning process ${E} ${L(N,2)}`);const W=Bt.spawn(E,N,{stdio:["inherit","pipe","inherit"],cwd:s}),R=()=>{try{W.kill()}catch(x){}};process.on("exit",R),t.cancel=()=>{W.kill()};const h=x=>x,S=M.orange,C=M.red,F=M.green,B=Buffer.from(" TS"),k=Buffer.from("Found "),i=Buffer.from("c"),d=Buffer.from("tarting compilation"),w=Buffer.from("tarting incremental compilation"),l=[];let p=0,b=!1,g={errors:0,warnings:0,other:0,reset(){this.errors=0,this.warnings=0,this.other=0}},T=!1;function j(){if(!e.quiet||g.errors>=0){e.watch&&console.log(ne.banner("—"));let x=[];g.errors>0?x.push(C("TS: "+ue("$ error","$ errors",g.errors))):x.push(F("TS: OK")),g.warnings>0&&x.push(S(ue("$ warning","$ warnings",g.warnings))),g.other>0&&x.push(ue("$ message","$ messages",g.other)),console.log(x.join("   ")),e.watch&&console.log(ne.banner("—"))}b=g.errors>0,e.onEnd&&e.onEnd(g),g.reset(),T=!0}function A(x){let P=l.slice();if(l.length=0,p==0){let _=0,O=P[_++];for(;O.length==0||O[0]==10&&_<P.length;)O=P[_++];if(O.includes(d)||O.includes(w))return g.reset(),x&&j();if(P.every(H=>H.length<=1))return x&&j()}else{const _=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m|)/g;let O=P.shift().toString("utf8");switch(v[p]){case Rt:return x&&j();case jt:O=O.replace(_,h("info")),m?P=[]:$(P,h),g.other++;break;case At:O=O.replace(_,S("warning")),f?P=[]:$(P,S),g.warnings++;break;default:y&&(P=[]),_.test(O)?g.errors++:g.other++;break}process.stdout.write(O)}P.forEach(_=>process.stdout.write(_)),x&&j()}function $(x,P){for(let _=1;_<x.length;_++){let O=x[_];if(O.includes(126)){let H=O.toString("utf8");H=H.replace(/\x1b\[\d+m(\s*~+)/g,P("$1")),x[_]=H}}}function ue(x,P,_){return(_==1?x:P).replace(/\$/g,_)}jr(W.stdout,(x,P)=>{if(e.clearScreen||(x=ke(x)),P){x.length>0&&l.push(x),l.length>0&&A();return}if(T&&x.length>1&&(T=!1,e.onRestart&&e.onRestart()),x.includes(k)){let _=ve(x.toString("utf8"));if(/^(?:\[[^\]]+\] |[\d\:PAM \-]+|)Found \d+ error/.test(_)){A(!0),p=0;return}else A(!1);p=0}else if(x.includes(B)){const _=x.toString("utf8"),O=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m\x1b\[\d+m|) TS(\d+)\:/.exec(_);let H=O?parseInt(O[1]):0;H>0&&!isNaN(H)&&(l.length>0&&A(),p=H)}l.push(x)}),W.on("close",x=>{process.removeListener("exit",R),n(!b)});function ve(x){return x.replace(/\x1b\[\d+m/g,"")}function ke(x){let P=x.indexOf(i);return P==-1?x:P==0?x.subarray(3):Buffer.concat([x.subarray(0,P),x.subarray(P+3)],x.length-3)}});return r.cancel=()=>(t.cancelled||(t.cancelled=!0,t.cancel()),r),r}const Ar=Buffer.allocUnsafe(0);function jr(e,t){let r=[],n=0;const o=a=>{let u=0;for(;;){let m=a.indexOf(10,u);if(m==-1){if(u<a.length-1){const y=a.subarray(u);r.push(y),n+=y.length}break}m++;let f=a.subarray(u,m);n>0&&(f=Buffer.concat(r.concat(f),n+f.length),r.length=0,n=0),t(f,!1),u=m}},s=()=>{r.length>0?t(Buffer.concat(r,n),!0):t(Ar,!0)};e.on("data",o),e.on("close",s),e.on("end",s)}const $r=I(require("fs"));function Lt(e){return e&&e.read}function Mt(e){return e&&e.write}const tt=Buffer.allocUnsafe(0);function Dt(e){return e&&typeof e=="object"&&e[ge]=="Reader"}function $e(e){return e?new Lr(e):Nr}function rt(e){return e?{[ge]:"Writer",stream:e}:Mr}var qn;const Nr=new class{constructor(){this[qn]="Reader"}_E(){return new Error("stream not readable")}get stream(){throw this._E()}[(qn=ge,Symbol.asyncIterator)](){throw this._E()}read(){return Promise.reject(this._E())}};var Hn,Wt;const Mr=new(Wt=class{constructor(){this[Hn]="Writer"}_E(){return new Error("stream not writable")}get stream(){throw this._E()}},Hn=ge,Wt);var Yn;class Lr{constructor(e){this[Yn]="Reader";this._ended=!1;this.stream=e,e.pause(),e.once("end",()=>{this._ended=!0})}[(Yn=ge,Symbol.asyncIterator)](){return this.stream[Symbol.asyncIterator]()}async read(e,t){const r=this.stream;if(r.pause(),typeof e=="string")t=e,e=Number.MAX_SAFE_INTEGER;else if(e==null||e<0)e=Number.MAX_SAFE_INTEGER;else if(e==0)return t?"":tt;if(r.readable){let a=r.read(this._ended?void 0:e);if(a)return t?a.toString(t):a}if(this._ended)return t?"":tt;const n=[];let o=0;if(r.readable){const a=r.read();a&&(n.push(a),o+=a.length)}for(;o<e&&!this._ended;){await new Promise((u,m)=>{r.once("error",m),r.once("end",u),r.once("readable",u)});let a=r.read(e-o);a||(a=r.read()),a&&(n.push(a),o+=a.length)}const s=Gt(n);return t?s.toString(t):s}}function Gt(e,t){return e.length==0?tt:e.length==1?e[0]:Buffer.concat(e,t)}function nt(){const e=[];let t=0;const r=e.push;return e.push=n=>(t+=n.length,r.call(e,n)),e.buffer=()=>Gt(e,t),e}function ot(e){const t=be().libuv_errors;return t[e]||""}function Ut(e,t,r){const n=setTimeout(()=>{const o=new Error("timeout");o.name="Timeout",r(o)},t);return e.then(o=>(clearTimeout(n),o),o=>{throw clearTimeout(n),o})}const Q=I(require("fs")),zt=I(require("os")),Kt=I(require("child_process")),qt=I(require("stream")),Ht="process not started";class it{constructor(e,...t){this.dir="";this.env={...process.env};this.shell=!1;this.stdin=null;this.stdout=null;this.stderr=null;this.extraFiles=[];this.windowsHide=!0;this.process=null;this.running=!1;this.pid=0;this.exitCode=-1;this._resolve=()=>{};this._reject=()=>{};this._onerror=e=>{c.debug(()=>`${this} error:
${e.stack||e}`),this._reject(e)};this._onexit=(e,t)=>{const r=this;c.debug(()=>`${r} exited status=${e} signal=${t}`),r.running=!1,e===null||t!==null?(assert(typeof t=="string"),r.exitCode=-(zt.constants.signals[t]||1)):r.exitCode=e||0,r._resolve(r.exitCode)};this.command=e,this.args=t,this.promise=Promise.reject(new Error(Ht)),this.promise.catch(r=>{})}start(){return null}run(e){return this.start(),this.wait(e)}output(e,t){this.stdout="pipe",this.stderr||(this.stderr="pipe");const{stdout:r,stderr:n}=this.start(),o=nt(),s=nt();return r.stream.on("data",a=>{o.push(a)}),n&&n.stream.on("data",a=>{s.push(a)}),this.wait(t||0).then(a=>{if(a!=0){let m="";const f=s.buffer();try{m=f.toString("utf8")}catch(y){m=f.toString("ascii")}throw m.length>0&&(m=`. stderr output:
`+m),new Error(`command exited with status ${a}${m}`)}const u=o.buffer();return e?u.toString(e):u})}wait(e,t){return e===void 0||e<=0?this.promise:this._waitTimeout(e,(r,n,o)=>(c.debug(()=>`${this} wait timeout reached; killing process`),r.message="Cmd.wait timeout",this.kill(t).then(()=>o(r))))}signal(e,t){const r=this._checkproc();if(t=="group")try{return process.kill(-r.pid,e),!0}catch(n){}return r.kill(e)}async kill(e="SIGTERM",t=500,r){const n=this._checkproc();return this.signal(e,r||"group")?t<=0?this.promise:this._waitTimeout(t,(o,s)=>(c.debug(()=>`${this} kill timeout reached; sending SIGKILL`),n.kill("SIGKILL"),this.promise.then(s))):n.exitCode||0}toString(){return this.process?`Cmd[${this.pid}]`:"Cmd"}_checkproc(){if(!this.process)throw new Error(Ht);return this.process}_rejectAndKill(e){this._reject(e)}_waitTimeout(e,t){return new Promise((r,n)=>{let o=!1;return this.promise.then(s=>{o||r(s)}),Ut(this.promise,e,s=>{o=!0,t(s,r,n)})})}}it.prototype.start=function(){const t=this;if(t.running)throw new Error("start() called while command is running");t.exitCode=-1,t.promise=new Promise((u,m)=>{t._resolve=u,t._reject=m});let r=null,n=null;t.stdin instanceof Buffer?r="pipe":Dt(t.stdin)?typeof t.stdin.stream.fd=="string"?r=t.stdin.stream:(r="pipe",n=t.stdin.stream):r=t.stdin;const o={stdio:[r||"ignore",t.stdout===process.stdout?1:t.stdout||"ignore",t.stderr===process.stderr?2:t.stderr?t.stderr:"ignore",...t.extraFiles],cwd:t.dir?xt(t.dir):void 0,env:t.env,shell:t.shell,windowsHide:t.windowsHide,detached:!ce},s=Kt.spawn(t.command,t.args,o);if(s.pid===void 0){t.process=null,t.pid=0;const u=Dr(t);throw t._reject(u),u}if(t.running=!0,t.process=s,t.pid=s.pid,s.on("exit",t._onexit),s.on("error",t._reject),c.debug(()=>`${t} started (${G(t.command)})`),s.stdin)if(t.stdin instanceof Buffer){const u=new qt.PassThrough;u.end(t.stdin),u.pipe(s.stdin),s.stdin=null}else n&&(n.pipe(s.stdin),s.stdin=null);if(!s.stdin&&!s.stdout&&!s.stderr&&s.stdio.length<4)return null;const a={stdin:s.stdin?rt(s.stdin):null,stdout:s.stdout?$e(s.stdout):null,stderr:s.stderr?$e(s.stderr):null,extraFiles:s.stdio.slice(3).map(u=>Lt(u)?$e(u):Mt(u)?rt(u):null)};return a};function Dr(e){let t="",r="unspecified error";if(e.shell==!1){try{Q.accessSync(e.dir,Q.constants.R_OK|Q.constants.X_OK);const o=Q.statSync(e.command);(o.mode&Q.constants.S_IFREG)==0?t="EACCES":t="EIO"}catch(o){t=o.code||"ENOENT"}r=ot(t)||r}if(!t){try{Q.accessSync(e.dir,Q.constants.R_OK|Q.constants.X_OK),t="EIO"}catch(o){t=o.code||"ENOENT"}r=ot(t)||r,t&&(r=r+"; cmd.dir="+G(e.dir))}t||(t="UNKNOWN");const n=new Error(`failed to spawn process ${G(e.command)} (${t} ${r})`);return n.code=t,n}const st=I(require("fs")),Yt=I(require("os")),Jt=new Map;function Ce(e,t){const r=o=>st.writeSync(process.stderr.fd,o+`
`);let n=Jt.get(e);if(n)n.listeners.add(t);else{const o=new Set([t]),s=a=>{a=="SIGINT"&&st.writeSync(1,`
`);try{for(let u of o)u(a)}catch(u){r(`error in signal listener: ${u.stack||u}`)}process.exit(-(Yt.constants.signals[a]||1))};process.on(e,s),Jt.set(e,{rootListener:s,listeners:o})}}const Vt=I(require("fs"));let Xt=!1,Zt=!1,Ne=new Set;function Wr(){if(Xt)return;Xt=!0,process.on("beforeExit",t=>at(!1)),process.on("exit",t=>at(!1));const e=t=>at(!1);Ce("SIGINT",e),Ce("SIGHUP",e),Ce("SIGTERM",e),Ce("SIGPIPE",e)}function at(e){if(Zt)return;Zt=!0;const t=r=>Vt.writeSync(process.stderr.fd,r+`
`);try{if(!1)for(let n of Ne);for(let r of Ne)if(r.cmd.running)try{r.cmd.signal("SIGTERM")}catch(n){}Ne.clear()}catch(r){t(`ignoring error in run.atexit: ${r.stack||r}`)}}function Qt(e){if(!e.run)return;c.debug(()=>`run.configure run=${G(e.run)}`);const t=new Gr(e);Ne.add(t);const r=e.onEnd;e.onEnd=async(n,o,s)=>{if(await t.onEndBuild(o),typeof r=="function")return r(n,o,s)},Wr()}function er(){return Promise.all(Array.from(Ne).map(e=>e.cmd.promise)).then(e=>e.reduce((t,r)=>Math.max(t,r),0))}class Gr{constructor(e){this._logOnExit=!0;if(this.config=e,this.cmd=new it(""),this.cmd.stdout="inherit",this.cmd.stderr="inherit",this.cmd.env.ESTRELLA_PATH=__filename,this.cmd.env.ESTRELLA_VERSION="1.2.10",typeof e.run=="string")this.cmd.command=e.run,this.cmd.shell=!0,this.cmdname=e.run;else if(typeof e.run=="boolean"){if(!e.outfile)throw new pe("please set config.outfile=<file> or config.run=<file>");this.cmd.command=process.execPath,this.cmd.args=[e.outfileAbs],this.cmdname=e.outfile}else{if(!e.run||e.run.length==0)throw new pe("config.run is an empty list");this.cmd.command=e.run[0],this.cmd.args=e.run.slice(1),this.cmdname=e.run.join(" "),this.cmdname.length>60&&(this.cmdname=this.cmdname.substr(0,57)+"...")}}async onEndBuild(e){if(e.errors.length>0)return;const t=this.cmd,r=M.pink,n=t.running;t.running&&(this._logOnExit=!1,c.debug(()=>`Stopping ${this.cmdname} [${t.pid}] ...`),await t.kill()),c.debug(()=>`Starting command ${G([t.command,...t.args])}`),t.start(),this.config.watch&&(c.info(()=>r(`${n?"Restarted":"Running"} ${this.cmdname} [${t.pid}]`)),this._logOnExit=!0,t.promise.then(o=>{this._logOnExit&&c.info(()=>r(`${this.cmdname} exited (${o})`))}))}}function tr(e){let t=e;if(!t){c.debug("typescript API requested; attempting to load typescript module");try{const h=require;if(t=h("typescript"),parseFloat(t.versionMajorMinor)<3.5)return c.warn(`typescript ${t.version} is too old; disabling "ts" API.
  You are seeing this message because you are importing the ts API.
  Either install a more recent version of typescript or remove the ts import.`),null;c.debug(()=>`loaded typescript ${t.version} from ${le(h.resolve("typescript"))}`)}catch(h){return c.debug(()=>"failed to load typescript; module unavailable"),null}}const r=new Map;function n(h){const S=L(Object.keys(h).sort().map(k=>[k,h[k]])),C=r.get(S);if(C)return c.debug("ts.getCompilerHost cache hit"),C;h={newLine:t.NewLineKind.LineFeed,...h};const F=t.createCompilerHost(h,!0),B=[F,h];return r.set(S,B),c.debug("ts.getCompilerHost cache miss"),B}async function o(h,S){const C=typeof h=="string"?{"/<source>/a.ts":h}:h,F=Object.keys(C),[B,k]=n(S||{}),i=B.readFile;B.readFile=l=>l in C?C[l]:i(l);const d=t.createProgram(F,k,B);if(typeof h=="string")return d.getSourceFile(F[0]);const w={};for(let l of F)w[l]=d.getSourceFile(l);return w}async function s(h,S){return a(h,S)}function a(h,S){const[C,F]=n(S||{}),B=t.createProgram([h],F,C),k=B.getSourceFile(h);if(!k)throw new Error(`${h}: file not found`);return k}function u(h,S,C){return m(h,[S],C).then(F=>F[0])}async function m(h,S,C){const F=a(h,C);return f(F,S)}function f(h,S){const C=N(h),F=new Map,B=[];for(let k of S||C.keys()){const i=C.get(k);if(!i){B.push(null);continue}B.push(y(h,i,C,F))}return B}function y(h,S,C,F){const B=F.get(S);if(B)return B;const k={heritage:[],name:S.name.escapedText,props:{},computedProps(){const i={};for(let d of k.heritage)Object.assign(i,d.props);return Object.assign(i,k.props),i},lookupProp(i){let d=k.props[i];if(!d){for(let w of k.heritage)if(d=w.lookupProp(i))break}return d}};if(F.set(S,k),S.heritageClauses)for(let i of S.heritageClauses)for(let d of i.types){const w=d.expression;if(t.isIdentifier(w)){const l=C.get(w.escapedText);l&&k.heritage.push(y(h,l,C,F))}}return S.forEachChild(i=>{if(t.isPropertySignature(i)){const d=E(i,h,k);k.props[d.name]=d}}),k}function E(h,S,C){const F=t.getLineAndCharacterOfPosition(S,h.pos);let B=null;const k=h.type,i=v(h.name),d={name:i,type:k,get typestr(){return B===null&&(B=k?R(k,S):"any"),Object.defineProperty(d,"typestr",{enumerable:!0,value:B}),B},srcfile:S.fileName,srcline:F.line,srccol:F.character,parent:C};return d}function v(h){switch(h.kind){case t.SyntaxKind.Identifier:case t.SyntaxKind.PrivateIdentifier:return h.escapedText;case t.SyntaxKind.StringLiteral:case t.SyntaxKind.NumericLiteral:return h.text;case t.SyntaxKind.ComputedPropertyName:return"[computed]";default:return"?"}}function N(h){const S=new Map;return t.forEachChild(h,C=>{C.kind==t.SyntaxKind.InterfaceDeclaration&&S.set(C.name.escapedText,C)}),S}const W=t.createPrinter({removeComments:!0,newLine:t.NewLineKind.LineFeed,omitTrailingSemicolon:!0,noEmitHelpers:!0});function R(h,S){if(!S){let C=h;for(;C.kind!=t.SyntaxKind.SourceFile;)if(C=C.parent,!C)throw new Error("node without SourceFile parent (provide file to ts.fmt)");S=C}return W.printNode(t.EmitHint.Unspecified,h,S)}return{ts:t,getCompilerHost:n,parse:o,parseFile:s,interfaceInfo:u,interfacesInfo:m,interfacesInfoAST:f,fmt:R}}const oe=I(require("fs")),rr=String.fromCharCode,Ur=(e,t)=>e.charCodeAt(t||0);function nr(e,t){if(typeof t=="number")return oe.chmodSync(e,t),t;let r=oe.statSync(e).mode,n=Le(r,t);return r!=n&&oe.chmodSync(e,n),n}function or(e,t){return new Promise((r,n)=>{if(typeof t=="number")return oe.chmod(e,t,o=>{o?n(o):r(t)});oe.stat(e,(o,s)=>{if(o)return n(o);let a=Le(s.mode,t);if(s.mode==a)return r(a);oe.chmod(e,a,u=>{u?n(u):r(a)})})})}function Le(e,t){const r="Expected format: [ugoa]*[+-=][rwx]+",n=(s,a)=>new Error(`${s} in modifier ${L(a)}. ${r}`);let o=[];for(let s of Array.isArray(t)?t:[t])o=o.concat(s.trim().split(/\s*,+\s*/));for(let s of o){let a=[],u=!1,m=0,f=0;for(let E=0;E<s.length;E++){let v=Ur(s,E);if(m==0)switch(v){case 117:case 103:case 111:u||a.push(v);break;case 97:a=[117,103,111],u=!0;break;case 43:case 45:case 61:m=v;break;default:if(m==0)throw n(`Invalid target or operation ${L(rr(v))}`,s);break}else switch(v){case 114:f|=4;break;case 119:f|=2;break;case 120:f|=1;break;default:throw n(`Invalid permission ${L(rr(v))}`,s)}}if(m==0)throw n("Missing operation",s);a.length==0&&(a=[117]),f==0&&(f=4|2|1);let y=0;for(let E of a)switch(E){case 117:y|=f<<6;break;case 103:y|=f<<3;break;case 111:y|=f;break}switch(m){case 43:e|=y;break;case 45:e&=~y;break;case 61:e=y;break}}return e}const q=I(require("fs")),J=I(require("path")),ir=I(require("crypto")),ee=q.promises,zr={};function Me(e){zr[J.resolve(String(e))]=ae()}function U(e,t){return ee.readFile(e,t)}U.editMode=Le;U.chmod=(e,t)=>(Me(e),or(e,t));function Kr(e,t){return ee.readFile(e,t)}U.read=Kr;function qr(e,t){return q.readFileSync(e,t)}U.readSync=qr;U.stat=ee.stat;function Hr(...e){return Promise.all(e.map(t=>ee.stat(t).then(r=>r.mtimeMs).catch(r=>null))).then(t=>t.length==1?t[0]:t)}U.mtime=Hr;U.readall=(...e)=>Promise.all(e.map(t=>ee.readFile(t)));U.readallText=(e,...t)=>Promise.all(t.map(r=>ee.readFile(r,{encoding:e||"utf8"})));U.write=async(e,t,r)=>{Me(e);const n=r&&typeof r=="object"?r:{};try{await ee.writeFile(e,t,r)}catch(o){if(!n.mkdirOff&&o.code=="ENOENT")await U.mkdirs(J.dirname(String(e)),n.mkdirMode),await ee.writeFile(e,t,r);else throw o}if(n.log){let o=J.relative(process.cwd(),String(e));o.startsWith(".."+J.sep)&&(o=le(e)),c.info(M.green(`Wrote ${o}`))}};U.writeSync=(e,t,r)=>{q.writeFileSync(e,t,r)};function Yr(e,t){return new Promise((r,n)=>{const o=q.createReadStream(e),s=ir.createHash("sha1");o.on("error",n),o.on("end",()=>{s.end(),r(t?s.digest(t):s.digest())}),o.pipe(s)})}U.sha1=Yr;U.copy=(e,t,r)=>{let n=q.constants.COPYFILE_FICLONE;return r&&(n|=q.constants.COPYFILE_EXCL),Me(t),ee.copyFile(e,t,n)};U.move=(e,t)=>(Me(t),ee.rename(e,t));U.mkdirs=(e,t)=>ee.mkdir(e,{recursive:!0,mode:t}).then(r=>!!r&&r.length>0);async function sr(e,t,r){if(r||(r={}),!q.promises||!q.promises.opendir)throw new Error("scandir not implemented for nodejs <12.12.0");const n=[],o=new Set,s=r.recursive!==void 0?r.recursive?Infinity:0:r.depth!==void 0?r.depth:Infinity;async function a(m,f,y){if(o.has(m))return;o.add(m);const E=await q.promises.opendir(m);for await(const v of E){let N=v.name;v.isDirectory()?s<y&&await a(J.join(m,N),J.join(f,N),y+1):(v.isFile()||v.isSymbolicLink())&&(t&&t.test(N)&&n.push(J.join(f,N)))}}const u=Array.isArray(e)?e:[e];return Promise.all(u.map(m=>a(J.resolve(m),".",0))).then(()=>n.sort())}const ar={version:"0.7.7",BuildOptions:new Set(["sourcemap","format","globalName","target","strict","minify","minifyWhitespace","minifyIdentifiers","minifySyntax","jsxFactory","jsxFragment","define","pure","color","logLevel","errorLimit","bundle","splitting","outfile","metafile","outdir","platform","external","loader","resolveExtensions","mainFields","write","tsconfig","outExtension","entryPoints","stdin"])},lr={BuildConfig:new Set(["entry","debug","watch","cwd","quiet","clear","tslint","onStart","onEnd","outfileMode","run","tsc","tsrules","title"])};const ur=I(require("crypto"));function De(e,t){const r=ur.createHash("sha1").update(e);return t?r.digest(t):r.digest()}const Te=I(require("path"));function dr(e,t){let r=e.cwd||"?",n=!1,o=!1,s=!1,a="";function u(y){const E=[y.cwd,y.outfile||"",...Array.isArray(y.entryPoints)?y.entryPoints:y.entryPoints?[y.entryPoints]:[]].join(Te.delimiter);return Jr(De(Buffer.from(E,"utf8")))}const m=e.cwd?Te.resolve(e.cwd):t,f=Object.create({get outfileAbs(){return a},setOutfile(y){f.outfile=y,a=y&&y!="-"?Te.resolve(f.cwd,y):""},get projectID(){return r},updateProjectID(){return r=u(f),r},get buildIsCancelled(){return n},set buildIsCancelled(y){n=y},get outfileIsTemporary(){return o},set outfileIsTemporary(y){o=y},get metafileIsTemporary(){return s},set metafileIsTemporary(y){s=y}});return Object.assign(f,e),f.cwd=m,f.setOutfile(e.outfile||""),f}function Jr(e){let t="";for(let r=0;r<e.length;r+=4)t+=e.readUInt32LE(r).toString(36);return t}const cr=I(require("esbuild")),ie=I(require("fs")),Io=I(require("os")),z=I(require("path")),me=I(ft()),{dirname:lt,basename:fr}=z,we={usage:"usage: $0 [options]",flags:[["-w, watch","Watch source files for changes and rebuild."],["-g, debug","Do not optimize and define DEBUG=true."],["-r, run","Run the output file after a successful build."],["-sourcemap","Generate sourcemap."],["-inline-sourcemap","Generate inline sourcemap."],["-no-color","Disable use of colors."],["-no-clear","Disable clearing of the screen, regardless of TTY status."],["-no-diag","Disable TypeScript diagnostics."],["-color","Color terminal output, regardless of TTY status."],["-diag","Only run TypeScript diagnostics (no esbuild.)"],["-quiet","Only log warnings and errors but nothing else."],["-estrella-version","Print version of estrella and exit 0."],["-estrella-debug","Enable debug logging of estrella itself."]]},Vr={usage:"usage: $0 [options] <srcfile> ...",flags:we.flags.concat([["-o, outfile","Write output to <file> instead of stdout.","<file>"],["-bundle","Include all dependencies."],["-minify","Simplify and compress generated code."],["-outdir","Write output to <dir> instead of stdout.","<dir>"],["-esbuild","Pass arbitrary JSON to esbuild's build function.","<json>"]]),trailer:`
Example of using estrella without a build script:
  $0 -o out/app.js main.ts
    This compile main.ts and writes the output to out/app.js

Example of using estrella with a build script:
  1. Create a file called build.js with the following contents:
       #!/usr/bin/env node
       const { build } = require("estrella")
       build({
         entry: "main.ts",
         outfile: "out/main.js",
       })
  2. Make that file executable and run it:
       chmod +x build.js
       ./build.js
  You can now customize your build behavior by changing build.js.
  Try ./build.js -help

See https://github.com/rsms/estrella#readme for documentation.
  `};let ut=Promise.resolve(),D={},Z=[];const We=Symbol("IS_MAIN_CALL");let pr=!1;function mr(e){if(!pr){pr=!0;let t=e||1;process.exitCode=t,process.on("exit",r=>{process.exit(r||t)})}}function Xr(e){if(c.debug(()=>`input config ${G(e)}`),e.entryPoints||(e.entryPoints=[]),e.entry&&(Array.isArray(e.entry)?e.entryPoints=e.entryPoints.concat(e.entry):e.entryPoints.push(e.entry)),delete e.entry,e.entryPoints.length==0&&(c.debug(()=>"missing entryPoints; attempting inference"),e.entryPoints=gr(e),e.entryPoints.length==0)){let t=Se(e)?" (could not guess from tsconfig.json)":"";throw new pe(`config.entryPoints is empty or not set${t}`)}e.sourcemap?e.sourcemap!="inline"&&e.sourcemap!="external"&&(e.sourcemap=!0):e.sourcemap=!1,e.updateProjectID(),c.debug(()=>`effective config for project#${e.projectID}: ${G(e)}`)}function Zr(e,t){const r=ae(),n=JSON.parse(ie.readFileSync(e));for(let o in t){const s=t[o];s===void 0?delete n[o]:n[o]=s}ie.writeFileSync(e,JSON.stringify(n)),c.debug(()=>`patched source map ${e} with overrides ${G(t)} (${Fe(ae()-r)})`)}function gr(e){const t=Se(e);if(t){if(c.debug(()=>`tsconfig file found at ${ye(e)}`),t.files)return t.files;if(t.include){let r=[];for(let n of t.include)c.debug(`guessing entry points: glob.glob(${n}) =>`,me.glob(n)),r=r.concat(me.glob(n));if(t.exclude)for(let n of t.exclude)r=r.filter(o=>!me.match(n,o));return r.slice(0,1)}}return[]}function Qr(e){let t={},r={};const n={name:"globalName"};for(let o of Object.keys(e)){if(lr.BuildConfig.has(o))continue;ar.BuildOptions.has(o)||(r[o]=e[o]),o=n[o]||o,t[o]=e[o]}return Object.keys(r).length>0&&c.info(`Notice: Potentially invalid esbuild.BuildOption(s): ${G(r)}
`+Tt("guess",L(Object.keys(r)))),t}let hr=new Set;function en(...e){if(c.level>=c.INFO){const t=e.join(" ");hr.has(t)||(hr.add(t),c.info(...e))}}function br(e){e=dr(e||{},e[We]?process.cwd():process.mainModule&&lt(process.mainModule.filename)||__dirname);const t={resolve(){},reject(){}},r=[];function n(u){e.isCancelled?u():r.push(u)}function o(u){if(!e.isCancelled){c.debug("build cancelled",{reason:u}),e.isCancelled=!0;for(let m of r)m&&m();r.length=0,u?t.reject(u):t.resolve()}}let s={addCancelCallback:n,buildCounter:0,rebuild(){return c.warn("rebuild() called before initial build completed. Ignoring"),Promise.resolve(!0)}};const a=ut.then(()=>new Promise((u,m)=>{if(e.isCancelled)return c.debug("build cancelled immediately"),!1;t.resolve=u,t.reject=m,tn(e,s).then(u).catch(m)}));return a.rebuild=()=>s.rebuild(),Object.defineProperty(a,"buildCounter",{get(){return s.buildCounter}}),a.cancel=o,a}async function tn(e,t){const r=We in e;delete e[We];let n=D,o=Z;if(e.run===void 0&&(e.run=n.run),!r)Xr(e);else{if(o.length==0){const l=gr(e);c.debug(()=>`no input files provided; best guess: ${G(l)}`),l.length==0&&(c.error(`missing <srcfile> argument (see ${X} -help)`),process.exit(1)),o.splice(o.length-1,0,...l);const p=Se(e);!n.outfile&&!n.outdir&&p&&(n.outfile=p.outFile,n.outfile||(n.outdir=p.outDir)),o.length==0&&(c.error(`missing <srcfile> argument (see ${X} -help)`),process.exit(1))}if(n.outfile=="-"||!n.outfile&&!n.outdir){e.setOutfile("-");const l=e.updateProjectID();n.outfile=z.join(Oe(),`esbuild.${l}.out.js`),e.outfileIsTemporary=!0}if(e.setOutfile(n.outfile||void 0),e.entryPoints=o,e.outdir=n.outdir||void 0,e.bundle=n.bundle||void 0,e.minify=n.minify||void 0,n.esbuild){const l=Ke(n.esbuild,"-esbuild");if(!l||typeof l!="object")return c.error(`-esbuild needs a JS object, for example '{key:"value"}'. Got ${typeof l}.`),!1;c.debug(()=>`applying custom esbuild config ${G(l)}`);for(let p in l)e[p]=l[p]}}const s=e.debug=n.debug=!!(n.debug||e.debug),a=e.quiet=n.quiet=!!(n.quiet||e.quiet);n.watch=!!(n.watch||e.watch),(!e.watch||typeof e.watch!="object")&&(e.watch=n.watch),e.color!==void 0&&(c.colorMode=e.color,M.reconfigure(process.stdout,e.color),se.reconfigure(process.stderr,e.color)),a&&(c.level=c.WARN),e.sourcemap=n["inline-sourcemap"]?"inline":n.sourcemap?!0:e.sourcemap,e.clear=n["no-clear"]?!1:e.clear===void 0?!!process.stdout.isTTY:e.clear,c.debug(()=>`project directory ${G(e.cwd)} (config.cwd)`),e.title||(e.title=e.name||le(e.cwd));let u=n.diag===!0?"on":n.diag===!1?"off":"auto";if(u!=="off"){e.tsc!==void 0&&(c.info("the 'tsc' property is deprecated. Please rename to 'tslint'."),e.tslint===void 0&&(e.tslint=e.tsc)),e.tslint&&e.tslint!=="auto"&&(u=e.tslint);const l=u==="auto"||typeof u=="object"&&(e.tslint.mode==="auto"||!e.tslint.mode);l?ye(e)||(c.debug(()=>{const p=Ze(e),b=Array.from(Ve(p,e.cwd));return`skipping tslint in auto mode since no tsconfig.json file was found in project.
Tried the following filenames:${b.map(g=>`
  ${le(g)}`)}`}),u="off"):e.tslint!==void 0&&e.tslint!=="auto"&&(u=e.tslint)}e.run&&Qt(e);let m=0;function f(){ne.clear(),m=ae()}let y=!1;const E=e.onEnd;let v=E?async(l,p)=>{y=!0;let b;try{const T=E(e,l,t);b=T instanceof Promise?await T:T}catch(T){throw c.debug(()=>`error in onEnd handler: ${T.stack||T}`),T}finally{y=!1}const g=b===void 0?p:!!b;return g}:(l,p)=>p;function N(l){let p=v;v=async(b,g)=>{const T=await l(b,g);return T!==void 0&&(g=T),p(b,g)}}e.outfileMode&&e.outfile&&N(async(l,p)=>{if(l.errors.length==0)try{nr(e.outfileAbs,e.outfileMode)}catch(b){c.error("configuration error: outfileMode: "+b.message),mr(1)}}),e.outfileIsTemporary&&!e.run&&N(async(l,p)=>{if(l.errors.length==0)return new Promise((b,g)=>{const T=ie.createReadStream(e.outfileAbs);T.on("end",()=>b(p)),T.on("error",g),T.pipe(process.stdout)})}),e.watch&&N(async(l,p)=>{en("Watching files for changes...")});let W={DEBUG:s,...e.define||{}};for(let l in W)W[l]=L(W[l]);const R={minify:!s,sourcemap:e.sourcemap,color:se.ncolors>0,...Qr(e),define:W};if(e.watch){const l=e.projectID;if(!R.outfile&&!R.outdir||R.write===!1)R.outfile=z.join(Oe(),`esbuild.${l}.out.js`),R.metafile=z.join(Oe(),`esbuild.${l}.meta.json`),e.outfileIsTemporary=!0,e.metafileIsTemporary=!0,delete R.write;else if(!R.metafile){const p=R.outdir||z.dirname(R.outfile);R.metafile=z.resolve(e.cwd,p,`.esbuild.${l}.meta.json`),e.metafileIsTemporary=!0}}R.metafile&&c.debug(()=>`writing esbuild meta to ${R.metafile}`),t.rebuild=()=>F([]).then(l=>(y&&c.warn("waiting for rebuild() inside onEnd handler may cause a deadlock"),l));let h={warnings:[],errors:[]};function S(l,{warnings:p}){yr(p||[]);const b=Fe(ae()-l);if(!e.outfile)c.info(M.green(e.outdir?`Wrote to dir ${e.outdir} (${b})`:`Finished (write=false, ${b})`));else{let g=e.outfile;if(e.sourcemap&&e.sourcemap!="inline"){const j=z.extname(e.outfile),A=z.join(z.dirname(e.outfile),z.basename(e.outfile,j));g=`${A}.{${j.substr(1)},${j.substr(1)}.map}`,Zr(e.outfileAbs+".map",{sourcesContent:void 0,sourceRoot:z.relative(z.dirname(e.outfile),e.cwd)})}let T=0;try{T=ie.statSync(e.outfileAbs).size}catch(j){}e.outfileIsTemporary||c.info(M.green(`Wrote ${g}`)+` (${wt(T)}, ${b})`)}return h={warnings:p,errors:[]},v(h,!0)}function C(l,p,b){let g=p.warnings||[],T=p.errors||[],j=b&&b.showStackTrace;return T.length==0&&T.push({text:String(j&&p.stack?p.stack:p),location:null}),yr(g),h={warnings:g,errors:T},v(h,!1)}async function F(l){if(e.watch&&e.clear&&f(),e.onStart)try{const g=e.onStart(e,l,t);g instanceof Promise&&await g}catch(g){throw c.debug(()=>`error in onStart handler: ${g.stack||g}`),g}if(e.isCancelled)return;c.debug(()=>`invoking esbuild.build() in ${process.cwd()} with options: ${G(R)}`);const p=process.cwd();process.chdir(e.cwd);const b=cr.build(R);return process.chdir(p),b.then(S.bind(null,ae()),C.bind(null,ae()))}const B=n.diag?null:F([]),[k,i]=u!=="off"?rn(u,n,e):[null,!1];k&&!i&&(k.catch(l=>(c.error(l.stack||String(l)),!1)),t.addCancelCallback(()=>{k.cancel()}),D.diag&&e.watch&&e.clear&&ne.clear());let d=!0;if(B&&(c.debug("awaiting esbuild"),d=await B,e.isCancelled))return!1;if(e.watch){let l={};function w(){try{l=Re(R.metafile),e.metafileIsTemporary&&(c.debug(()=>`removing temporary esbuild metafile ${R.metafile}`),ie.unlink(R.metafile,()=>{}))}catch(p){if(h.errors.length==0)throw p}return l}return await Je().watchFiles(e,w,t,p=>{const b=p.map(T=>z.relative(e.cwd,T)),g=p.length;return c.info(`${g} ${g>1?"files":"file"} changed: ${b.join(", ")}`),F(p)}),c.debug("fswatch ended"),!0}if(k){let l=null;d?(c.debug("awaiting eslint"),!i&&!n.diag&&(l=setTimeout(()=>c.info("Waiting for TypeScript... (^C to skip)"),1e3)),d=await k.catch(()=>!1)):(c.debug("cancelling eslint since esbuild reported an error"),k.cancel()),clearTimeout(l)}if(!e.isCancelled&&!d&&mr(),d){const l=await er();process.exitCode=l}return d}const wr=new Map;function rn(e,t,r){let n=e,o={};if(e&&typeof e=="object"&&(n=void 0,o=e,o.mode=="off"))return c.debug(()=>'tslint disabled by tslint config {mode:"off"}'),[null,!1];r.tsrules&&r.tsrules.length&&(c.info("The 'tsrules' property is deprecated. Please use 'tslint.rules' instead"),o.rules={...r.tsrules,...o.rules});const s=t.diag&&r.watch&&r.clear,a=ye(r),u=`${a||r.cwd}`,m=wr.get(u);if(m)return c.debug(()=>"tslint sharing process (no new process created)"),[m,!0];const f={colors:M.ncolors>0,quiet:r.quiet,mode:n,...o,watch:r.watch,cwd:r.cwd,clearScreen:s,srcdir:lt(r.entryPoints[0]),tsconfigFile:a,onRestart(){c.debug("tsc restarting")}};c.debug(()=>`starting tslint with options ${G(f)}`);const y=et(f);return wr.set(u,y),[y,!1]}function yr(e){e.length>0&&c.warn("[warn] "+e.map(t=>t.text).join(`
`))}function nn(){return br({[We]:1}).catch(e=>{console.error(se.red(X+": "+(e?e.stack||e:"error")));const t=process.exitCode||0;process.exit(t>0?t:1)}).then(e=>{const t=process.exitCode||0;process.exit(e||t>0?t:1)})}function xr(){D["no-color"]&&(D.color=!1),D["no-diag"]&&(D.diag=!1),c.colorMode=D.color,M.reconfigure(process.stdout,D.color),se.reconfigure(process.stderr,D.color),D.color!==void 0,D["estrella-version"]&&(console.log("estrella 1.2.10"),process.exit(0)),D["estrella-debug"]&&(c.level=c.DEBUG),D.diag&&D.run&&(c.info("Disabling -run since -diag is set"),D.run=void 0),c.debug(()=>`Parsed initial CLI arguments: ${G({options:D,args:Z},2)}`)}module.id=="."||process.mainModule&&fr(process.mainModule.filename||"")=="estrella.js"?([D,Z]=je(process.argv.slice(2),Vr),xr(),nn()):([D,Z]=je(process.argv.slice(2),{...we,unknownFlagAsArg:!0,help(e,t,r){ut=new Promise(n=>{process.nextTick(()=>{console.log(He(e,we.usage,we.trailer)),process.exit(0),n()})})}}),xr(),Z.length>0&&ut.then(()=>{Z.length>0&&qe(Z)}),D.parse=(...e)=>{c.debug(()=>`Parsing custom CLI arguments ${L(Z.join)} via cliopts.parse(`+G(e)+")");const t=je(Z,{...we,flags:we.flags.concat(e)});return c.debug(()=>"Parsed extra CLI arguments: "+L({options:t[0],args:t[1]},2)),Z.splice(0,Z.length),t});function Sr(e,t,r){return Je().watch(e,t,r)}function on(e,t,r,n){return c.info(()=>"estrella.watchdir is deprecated. Please use estrella.watch instead"),n===void 0&&(r===void 0?(n=t,r={}):(n=r,r={...r,filter:t},r.recursive!==void 0&&(r.recursive||(r.depth=0),delete r.recursive))),Sr(e,r,n)}let dt;module.exports={version:"1.2.10",prog:X,cliopts:D,cliargs:Z,dirname:lt,basename:fr,watch:Sr,watchdir:on,scandir:sr,tslint:et,defaultTSRules:Qe,termStyle:_e,stdoutStyle:M,stderrStyle:se,chmod:U.chmod,editFileMode:U.editMode,fmtDuration:Fe,tildePath:le,findInPATH:Be,tsconfig:Se,tsconfigFile:ye,glob:me.glob,globmatch:me.match,file:U,sha1:De,log:c,get ts(){return dt===void 0&&(dt=tr()),dt},build:br};
//# sourceMappingURL=estrella.js.map
