#!/usr/bin/env node
var Nr=Object.create,Ie=Object.defineProperty,Wr=Object.getPrototypeOf,Lr=Object.prototype.hasOwnProperty,Dr=Object.getOwnPropertyNames,Ur=Object.getOwnPropertyDescriptor;var mt=e=>Ie(e,"__esModule",{value:!0});var gt=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),Gr=(e,t)=>{for(var r in t)Ie(e,r,{get:t[r],enumerable:!0})},qr=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Dr(t))!Lr.call(e,n)&&n!=="default"&&Ie(e,n,{get:()=>t[n],enumerable:!(r=Ur(t,n))||r.enumerable});return e},P=e=>qr(mt(Ie(e!=null?Nr(Wr(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var It=gt(ht=>{var bt=Object.defineProperty,Yr=e=>bt(e,"__esModule",{value:!0}),Hr=(e,t)=>{Yr(e);for(var r in t)bt(e,r,{get:t[r],enumerable:!0})};Hr(ht,{PatternError:()=>ae,glob:()=>Kr,match:()=>qe});var{readdirSync:yt,statSync:Ye}=require("fs"),se=(()=>{try{return require("path").sep}catch(e){return"/"}})(),U=se.charCodeAt(0),zr=se==":"?/\:+/g:se=="\\"?/\\+/g:/\/+/g,Pe=process.platform=="win32",ae=class extends Error{constructor(){super("bad pattern")}};function Kr(e){if(e.indexOf("**")<0)return He(e);let t=[],r=new Set;return xt("",e.split(/\*{2,}/),0,t,r),t}function H(){}var Jr=Pe?e=>{if(e.length<2)return 0;let t=e[0];return e[1]==":"&&("a"<=t&&t<="z"||"A"<=t&&t<="Z")?2:0}:e=>0,Vr=Pe?(e,t)=>{let r=t(e);return e==""?[0,"."]:r+1==e.length&&wt(e,e.length-1)?[r+1,e]:r==e.length&&e.length==2?[r,e+"."]:(r>=e.length&&(r=e.length-1),[r,e.substr(0,e.length-1)])}:(e,t)=>e==""?[t,"."]:e==se?[t,e]:[t,e.substr(0,e.length-1)];function wt(e,t){return e.charCodeAt(t)===U}function Xr(e){let t=e.length-1,r=t;for(;e.charCodeAt(r)===U;)r--;return r!=t?e.substr(0,r+1):e}function Zr(e){let t=0,r=t;for(;e.charCodeAt(r)===U;)r++;return r!=t?e.substr(r):e}function xt(e,t,r,n,o){r>=t.length&&(r=t.length-1);let i=t[r],s=i;r===0?i.charCodeAt(i.length-1)!=U&&(s+="*"):r===t.length-1?i.charCodeAt(0)!=U&&(s="*"+s):(i.charCodeAt(0)!=U&&(s="*"+s),i.charCodeAt(i.length-1)!=U&&(s+="*"));function l(f){return o.has(f)?!1:(o.add(f),!0)}function u(f){let w=f,_=w.lastIndexOf(se);_!=-1&&(w=w.substr(_+1));let j=Math.min(r+1,t.length-1),M=t.slice(j).join("*");M.charCodeAt(0)==U?M=Zr(M):M[0]!="*"&&(M="*"+M),qe(M,w)&&n.push(f)}e&&(s[0]!=se?s=e+se+s:s=e+s);let c=!1;s.charCodeAt(s.length-1)===U&&(c=!0,s=Xr(s));let g=He(s);for(let f of g)Ye(f).isDirectory()?l(f)&&Qr(f,(_,j)=>{l(_)&&(j.isDirectory()?xt(_,t,r+1,n,o):u(_))}):!c&&l(f)&&u(f);return n}function Qr(e,t){e=en(e);let r=Ye(e);r.isDirectory()&&St(e,t,new Set([r.ino]))}function St(e,t,r){for(let n of yt(e)){let o=Pt(e,n),i=Ke(o),s=t(o,i);(s||s===void 0)&&i&&i.isDirectory()&&!r.has(i.ino)&&(r.add(i.ino),St(o,t,r))}}function He(e){let t=[];if(!_t(e))return Ke(e)?[e]:t;let r=Jr(e),n=e.length-1;for(;n>=r&&!wt(e,n);)n--;let o=e.substr(0,n+1),i=e.substr(n+1);if([r,o]=Vr(o,r),!_t(o.substr(r)))Ct(o,i,t);else{if(o==e)throw new ae;let s=He(o);for(let l of s)Ct(l,i,t)}return t}function Ct(e,t,r){let n=Ke(e);if(n===null||!n.isDirectory())return;let o;try{o=yt(e)}catch(i){return}o.sort();for(let i of o)qe(t,i)&&r.push(Pt(e,i))}function _t(e){for(let t=0;t<e.length;++t)switch(e.charCodeAt(t)){case 42:case 63:case 91:case 123:return!0}return!1}function tn(e,t){for(let r=0;r<e.length;++r)if(e.charCodeAt(r)===t)return!0;return!1}function qe(e,t){e:for(;e.length>0;){let r=!1,n="",o=e;if([r,n,e]=rn(e),H("scanChunk(%o) => %o",o,[r,n,e]),r&&n=="")return H("ret"),!tn(t,U);let[i,s]=Tt(n,t);if(H("matchChunk(%o, %o) => %o",n,t,[i,s]),s&&(i.length==0||e.length>0)){t=i;continue}if(r){for(let l=0;l<t.length&&t.charCodeAt(l)!=U;l++)if([i,s]=Tt(n,t.substr(l+1)),s){if(e.length==0&&i.length>0)continue;t=i;continue e}}return!1}return t.length==0}function rn(e){let t=!1;for(;e.length>0&&e.charCodeAt(0)==42;)e=e.substr(1),t=!0;let r=!1,n=0>>0;e:for(;n<e.length;n++)switch(e.charCodeAt(n)){case 92:Pe||n+1<e.length&&n++;break;case 91:r=!0;break;case 93:r=!1;break;case 42:if(!r)break e;break}return[t,e.substr(0,n),e.substr(n)]}function Tt(e,t){for(H("enter matchChunk(%o, %o)",e,t);e.length>0;){if(t.length==0)return["",!1];switch(e.charCodeAt(0)){case 91:{let o=t.codePointAt(0),i=o<=65535?1:2;if(t=t.substr(i),e=e.substr(1),H('"[" s reduced to %o, chunk reduced to %o, r = 0x%s',t,e,o.toString(16)),e.length==0)throw new ae;let s=e.charCodeAt(0)==94;s&&(H('"[" negation from "^"'),e=e.substr(1));let l=!1,u=0;for(;;){if(e.length>0&&e.charCodeAt(0)==93&&u>0){H('"[" loop break at A'),e=e.substr(1);break}let c,g,f=e;if([g,e,c]=Et(e),H('"[" loop getEsc(%o) => %o',f,[g,e,c]),!c)return H('"[" loop return at B from failed getEsc'),["",!1];let w=g;if(e.charCodeAt(0)==45&&([w,e,c]=Et(e.substr(1)),!c))return["",!1];g<=o&&o<=w&&(l=!0),u++}if(l==s)return["",!1];break}case 63:if(t.charCodeAt(0)==U)return["",!1];let r=t.codePointAt(0),n=r<=65535?1:2;t=t.substr(n),e=e.substr(1);break;case 92:if(!Pe&&(H('"\\" consume'),e=e.substr(1),e.length==0))throw new ae;default:if(e.charCodeAt(0)!=t.charCodeAt(0))return H("[def] chunk[0] != s[0] (%o != %o) (0x%s != 0x%s) -- return",e[0],t[0],e.charCodeAt(0).toString(16),t.charCodeAt(0).toString(16)),["",!1];t=t.substr(1),e=e.substr(1),H("[def] s reduced to %o, chunk reduced to %o",t,e);break}}return[t,!0]}function Et(e){let t=0,r="",n=e.charCodeAt(0);if(e.length==0||n==45||n==93)throw new ae;if(n==92&&!Pe&&(e=e.substr(1),e.length==0))throw new ae;t=e.codePointAt(0);let o=t<=65535?1:2;if(t==65535&&o==1)throw new ae;if(r=e.substr(o),r.length==0)throw new ae;return[t,r,!0]}function Ke(e){try{return Ye(e)}catch(t){}return null}function Pt(e,t){return e=="."||e==""?t:e+se+t}function en(e){let t=e.length-1,r=t;for(;r&&e.charCodeAt(r)===U;)--r;return r!=t&&(e=e.substr(0,r+1)),e.split(zr).join(se)}});var G=gt(exports=>{mt(exports);Gr(exports,{TYPE:()=>TYPE,clock:()=>clock,expandTildePath:()=>expandTildePath,findInPATH:()=>findInPATH,fmtByteSize:()=>fmtByteSize,fmtDuration:()=>fmtDuration,getModulePackageJSON:()=>getModulePackageJSON,isWindows:()=>isWindows,json:()=>json,jsonparse:()=>jsonparse,jsonparseFile:()=>jsonparseFile,repr:()=>repr,resolveModulePackageFile:()=>resolveModulePackageFile,runtimeRequire:()=>runtimeRequire,tildePath:()=>tildePath,tmpdir:()=>tmpdir});var X=P(require("fs")),W=P(require("path")),Ce=P(require("os")),Bt=P(require("perf_hooks")),vt=P(require("util")),json=(e,t,r)=>JSON.stringify(e,r,t),clock=()=>Bt.performance.now(),isWindows=process.platform.startsWith("win"),TYPE=Symbol("TYPE"),runtimeRequire=eval("require");function repr(e,t){let r={colors:$.ncolors>0};return typeof t=="object"?r={...t}:t!==void 0&&(r.compact=!t),(0,vt.inspect)(e,r)}function resolveModulePackageFile(e){let t=runtimeRequire.resolve(e),r=W.dirname(W.resolve(t)),n=W.sep;for(;r!=n;){let o=W.join(r,"package.json");if(X.existsSync(o))return o;r=W.dirname(r)}throw new Error(`package.json not found for module ${e}`)}function getModulePackageJSON(e){let t=resolveModulePackageFile(e);return jsonparseFile(t)}var _tmpdir="";function tmpdir(){return _tmpdir||(_tmpdir=X.realpathSync.native(Ce.tmpdir())),_tmpdir}function fmtDuration(e){return e>=59500?(e/6e4).toFixed(0)+"min":e>=999.5?(e/1e3).toFixed(1)+"s":e.toFixed(2)+"ms"}function fmtByteSize(e){return e>=1024*1e3?(e/(1024*1e3)).toFixed(1)+"MB":e>=1e3?(e/1024).toFixed(1)+"kB":e+"B"}function findInPATH(e){let t=isWindows?4294967295:X.constants.X_OK,r=new Set((process.env.PATH||"").split(W.delimiter));for(let n of r){let o=W.join(W.resolve(n),e);for(isWindows&&(o+=".cmd");;){try{let i=X.statSync(o);if(i.isSymbolicLink()){o=X.realpathSync.native(o);continue}else if(i.isFile()&&i.mode&t)return o}catch(i){if(isWindows&&o.endsWith(".cmd")){o=W.join(W.resolve(n),e)+".exe";continue}}break}}return null}function jsonparse(e,t){try{return JSON.parse(json)}catch(r){return require("vm").runInNewContext("("+e+")",{},{filename:t,displayErrors:!0})}}function jsonparseFile(e){let t=X.readFileSync(e,"utf8");try{return jsonparse(t)}catch(r){throw new Error(`failed to parse ${e}: ${r.message||r}`)}}function expandTildePath(e){let t=Ce.homedir();return e=="~"?t:e.startsWith("~"+W.sep)?t+e.substr(1):e}function tildePath(e){let t=W.resolve(e),r=Ce.homedir();return t.startsWith(r)?"~"+t.substr(r.length):t}});var Er=P(require("esbuild")),ne=P(require("fs")),Xo=P(require("os")),J=P(require("path")),fe=P(It());function kt(e,t,r){}kt.throws=!1;global.assert=kt;var $t=P(require("path"));function Ft(e,t){let r=0;if(t===!0){let n=process.env.TERM||"";r=n&&["xterm","screen","vt100"].some(o=>n.indexOf(o)!=-1)?n.indexOf("256color")!=-1?8:4:2}else t!==!1&&e.isTTY&&(r=e.getColorDepth());return r}function ke(e,t){return Ot(Ft(e,t),t)}function Ot(e,t){let r=i=>`[${i}m`,n=e>0||t?(i,s)=>{let l=r(i),u=r(s);return c=>l+c+u}:i=>s=>s,o=e>=8?(i,s,l)=>{let u="["+s+"m",c="["+l+"m";return g=>u+g+c}:e>0?(i,s,l)=>{let u="["+i+"m",c="["+l+"m";return g=>u+g+c}:(i,s,l)=>u=>u;return{_hint:t,ncolors:e,reset:t||e>0?"e[0m":"",bold:n("1","22"),italic:n("3","23"),underline:n("4","24"),inverse:n("7","27"),white:o("37","38;2;255;255;255","39"),grey:o("90","38;5;244","39"),black:o("30","38;5;16","39"),blue:o("34","38;5;75","39"),cyan:o("36","38;5;87","39"),green:o("32","38;5;84","39"),magenta:o("35","38;5;213","39"),purple:o("35","38;5;141","39"),pink:o("35","38;5;211","39"),red:o("31","38;2;255;110;80","39"),yellow:o("33","38;5;227","39"),lightyellow:o("93","38;5;229","39"),orange:o("33","38;5;215","39"),reconfigure(i,s){let l=Ft(i,s);return l!=this.ncolors&&s!=this._hint&&Object.assign(this,Ot(l,s)),this}}}var $=ke(process.stdout),le=ke(process.stderr);var Rt=G();var jt=P(require("console"));var q=P(require("path")),Fe=G(),K=(()=>{let e=process.env._,t=process.argv[1];if(!t)return e||process.argv[0];if(e&&!q.isAbsolute(e))return e;let r="";if(e){let n=q.basename(process.execPath);e.endsWith(q.sep+n)&&(r=n+" ")}if(t.startsWith(process.cwd())){let n=q.relative(process.cwd(),t);if(!n.startsWith("node_modules"+q.sep)&&n.indexOf(q.sep+"node_modules"+q.sep)==-1)return q.sep=="/"&&(n="./"+n),n}return r+q.basename(t)})();function Oe(e,t){let[r,n]=nn(t.flags.filter(c=>c)),o={},i=!1,s=[],l=0,u=()=>{s.push(e.splice(l,1)[0]),l--};for(;l<e.length;l++){let c=e[l];if(c=="--"){l++;break}if(c[0]!="-"){u();continue}c=c.replace(/^\-+/,"");let g=c.indexOf("="),f;g!=-1&&(f=c.substr(g+1),c=c.substr(0,g));let w=r.get(c);if(!w){if(c=="h"||c=="help")i=!0,t.help||(console.log(Je(n,t.usage,t.trailer)),process.exit(0));else if(t.unknownFlagAsArg){u();continue}else ze([e[l]]);break}let _=!0;if(w.valueName){if(f===void 0)if(f=e[l+1],f!==void 0&&f[0]!="-")l++;else{console.error(`missing value for option -${c} (see ${K} -help)`),process.exit(1);break}try{_=w.valueParser?w.valueParser(f):f}catch(j){console.error(`invalid value for option -${c} (${j.message})`)}}else f!==void 0&&(console.error(`unexpected value provided for flag -${c}`),process.exit(1));o[c]=_;for(let j of w.names)j!=c&&(o[j]=_)}return l<e.length&&(s=s.concat(e.slice(l))),i&&t.help&&t.help(n,o,s),[o,s]}function ze(e){console.error(`unknown option${e.length>1?"s":""} ${e.join(", ")} (see ${K} -help)`),process.exit(1)}function nn(e){let t=new Map,r=[];for(let n of e){let o=on(n);r.push(o);for(let i of o.names){if(t.has(i))throw new Error(`duplicate CLI flag ${(0,Fe.json)(i)} in definition ${(0,Fe.json)(n)}`);t.set(i,o)}}return[t,r]}function on(e){let t=o=>o.replace(/(?:^|[\s,])\-+/g,""),r=o=>o.split(/\s*,\s*/);if(typeof e=="string")return{names:r(t(e))};let n={names:typeof e[0]=="string"?r(t(e[0])):e[0].map(t),description:e[1]||void 0};if(e[2]){let[o,i]=e[2].replace(/^[<>]+|[<>]+$/g,"").split(/:/,2);if(i)switch(i.toLowerCase()){case"string":case"str":i="string";break;case"bool":case"boolean":i="boolean",n.valueParser=s=>(s=s.toLowerCase(),s!="false"&&s!="0"&&s!="no"&&s!="off");break;case"number":case"num":case"float":case"int":i="number",n.valueParser=s=>{let l=Number(s);if(isNaN(l))throw new Error(`${(0,Fe.json)(s)} is not a number`);return l};break;default:throw new Error(`invalid argument type "${i}"`)}else i="string";n.valueName=o||i,n.valueType=i}return n}function Je(e,t,r){let n={prog:K,"0":K},o=s=>s.replace(/\$(\w+)/g,(l,u)=>{let c=n[u];if(!c)throw new Error(`unknown variable $${u} (to print a dollar sign, use '\\$')`);return c}),i=o(t?typeof t=="function"?t():String(t):e.length>0?"Usage: $prog [options]":"Usage: $prog");if(e.length>0){i+=`
options:
`;let s=0,l=[];for(let u of e){let c="  -"+(u.valueName?u.names.join("=,-")+"="+(u.valueType=="boolean"?"on|off":"<"+u.valueName+">"):u.names.join(", -"));s=Math.max(s,c.length),l.push(c)}for(let u=0;u<e.length;u++){let c=e[u],g=l[u],f=c.description;c.description||(f=c.valueType?"Set ":"Enable "+c.names.reduce((w,_)=>_.length>w.length?_:w,"")),i+=`${g.padEnd(s," ")}  ${f}`,u+1<e.length&&(i+=`
`)}}return r&&(i+=`
`+o(r.replace(/[\n\s]+$/,""))),i}var z;(function(e){e[e.Silent=-1]="Silent",e[e.Error=0]="Error",e[e.Warn=1]="Warn",e[e.Info=2]="Info",e[e.Debug=3]="Debug"})(z||(z={}));var ge=console,Ve,ue=new class{constructor(){this.SILENT=-1;this.ERROR=0;this.WARN=1;this.INFO=2;this.DEBUG=3;this.level=2;this.infoOnce=this.info;this.debug=sn}error(...t){ue.level>=0&&(Be(t),ge.error(le.red(`${K}:`),...t))}warn(...t){ue.level>=1&&(Be(t),ge.error(le.magenta(`${K}:`),...t))}info(...t){ue.level>=2&&(Be(t),ge.log(...t))}get colorMode(){return Ve}set colorMode(t){Ve!==t&&(Ve=t,t===void 0?ge=console:ge=new jt.Console({stdout:process.stdout,stderr:process.stderr,colorMode:t}))}},a=ue;function Be(e){typeof e[0]=="function"&&(e[0]=e[0]())}function sn(...e){if(ue.level>=3){let t="";if(Be(e),e.length==0||e.length==1&&(e[0]===""||e[0]===void 0))return;ge.log($.bold($.blue(`[DEBUG${t}]`)),...e)}}var ln=__dirname;function At(e){let t=null;return function(){return t||(ue.debug(`loading ${e} module`),t=(0,Rt.runtimeRequire)($t.join(ln,e)),t.initModule(ue.level)),t}}var he=At("debug.js"),Xe=At("watch.js");var ce=class extends Error{constructor(t){super(t);this.name="UserError"}};function Mt(e,t){return he().bugReportMessage(e,t)}function Nt(e,t){return he().printErrorAndExit(e,t)}function Wt(e,t){Error.prepareStackTrace=void 0;try{if(he().installSourceMapSupport(),Error.prepareStackTrace!==Wt)return Error.prepareStackTrace(e,t)}catch(r){}return e.stack||String(e)}Error.prepareStackTrace=Wt;process.on("uncaughtException",Nt);process.on("unhandledRejection",(e,t)=>{Nt(e||"PromiseRejection","unhandledRejection")});var x=G();var an=G(),eo=new Map,to=Symbol("isMemoized");var Lt=!!process.stdout.isTTY,un=!!process.stderr.isTTY,te={width:60,height:20,clear(){},banner(e){return e||(e="-"),e.repeat(Math.floor((te.width-1)/e.length))}};if(Lt||un){let e=Lt&&process.stdout||process.stderr,t=()=>{te.width=e.columns,te.height=e.rows};e.on("resize",t),t(),te.clear=()=>{e.write("c")}}var tt=P(require("path")),lo=P(require("fs")),Yt=P(require("child_process")),ye=G();var Z=P(require("path")),Dt=P(require("fs")),ve=G();var Ut=Symbol("TS_CONFIG_FILE"),Gt=Symbol("TS_CONFIG"),{dirname:cn,basename:io}=Z;function qt(e){let t="",r=process.cwd(),n=ve.isWindows?"tsc.cmd":"tsc";e&&process.chdir(e);try{t=require.resolve("typescript")}catch(o){}if(e&&process.chdir(r),t){let o=Z.sep+"node_modules"+Z.sep,i=t.indexOf(o);if(i!=-1)return Z.join(t.substr(0,i+o.length-Z.sep.length),".bin",n)}return n}function Qe(e,t){for(let r of Ze(e,t))try{if(Dt.statSync(r).isFile())return r}catch(n){}return null}function*Ze(e,t){e=Z.resolve(e);let r=Z.parse(e).root;for(t=t?Z.resolve(t):r;yield Z.join(e,"tsconfig.json"),!(e==t||(e=cn(e),e==r)););}function et(e){let t=e.cwd||process.cwd();return e.entryPoints&&e.entryPoints.length>0&&(t=Z.resolve(t,Z.dirname(e.entryPoints[0]))),t}function be(e){let t=e[Ut];if(t===void 0){if(e.tslint==="off"||e.tslint===!1||e.tsc==="off"||e.tsc===!1)t=null;else{let r=et(e);t=Qe(r,e.cwd)}Object.defineProperty(e,Ut,{value:t})}return t}function _e(e){let t=e[Gt];if(t===void 0){let r=be(e);if(r)try{t=(0,ve.jsonparseFile)(r)}catch(n){a.warn(()=>`failed to parse ${r}: ${n.stack||n}`)}t||(t=null),Object.defineProperty(e,Gt,{value:t})}return t}var{dirname:dn,basename:ho}=tt,rt={6031:"IGNORE",6194:"IGNORE",6133:"WARNING",2531:"WARNING",7006:"WARNING",7015:"WARNING",7053:"WARNING"},Ht=0,Kt=1,zt=2,fn=3,Jt={IGNORE:Ht,INFO:Kt,WARNING:zt,ERROR:fn};function Vt(e,t){for(let r of Object.keys(t)){let n=Jt[String(t[r]).toUpperCase()];if(n===void 0)throw new ce(`Invalid value for TS rule ${r}: ${(0,ye.json)(n)} -- expected value to be one of: `+Object.keys(Jt).map(ye.json).join(", "));e[r]=n}}function nt(e){e||(e={});let t={cancelled:!1,cancel(){}},r=new Promise((n,o)=>{if(e.mode=="off")return n(!0);let i=e.cwd||process.cwd(),s=e.tsconfigFile;if(s===void 0&&(s=Qe(e.srcdir?tt.resolve(i,e.srcdir):i)),e.mode!="on"&&!s)return n(!0);let l=e.format?e.format.toLowerCase():"",u=l.startsWith("short"),c=l.startsWith("short"),g=l=="short-all",f=qt(e.cwd);if(f=="tsc"&&e.mode!="on"&&!(f=(0,ye.findInPATH)(f)))return a.warn("tsc not found in node_modules or PATH. However a tsconfig.json file was found in "+tt.relative(process.cwd(),dn(s))+'. Set tslint options.tslint="off" or pass -no-diag on the command line to disable tsc.'),n(!0);let w={};Vt(w,rt),e.rules&&Vt(w,e.rules);let _=["--noEmit",e.colors&&"--pretty",e.watch&&"--watch",s&&"--project",s].concat(e.args||[]).filter(y=>y);a.debug(()=>`spawning process ${f} ${(0,ye.json)(_,2)}`);let j=(0,Yt.spawn)(f,_,{stdio:["inherit","pipe","inherit"],cwd:i}),M=()=>{try{j.kill()}catch(y){}};process.on("exit",M),t.cancel=()=>{j.kill()};let p=y=>y,h=$.orange,S=$.red,k=$.green,I=Buffer.from(" TS"),T=Buffer.from("Found "),E=Buffer.from("c"),B=Buffer.from("tarting compilation"),L=Buffer.from("tarting incremental compilation"),d=[],m=0,C=!1,b={errors:0,warnings:0,other:0,reset(){this.errors=0,this.warnings=0,this.other=0}},F=!1;function oe(){if(!e.quiet||b.errors>=0){e.watch&&console.log(te.banner("\u2014"));let y=[];b.errors>0?y.push(S("TS: "+me("$ error","$ errors",b.errors))):y.push(k("TS: OK")),b.warnings>0&&y.push(h(me("$ warning","$ warnings",b.warnings))),b.other>0&&y.push(me("$ message","$ messages",b.other)),console.log(y.join("   ")),e.watch&&console.log(te.banner("\u2014"))}C=b.errors>0,e.onEnd&&e.onEnd(b),b.reset(),F=!0}function Se(y){let O=d.slice();if(d.length=0,m==0){let v=0,N=O[v++];for(;N.length==0||N[0]==10&&v<O.length;)N=O[v++];if(N.includes(B)||N.includes(L))return b.reset(),y&&oe();if(O.every(ie=>ie.length<=1))return y&&oe()}else{let v=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m|)/g,N=O.shift().toString("utf8");switch(w[m]){case Ht:return y&&oe();case Kt:N=N.replace(v,p("info")),u?O=[]:pe(O,p),b.other++;break;case zt:N=N.replace(v,h("warning")),c?O=[]:pe(O,h),b.warnings++;break;default:g&&(O=[]),v.test(N)?b.errors++:b.other++;break}process.stdout.write(N)}O.forEach(v=>process.stdout.write(v)),y&&oe()}function pe(y,O){for(let v=1;v<y.length;v++){let N=y[v];if(N.includes(126)){let ie=N.toString("utf8");ie=ie.replace(/\x1b\[\d+m(\s*~+)/g,O("$1")),y[v]=ie}}}function me(y,O,v){return(v==1?y:O).replace(/\$/g,v)}pn(j.stdout,(y,O)=>{if(e.clearScreen||(y=Mr(y)),O){y.length>0&&d.push(y),d.length>0&&Se();return}if(F&&y.length>1&&(F=!1,e.onRestart&&e.onRestart()),y.includes(T)){let v=Ge(y.toString("utf8"));if(/^(?:\[[^\]]+\] |[\d\:PAM \-]+|)Found \d+ error/.test(v)){Se(!0),m=0;return}else Se(!1);m=0}else if(y.includes(I)){let v=y.toString("utf8"),N=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m\x1b\[\d+m|) TS(\d+)\:/.exec(v),ie=N?parseInt(N[1]):0;ie>0&&!isNaN(ie)&&(d.length>0&&Se(),m=ie)}d.push(y)}),j.on("close",y=>{process.removeListener("exit",M),n(!C)});function Ge(y){return y.replace(/\x1b\[\d+m/g,"")}function Mr(y){let O=y.indexOf(E);return O==-1?y:O==0?y.subarray(3):Buffer.concat([y.subarray(0,O),y.subarray(O+3)],y.length-3)}});return r.cancel=()=>(t.cancelled||(t.cancelled=!0,t.cancel()),r),r}var mn=Buffer.allocUnsafe(0);function pn(e,t){let r=[],n=0,o=s=>{let l=0;for(;;){let u=s.indexOf(10,l);if(u==-1){if(l<s.length-1){let g=s.subarray(l);r.push(g),n+=g.length}break}u++;let c=s.subarray(l,u);n>0&&(c=Buffer.concat(r.concat(c),n+c.length),r.length=0,n=0),t(c,!1),l=u}},i=()=>{r.length>0?t(Buffer.concat(r,n),!0):t(mn,!0)};e.on("data",o),e.on("close",i),e.on("end",i)}var cr=P(require("fs"));var ut=G();var Q=P(require("fs")),or=P(require("os")),ir=P(require("child_process")),sr=P(require("stream"));var gn=P(require("fs")),xe=G();function Xt(e){return e&&e.read}function Zt(e){return e&&e.write}var ot=Buffer.allocUnsafe(0);function Qt(e){return e&&typeof e=="object"&&e[xe.TYPE]=="Reader"}function je(e){return e?new er(e):hn}function it(e){return e?{[xe.TYPE]:"Writer",stream:e}:bn}var wo,hn=new class{constructor(){this[wo]="Reader"}_E(){return new Error("stream not readable")}get stream(){throw this._E()}[(wo=xe.TYPE,Symbol.asyncIterator)](){throw this._E()}read(){return Promise.reject(this._E())}},Po,tr,bn=new(tr=class{constructor(){this[Po]="Writer"}_E(){return new Error("stream not writable")}get stream(){throw this._E()}},Po=xe.TYPE,tr),Co,er=class{constructor(t){this[Co]="Reader";this._ended=!1;this.stream=t,t.pause(),t.once("end",()=>{this._ended=!0})}[(Co=xe.TYPE,Symbol.asyncIterator)](){return this.stream[Symbol.asyncIterator]()}async read(t,r){let n=this.stream;if(n.pause(),typeof t=="string")r=t,t=Number.MAX_SAFE_INTEGER;else if(t==null||t<0)t=Number.MAX_SAFE_INTEGER;else if(t==0)return r?"":ot;if(n.readable){let l=n.read(this._ended?void 0:t);if(l)return r?l.toString(r):l}if(this._ended)return r?"":ot;let o=[],i=0;if(n.readable){let l=n.read();l&&(o.push(l),i+=l.length)}for(;i<t&&!this._ended;){await new Promise((u,c)=>{n.once("error",c),n.once("end",u),n.once("readable",u)});let l=n.read(t-i);l||(l=n.read()),l&&(o.push(l),i+=l.length)}let s=rr(o);return r?s.toString(r):s}};function rr(e,t){return e.length==0?ot:e.length==1?e[0]:Buffer.concat(e,t)}function st(){let e=[],t=0,r=e.push;return e.push=n=>(t+=n.length,r.call(e,n)),e.buffer=()=>rr(e,t),e}function lt(e){return he().libuv_errors[e]||""}function nr(e,t,r){let n=setTimeout(()=>{let o=new Error("timeout");o.name="Timeout",r(o)},t);return e.then(o=>(clearTimeout(n),o),o=>{throw clearTimeout(n),o})}var de=G();var lr="process not started",$e=class{constructor(t,...r){this.dir="";this.env={...process.env};this.shell=!1;this.stdin=null;this.stdout=null;this.stderr=null;this.extraFiles=[];this.windowsHide=!0;this.process=null;this.running=!1;this.pid=0;this.exitCode=-1;this._resolve=()=>{};this._reject=()=>{};this._onerror=t=>{a.debug(()=>`${this} error:
${t.stack||t}`),this._reject(t)};this._onexit=(t,r)=>{let n=this;a.debug(()=>`${n} exited status=${t} signal=${r}`),n.running=!1,t===null||r!==null?(assert(typeof r=="string"),n.exitCode=-(or.constants.signals[r]||1)):n.exitCode=t||0,n._resolve(n.exitCode)};this.command=t,this.args=r,this.promise=Promise.reject(new Error(lr)),this.promise.catch(n=>{})}start(){return null}run(t){return this.start(),this.wait(t)}output(t,r){this.stdout="pipe",this.stderr||(this.stderr="pipe");let{stdout:n,stderr:o}=this.start(),i=st(),s=st();return n.stream.on("data",l=>{i.push(l)}),o&&o.stream.on("data",l=>{s.push(l)}),this.wait(r||0).then(l=>{if(l!=0){let c="",g=s.buffer();try{c=g.toString("utf8")}catch(f){c=g.toString("ascii")}throw c.length>0&&(c=`. stderr output:
`+c),new Error(`command exited with status ${l}${c}`)}let u=i.buffer();return t?u.toString(t):u})}wait(t,r){return t===void 0||t<=0?this.promise:this._waitTimeout(t,(n,o,i)=>(a.debug(()=>`${this} wait timeout reached; killing process`),n.message="Cmd.wait timeout",this.kill(r).then(()=>i(n))))}signal(t,r){let n=this._checkproc();if(r=="group")try{return process.kill(-n.pid,t),!0}catch(o){}return n.kill(t)}async kill(t="SIGTERM",r=500,n){let o=this._checkproc();return this.signal(t,n||"group")?r<=0?this.promise:this._waitTimeout(r,(i,s)=>(a.debug(()=>`${this} kill timeout reached; sending SIGKILL`),o.kill("SIGKILL"),this.promise.then(s))):o.exitCode||0}toString(){return this.process?`Cmd[${this.pid}]`:"Cmd"}_checkproc(){if(!this.process)throw new Error(lr);return this.process}_rejectAndKill(t){this._reject(t)}_waitTimeout(t,r){return new Promise((n,o)=>{let i=!1;return this.promise.then(s=>{i||n(s)}),nr(this.promise,t,s=>{i=!0,r(s,n,o)})})}};$e.prototype.start=function(){let t=this;if(t.running)throw new Error("start() called while command is running");t.exitCode=-1,t.promise=new Promise((l,u)=>{t._resolve=l,t._reject=u});let r=null,n=null;t.stdin instanceof Buffer?r="pipe":Qt(t.stdin)?typeof t.stdin.stream.fd=="string"?r=t.stdin.stream:(r="pipe",n=t.stdin.stream):r=t.stdin;let o={stdio:[r||"ignore",t.stdout===process.stdout?1:t.stdout||"ignore",t.stderr===process.stderr?2:t.stderr?t.stderr:"ignore",...t.extraFiles],cwd:t.dir?(0,de.expandTildePath)(t.dir):void 0,env:t.env,shell:t.shell,windowsHide:t.windowsHide,detached:!de.isWindows},i=ir.spawn(t.command,t.args,o);if(i.pid===void 0){t.process=null,t.pid=0;let l=yn(t);throw t._reject(l),l}if(t.running=!0,t.process=i,t.pid=i.pid,i.on("exit",t._onexit),i.on("error",t._reject),a.debug(()=>`${t} started (${(0,de.repr)(t.command)})`),i.stdin)if(t.stdin instanceof Buffer){let l=new sr.PassThrough;l.end(t.stdin),l.pipe(i.stdin),i.stdin=null}else n&&(n.pipe(i.stdin),i.stdin=null);return!i.stdin&&!i.stdout&&!i.stderr&&i.stdio.length<4?null:{stdin:i.stdin?it(i.stdin):null,stdout:i.stdout?je(i.stdout):null,stderr:i.stderr?je(i.stderr):null,extraFiles:i.stdio.slice(3).map(l=>Xt(l)?je(l):Zt(l)?it(l):null)}};function yn(e){let t="",r="unspecified error";if(e.shell==!1){try{Q.accessSync(e.dir,Q.constants.R_OK|Q.constants.X_OK),(Q.statSync(e.command).mode&Q.constants.S_IFREG)==0?t="EACCES":t="EIO"}catch(o){t=o.code||"ENOENT"}r=lt(t)||r}if(!t){try{Q.accessSync(e.dir,Q.constants.R_OK|Q.constants.X_OK),t="EIO"}catch(o){t=o.code||"ENOENT"}r=lt(t)||r,t&&(r=r+"; cmd.dir="+(0,de.repr)(e.dir))}t||(t="UNKNOWN");let n=new Error(`failed to spawn process ${(0,de.repr)(e.command)} (${t} ${r})`);return n.code=t,n}var at=P(require("fs")),ar=P(require("os")),ur=new Map;function Te(e,t){let r=o=>at.writeSync(process.stderr.fd,o+`
`),n=ur.get(e);if(n)n.listeners.add(t);else{let o=new Set([t]),i=s=>{s=="SIGINT"&&at.writeSync(1,`
`);try{for(let l of o)l(s)}catch(l){r(`error in signal listener: ${l.stack||l}`)}process.exit(-(ar.constants.signals[s]||1))};process.on(e,i),ur.set(e,{rootListener:i,listeners:o})}}var dr=!1,fr=!1,Re=new Set;function xn(){if(dr)return;dr=!0,process.on("beforeExit",t=>ct(!1)),process.on("exit",t=>ct(!1));let e=t=>ct(!1);Te("SIGINT",e),Te("SIGHUP",e),Te("SIGTERM",e),Te("SIGPIPE",e)}function ct(e){if(fr)return;fr=!0;let t=r=>cr.writeSync(process.stderr.fd,r+`
`);try{for(let r of Re)if(r.cmd.running)try{r.cmd.signal("SIGTERM")}catch(n){}Re.clear()}catch(r){t(`ignoring error in run.atexit: ${r.stack||r}`)}}function mr(e){if(!e.run)return;a.debug(()=>`run.configure run=${(0,ut.repr)(e.run)}`);let t=new pr(e);Re.add(t);let r=e.onEnd;e.onEnd=async(n,o,i)=>{if(await t.onEndBuild(o),typeof r=="function")return r(n,o,i)},xn()}function gr(){return Promise.all(Array.from(Re).map(e=>e.cmd.promise)).then(e=>e.reduce((t,r)=>Math.max(t,r),0))}var pr=class{constructor(t){this._logOnExit=!0;if(this.config=t,this.cmd=new $e(""),this.cmd.stdout="inherit",this.cmd.stderr="inherit",this.cmd.env.ESTRELLA_PATH=__filename,this.cmd.env.ESTRELLA_VERSION="1.3.2",typeof t.run=="string")this.cmd.command=t.run,this.cmd.shell=!0,this.cmdname=t.run;else if(typeof t.run=="boolean"){if(!t.outfile)throw new ce("please set config.outfile=<file> or config.run=<file>");this.cmd.command=process.execPath,this.cmd.args=[t.outfileAbs],this.cmdname=t.outfile}else{if(!t.run||t.run.length==0)throw new ce("config.run is an empty list");this.cmd.command=t.run[0],this.cmd.args=t.run.slice(1),this.cmdname=t.run.join(" "),this.cmdname.length>60&&(this.cmdname=this.cmdname.substr(0,57)+"...")}}async onEndBuild(t){if(t.errors.length>0)return;let r=this.cmd,n=$.pink,o=r.running;r.running&&(this._logOnExit=!1,a.debug(()=>`Stopping ${this.cmdname} [${r.pid}] ...`),await r.kill()),a.debug(()=>`Starting command ${(0,ut.repr)([r.command,...r.args])}`),r.start(),this.config.watch&&(a.info(()=>n(`${o?"Restarted":"Running"} ${this.cmdname} [${r.pid}]`)),this._logOnExit=!0,r.promise.then(i=>{this._logOnExit&&a.info(()=>n(`${this.cmdname} exited (${i})`))}))}};var Ae=G();function hr(e){let t=e;if(!t){a.debug("typescript API requested; attempting to load typescript module");try{let p=require;if(t=p("typescript"),parseFloat(t.versionMajorMinor)<3.5)return a.warn(`typescript ${t.version} is too old; disabling "ts" API.
  You are seeing this message because you are importing the ts API.
  Either install a more recent version of typescript or remove the ts import.`),null;a.debug(()=>`loaded typescript ${t.version} from ${(0,Ae.tildePath)(p.resolve("typescript"))}`)}catch(p){return a.debug(()=>"failed to load typescript; module unavailable"),null}}let r=new Map;function n(p){let h=(0,Ae.json)(Object.keys(p).sort().map(T=>[T,p[T]])),S=r.get(h);if(S)return a.debug("ts.getCompilerHost cache hit"),S;p={newLine:t.NewLineKind.LineFeed,...p};let I=[t.createCompilerHost(p,!0),p];return r.set(h,I),a.debug("ts.getCompilerHost cache miss"),I}async function o(p,h){let S=typeof p=="string"?{"/<source>/a.ts":p}:p,k=Object.keys(S),[I,T]=n(h||{}),E=I.readFile;I.readFile=d=>d in S?S[d]:E(d);let B=t.createProgram(k,T,I);if(typeof p=="string")return B.getSourceFile(k[0]);let L={};for(let d of k)L[d]=B.getSourceFile(d);return L}async function i(p,h){return s(p,h)}function s(p,h){let[S,k]=n(h||{}),T=t.createProgram([p],k,S).getSourceFile(p);if(!T)throw new Error(`${p}: file not found`);return T}function l(p,h,S){return u(p,[h],S).then(k=>k[0])}async function u(p,h,S){let k=s(p,S);return c(k,h)}function c(p,h){let S=_(p),k=new Map,I=[];for(let T of h||S.keys()){let E=S.get(T);if(!E){I.push(null);continue}I.push(g(p,E,S,k))}return I}function g(p,h,S,k){let I=k.get(h);if(I)return I;let T={heritage:[],name:h.name.escapedText,props:{},computedProps(){let E={};for(let B of T.heritage)Object.assign(E,B.props);return Object.assign(E,T.props),E},lookupProp(E){let B=T.props[E];if(!B){for(let L of T.heritage)if(B=L.lookupProp(E))break}return B}};if(k.set(h,T),h.heritageClauses)for(let E of h.heritageClauses)for(let B of E.types){let L=B.expression;if(t.isIdentifier(L)){let d=S.get(L.escapedText);d&&T.heritage.push(g(p,d,S,k))}}return h.forEachChild(E=>{if(t.isPropertySignature(E)){let B=f(E,p,T);T.props[B.name]=B}}),T}function f(p,h,S){let k=t.getLineAndCharacterOfPosition(h,p.pos),I=null,T=p.type,B={name:w(p.name),type:T,get typestr(){return I===null&&(I=T?M(T,h):"any"),Object.defineProperty(B,"typestr",{enumerable:!0,value:I}),I},srcfile:h.fileName,srcline:k.line,srccol:k.character,parent:S};return B}function w(p){switch(p.kind){case t.SyntaxKind.Identifier:case t.SyntaxKind.PrivateIdentifier:return p.escapedText;case t.SyntaxKind.StringLiteral:case t.SyntaxKind.NumericLiteral:return p.text;case t.SyntaxKind.ComputedPropertyName:return"[computed]";default:return"?"}}function _(p){let h=new Map;return t.forEachChild(p,S=>{S.kind==t.SyntaxKind.InterfaceDeclaration&&h.set(S.name.escapedText,S)}),h}let j=t.createPrinter({removeComments:!0,newLine:t.NewLineKind.LineFeed,omitTrailingSemicolon:!0,noEmitHelpers:!0});function M(p,h){if(!h){let S=p;for(;S.kind!=t.SyntaxKind.SourceFile;)if(S=S.parent,!S)throw new Error("node without SourceFile parent (provide file to ts.fmt)");h=S}return j.printNode(t.EmitHint.Unspecified,p,h)}return{ts:t,getCompilerHost:n,parse:o,parseFile:i,interfaceInfo:l,interfacesInfo:u,interfacesInfoAST:c,fmt:M}}var D=P(require("fs")),Y=P(require("path")),wr=P(require("crypto"));var re=P(require("fs")),Me=G(),br=String.fromCharCode,wn=(e,t)=>e.charCodeAt(t||0);function yr(e,t){if(typeof t=="number")return re.chmodSync(e,t),t;let r=re.statSync(e).mode,n=Ne(r,t);return r!=n&&re.chmodSync(e,n),n}function xr(e,t){return new Promise((r,n)=>{if(typeof t=="number")return re.chmod(e,t,o=>{o?n(o):r(t)});re.stat(e,(o,i)=>{if(o)return n(o);let s=Ne(i.mode,t);if(i.mode==s)return r(s);re.chmod(e,s,l=>{l?n(l):r(s)})})})}function Ne(e,t){let r="Expected format: [ugoa]*[+-=][rwx]+",n=(i,s)=>new Error(`${i} in modifier ${(0,Me.json)(s)}. ${r}`),o=[];for(let i of Array.isArray(t)?t:[t])o=o.concat(i.trim().split(/\s*,+\s*/));for(let i of o){let s=[],l=!1,u=0,c=0;for(let f=0;f<i.length;f++){let w=wn(i,f);if(u==0)switch(w){case 117:case 103:case 111:l||s.push(w);break;case 97:s=[117,103,111],l=!0;break;case 43:case 45:case 61:u=w;break;default:if(u==0)throw n(`Invalid target or operation ${(0,Me.json)(br(w))}`,i);break}else switch(w){case 114:c|=4;break;case 119:c|=2;break;case 120:c|=1;break;default:throw n(`Invalid permission ${(0,Me.json)(br(w))}`,i)}}if(u==0)throw n("Missing operation",i);s.length==0&&(s=[117]),c==0&&(c=4|2|1);let g=0;for(let f of s)switch(f){case 117:g|=c<<6;break;case 103:g|=c<<3;break;case 111:g|=c;break}switch(u){case 43:e|=g;break;case 45:e&=~g;break;case 61:e=g;break}}return e}var We=G();var ee=D.promises,Sn={};function Le(e){Sn[Y.resolve(String(e))]=(0,We.clock)()}function A(e,t){return ee.readFile(e,t)}A.editMode=Ne;A.chmod=(e,t)=>(Le(e),xr(e,t));function Pn(e,t){return ee.readFile(e,t)}A.read=Pn;function Cn(e,t){return D.readFileSync(e,t)}A.readSync=Cn;A.stat=ee.stat;function _n(...e){return Promise.all(e.map(t=>ee.stat(t).then(r=>r.mtimeMs).catch(r=>null))).then(t=>t.length==1?t[0]:t)}A.mtime=_n;A.readall=(...e)=>Promise.all(e.map(t=>ee.readFile(t)));A.readallText=(e,...t)=>Promise.all(t.map(r=>ee.readFile(r,{encoding:e||"utf8"})));A.write=async(e,t,r)=>{Le(e);let n=r&&typeof r=="object"?r:{};try{await ee.writeFile(e,t,r)}catch(o){if(!n.mkdirOff&&o.code=="ENOENT")await A.mkdirs(Y.dirname(String(e)),n.mkdirMode),await ee.writeFile(e,t,r);else throw o}if(n.log){let o=Y.relative(process.cwd(),String(e));o.startsWith(".."+Y.sep)&&(o=(0,We.tildePath)(e)),a.info($.green(`Wrote ${o}`))}};A.writeSync=(e,t,r)=>{D.writeFileSync(e,t,r)};function Tn(e,t){return new Promise((r,n)=>{let o=D.createReadStream(e),i=wr.createHash("sha1");o.on("error",n),o.on("end",()=>{i.end(),r(t?i.digest(t):i.digest())}),o.pipe(i)})}A.sha1=Tn;A.copy=(e,t,r)=>{let n=D.constants.COPYFILE_FICLONE;return r&&(n|=D.constants.COPYFILE_EXCL),Le(t),ee.copyFile(e,t,n)};A.move=(e,t)=>(Le(t),ee.rename(e,t));A.mkdirs=(e,t)=>ee.mkdir(e,{recursive:!0,mode:t}).then(r=>!!r&&r.length>0);async function Sr(e,t,r){if(r||(r={}),!D.promises||!D.promises.opendir)throw new Error("scandir not implemented for nodejs <12.12.0");let n=[],o=new Set,i=r.recursive!==void 0?r.recursive?Infinity:0:r.depth!==void 0?r.depth:Infinity;async function s(u,c,g){if(o.has(u))return;o.add(u);let f=await D.promises.opendir(u);for await(let w of f){let _=w.name;w.isDirectory()?i<g&&await s(Y.join(u,_),Y.join(c,_),g+1):(w.isFile()||w.isSymbolicLink())&&t&&t.test(_)&&n.push(Y.join(c,_))}}let l=Array.isArray(e)?e:[e];return Promise.all(l.map(u=>s(Y.resolve(u),".",0))).then(()=>n.sort())}var Pr={version:"0.9.0",BuildOptions:new Set(["sourcemap","sourcesContent","format","globalName","target","minify","minifyWhitespace","minifyIdentifiers","minifySyntax","charset","treeShaking","jsxFactory","jsxFragment","define","pure","keepNames","color","logLevel","logLimit","bundle","splitting","preserveSymlinks","outfile","metafile","outdir","outbase","platform","external","loader","resolveExtensions","mainFields","conditions","write","tsconfig","outExtension","publicPath","chunkNames","assetNames","inject","banner","footer","incremental","entryPoints","stdin","plugins","absWorkingDir","nodePaths","watch"])},Cr={BuildConfig:new Set(["entry","debug","watch","cwd","quiet","silent","clear","tslint","onStart","onEnd","outfileMode","run","tsc","tsrules","title"])};var Ee=P(require("path"));var _r=P(require("crypto"));function De(e,t){let r=_r.createHash("sha1").update(e);return t?r.digest(t):r.digest()}function Tr(e,t){let r=e.cwd||"?",n=!1,o=!1,i=!1,s=!1,l="";function u(f){let w=[f.cwd,f.outfile||"",...Array.isArray(f.entryPoints)?f.entryPoints:f.entryPoints?[f.entryPoints]:[]].join(Ee.delimiter);return En(De(Buffer.from(w,"utf8")))}let c=e.cwd?Ee.resolve(e.cwd):t,g=Object.create({get outfileAbs(){return l},setOutfile(f){g.outfile=f,l=f&&f!="-"?Ee.resolve(g.cwd,f):""},get projectID(){return r},updateProjectID(){return r=u(g),r},get buildIsCancelled(){return n},set buildIsCancelled(f){n=f},get outfileIsTemporary(){return o},set outfileIsTemporary(f){o=f},get outfileCopyToStdout(){return i},set outfileCopyToStdout(f){i=f},get metafileIsTemporary(){return s},set metafileIsTemporary(f){s=f}});return Object.assign(g,e),g.cwd=c,g.setOutfile(e.outfile||""),g}function En(e){let t="";for(let r=0;r<e.length;r+=4)t+=e.readUInt32LE(r).toString(36);return t}var{dirname:dt,basename:Ir}=J,we={usage:"usage: $0 [options]",flags:[["-w, watch","Watch source files for changes and rebuild."],["-g, debug","Do not optimize and define DEBUG=true."],["-r, run","Run the output file after a successful build."],["-sourcemap","Generate sourcemap."],["-inline-sourcemap","Generate inline sourcemap."],["-no-color","Disable use of colors."],["-no-clear","Disable clearing of the screen, regardless of TTY status."],["-no-diag","Disable TypeScript diagnostics."],["-color","Color terminal output, regardless of TTY status."],["-diag","Only run TypeScript diagnostics (no esbuild.)"],["-quiet","Only log warnings and errors but nothing else."],["-silent","Don't log anything, not even errors."],["-estrella-version","Print version of estrella and exit 0."],["-estrella-debug","Enable debug logging of estrella itself."]]},In={usage:"usage: $0 [options] <srcfile> ...",flags:we.flags.concat([["-o, outfile","Write output to <file> instead of stdout.","<file>"],["-bundle","Include all dependencies."],["-minify","Simplify and compress generated code."],["-outdir","Write output to <dir> instead of stdout.","<dir>"],["-esbuild","Pass arbitrary JSON to esbuild's build function.","<json>"]]),trailer:`
Example of using estrella without a build script:
  $0 -o out/app.js main.ts
    This compile main.ts and writes the output to out/app.js

Example of using estrella with a build script:
  1. Create a file called build.js with the following contents:
       #!/usr/bin/env node
       const { build } = require("estrella")
       build({
         entry: "main.ts",
         outfile: "out/main.js",
       })
  2. Make that file executable and run it:
       chmod +x build.js
       ./build.js
  You can now customize your build behavior by changing build.js.
  Try ./build.js -help

See https://github.com/rsms/estrella#readme for documentation.
  `},ft=Promise.resolve(),R={},V=[],Ue=Symbol("IS_MAIN_CALL");var kr=!1;function Fr(e){if(!kr){kr=!0;let t=e||1;process.exitCode=t,process.on("exit",r=>{process.exit(r||t)})}}function kn(e){if(a.debug(()=>`input config ${(0,x.repr)(e)}`),e.entryPoints||(e.entryPoints=[]),e.entry&&(Array.isArray(e.entry)?e.entryPoints=e.entryPoints.concat(e.entry):e.entryPoints.push(e.entry)),delete e.entry,e.entryPoints.length==0&&(a.debug(()=>"missing entryPoints; attempting inference"),e.entryPoints=Or(e),e.entryPoints.length==0)){let t=_e(e)?" (could not guess from tsconfig.json)":"";throw new ce(`config.entryPoints is empty or not set${t}`)}if(e.sourcemap?e.sourcemap!="inline"&&e.sourcemap!="external"&&(e.sourcemap=!0):e.sourcemap=!1,!e.outfile&&!e.outdir){e.setOutfile("-");let t=e.updateProjectID();e.setOutfile(J.join((0,x.tmpdir)(),`esbuild.${t}.out.js`)),e.outfileIsTemporary=!0}e.updateProjectID(),a.debug(()=>`effective config for project#${e.projectID}: ${(0,x.repr)(e)}`)}function Fn(e,t){let r=(0,x.clock)(),n=JSON.parse(ne.readFileSync(e));for(let o in t){let i=t[o];i===void 0?delete n[o]:(typeof i=="function"&&(i=i(n[o])),n[o]=i)}ne.writeFileSync(e,JSON.stringify(n)),a.debug(()=>`patched source map ${e} with overrides ${(0,x.repr)(t)} (${(0,x.fmtDuration)((0,x.clock)()-r)})`)}function Or(e){let t=_e(e);if(t){if(a.debug(()=>`tsconfig file found at ${be(e)}`),t.files)return t.files;if(t.include){let r=[];for(let n of t.include)a.debug(`guessing entry points: glob.glob(${n}) =>`,fe.glob(n)),r=r.concat(fe.glob(n));if(t.exclude)for(let n of t.exclude)r=r.filter(o=>!fe.match(n,o));return r.slice(0,1)}}return[]}function On(e){let t={},r={},n={name:"globalName"};for(let o of Object.keys(e))Cr.BuildConfig.has(o)||(Pr.BuildOptions.has(o)||(r[o]=e[o]),o=n[o]||o,t[o]=e[o]);return Object.keys(r).length>0&&a.info(`Notice: Potentially invalid esbuild.BuildOption(s): ${(0,x.repr)(r)}
`+Mt("guess",(0,x.json)(Object.keys(r)))),t.outfile||delete t.outfile,t}var Br=new Set;function Bn(...e){if(a.level>=a.INFO){let t=e.join(" ");Br.has(t)||(Br.add(t),a.info(...e))}}function vr(e){e=Tr(e||{},e[Ue]?process.cwd():process.mainModule&&dt(process.mainModule.filename)||__dirname);let t={resolve(){},reject(){}},r=[];function n(l){e.isCancelled?l():r.push(l)}function o(l){if(!e.isCancelled){a.debug("build cancelled",{reason:l}),e.isCancelled=!0;for(let u of r)u&&u();r.length=0,l?t.reject(l):t.resolve()}}let i={addCancelCallback:n,buildCounter:0,rebuild(){return a.warn("rebuild() called before initial build completed. Ignoring"),Promise.resolve(!0)}},s=ft.then(()=>new Promise((l,u)=>{if(e.isCancelled)return a.debug("build cancelled immediately"),!1;t.resolve=l,t.reject=u,vn(e,i).then(l).catch(u)}));return s.rebuild=()=>i.rebuild(),Object.defineProperty(s,"buildCounter",{get(){return i.buildCounter}}),s.cancel=o,s}async function vn(e,t){let r=Ue in e;delete e[Ue];let n=R,o=V;if(e.run===void 0&&(e.run=n.run),e.outfile=="-"||n.outfile=="-"||r&&!n.outfile&&!n.outdir){e.setOutfile("-");let d=e.updateProjectID();n.outfile=J.join((0,x.tmpdir)(),`esbuild.${d}.out.js`),e.setOutfile(n.outfile),e.outfileIsTemporary=!0,e.outfileCopyToStdout=!0}if(!r)kn(e);else{if(o.length==0){let d=Or(e);a.debug(()=>`no input files provided; best guess: ${(0,x.repr)(d)}`),d.length==0&&(a.error(`missing <srcfile> argument (see ${K} -help)`),process.exit(1)),o.splice(o.length-1,0,...d);let m=_e(e);!n.outfile&&!n.outdir&&m&&(n.outfile=m.outFile,n.outfile||(n.outdir=m.outDir)),o.length==0&&(a.error(`missing <srcfile> argument (see ${K} -help)`),process.exit(1))}if(e.setOutfile(n.outfile||void 0),e.entryPoints=o,e.outdir=n.outdir||void 0,e.bundle=n.bundle||void 0,e.minify=n.minify||void 0,n.esbuild){let d=(0,x.jsonparse)(n.esbuild,"-esbuild");if(!d||typeof d!="object")return a.error(`-esbuild needs a JS object, for example '{key:"value"}'. Got ${typeof d}.`),!1;a.debug(()=>`applying custom esbuild config ${(0,x.repr)(d)}`);for(let m in d)e[m]=d[m]}}let i=e.debug=n.debug=!!(n.debug||e.debug),s=e.silent=n.silent=!!(n.silent||e.silent),l=e.quiet=n.quiet=s||!!(n.quiet||e.quiet);n.watch=!!(n.watch||e.watch),(!e.watch||typeof e.watch!="object")&&(e.watch=n.watch),e.color!==void 0&&(a.colorMode=e.color,$.reconfigure(process.stdout,e.color),le.reconfigure(process.stderr,e.color)),l&&(a.level=s?a.SILENT:a.WARN),e.sourcemap=n["inline-sourcemap"]?"inline":n.sourcemap?!0:e.sourcemap,e.outfileIsTemporary&&e.outfileCopyToStdout&&e.sourcemap===!0&&(e.sourcemap="inline"),e.clear=n["no-clear"]?!1:e.clear===void 0?!!process.stdout.isTTY:e.clear,a.debug(()=>`project directory ${(0,x.repr)(e.cwd)} (config.cwd)`),e.title||(e.title=e.name||(0,x.tildePath)(e.cwd));let u=n.diag===!0?"on":n.diag===!1?"off":"auto";u!=="off"&&(e.tsc!==void 0&&(a.info("the 'tsc' property is deprecated. Please rename to 'tslint'."),e.tslint===void 0&&(e.tslint=e.tsc)),e.tslint&&e.tslint!=="auto"&&(u=e.tslint),u==="auto"||typeof u=="object"&&(e.tslint.mode==="auto"||!e.tslint.mode)?be(e)||(a.debug(()=>{let m=et(e);return`skipping tslint in auto mode since no tsconfig.json file was found in project.
Tried the following filenames:${Array.from(Ze(m,e.cwd)).map(b=>`
  ${(0,x.tildePath)(b)}`)}`}),u="off"):e.tslint!==void 0&&e.tslint!=="auto"&&(u=e.tslint)),e.run&&mr(e);let c=0;function g(){te.clear(),c=(0,x.clock)()}let f=!1,w=e.onEnd,_=w?async(d,m)=>{f=!0;let C;try{let F=w(e,d,t);C=F instanceof Promise?await F:F}catch(F){throw a.debug(()=>`error in onEnd handler: ${F.stack||F}`),F}finally{f=!1}return C===void 0?m:!!C}:(d,m)=>m;function j(d){let m=_;_=async(C,b)=>{let F=await d(C,b);return F!==void 0&&(b=F),m(C,b)}}e.outfileMode&&e.outfile&&j(async(d,m)=>{if(a.debug("onEnd chmod"),d.errors.length==0)try{yr(e.outfileAbs,e.outfileMode)}catch(C){a.error("configuration error: outfileMode: "+C.message),Fr(1)}}),e.outfileCopyToStdout&&!e.run&&e.write!==!1&&j(async(d,m)=>{if(a.debug("onEnd copyToStdout"),d.errors.length==0)return new Promise((C,b)=>{let F=ne.createReadStream(e.outfileAbs);F.on("end",()=>C(m)),F.on("error",b),F.pipe(process.stdout)})}),e.outfileIsTemporary&&!e.outfileCopyToStdout&&e.write!==!1&&j(async(d,m)=>{if(a.debug("onEnd load results"),d.js=ne.readFileSync(e.outfile,{encoding:"utf8"}),e.sourcemap===!0){try{d.map=ne.readFileSync(e.outfile+".map",{encoding:"utf8"})}catch(b){a.debug(`failed to load temporary source map at ${e.outfile}.map: ${b.stack||b}`)}let C=d.js.lastIndexOf(`
//# sourceMappingURL`);C!=-1&&(d.js=d.js.substr(0,C+1))}}),e.watch&&j(async(d,m)=>{Bn("Watching files for changes...")});let M={DEBUG:i,...e.define||{}};for(let d in M)M[d]=(0,x.json)(M[d]);let p={minify:!i,sourcemap:e.sourcemap,color:le.ncolors>0,logLevel:e.silent?"silent":e.quiet?"error":"warning",...On(e),define:M};if(e.watch){let d=e.projectID;p.metafile=!0,(!p.outfile&&!p.outdir||p.write===!1)&&(p.outfile=J.join((0,x.tmpdir)(),`esbuild.${d}.out.js`),e.outfileIsTemporary=!0,delete p.write)}t.rebuild=()=>I([]).then(d=>(f&&a.warn("waiting for rebuild() inside onEnd handler may cause a deadlock"),d));let h={warnings:[],errors:[]};function S(d,m){a.debug("esbuild finished with result",m),jr(m.warnings||[]);let C=(0,x.fmtDuration)((0,x.clock)()-d);if(!e.outfile)a.info($.green(e.outdir?`Wrote to dir ${e.outdir} (${C})`:`Finished (write=false, ${C})`));else{let b=e.outfile;if(e.sourcemap&&e.sourcemap!="inline"&&e.write!==!1){let oe=J.extname(e.outfile);b=`${J.join(J.dirname(e.outfile),J.basename(e.outfile,oe))}.{${oe.substr(1)},${oe.substr(1)}.map}`;let pe={sourcesContent:void 0,sourceRoot:J.relative(J.dirname(e.outfile),e.cwd)};e.outfileIsTemporary&&(pe.sourceRoot=".",pe.sources=me=>me&&me.map(Ge=>J.relative(process.cwd(),Ge))),Fn(e.outfileAbs+".map",pe)}let F=0;try{F=ne.statSync(e.outfileAbs).size}catch(oe){}e.outfileIsTemporary||a.info($.green(`Wrote ${b}`)+` (${(0,x.fmtByteSize)(F)}, ${C})`)}return h.warnings=m.warnings,h.errors=[],m.metafile&&(h.metafile=m.metafile),_(h,!0)}function k(d,m){a.debug("esbuild finished with error:",m?m.stack||m:null);let C=m.warnings||[],b=m.errors||[];return b.length==0&&(a.error(m.message),b.push({text:String(m),location:null})),jr(C),h.warnings=C,h.errors=b,_(h,!1)}async function I(d){if(e.watch&&e.clear&&g(),e.onStart)try{let b=e.onStart(e,d,t);b instanceof Promise&&await b}catch(b){throw a.debug(()=>`error in onStart handler: ${b.stack||b}`),b}if(e.isCancelled)return;a.debug(()=>`invoking esbuild.build() in ${process.cwd()} with options: ${(0,x.repr)(p)}`);let m=process.cwd();process.chdir(e.cwd);let C=Er.build(p);return process.chdir(m),C.then(S.bind(null,(0,x.clock)()),k.bind(null,(0,x.clock)()))}let T=n.diag?null:I([]),[E,B]=u!=="off"?jn(u,n,e):[null,!1];E&&!B&&(E.catch(d=>(a.error(d.stack||String(d)),!1)),t.addCancelCallback(()=>{E.cancel()}),R.diag&&e.watch&&e.clear&&te.clear());let L=!0;if(T&&(a.debug("awaiting esbuild"),L=await T,e.isCancelled))return!1;if(e.watch){let d=function(){let m=h.metafile||{};if(!m.inputs||Object.keys(m.inputs).length==0){m.inputs={};for(let C of e.entryPoints)m.inputs[C]={bytes:0,imports:[]}}return m};return await Xe().watchFiles(e,d,t,m=>{let C=m.map(F=>J.relative(e.cwd,F)),b=m.length;return a.info(`${b} ${b>1?"files":"file"} changed: ${C.join(", ")}`),I(m)}),a.debug("fswatch ended"),!0}if(E){let d=null;L?(a.debug("awaiting eslint"),!B&&!n.diag&&(d=setTimeout(()=>a.info("Waiting for TypeScript... (^C to skip)"),1e3)),L=await E.catch(()=>!1)):(a.debug("cancelling eslint since esbuild reported an error"),E.cancel()),clearTimeout(d)}if(!e.isCancelled&&!L&&Fr(),L){let d=await gr();process.exitCode=d}return L}var $r=new Map;function jn(e,t,r){let n=e,o={};if(e&&typeof e=="object"&&(n=void 0,o=e,o.mode=="off"))return a.debug(()=>'tslint disabled by tslint config {mode:"off"}'),[null,!1];r.tsrules&&r.tsrules.length&&(a.info("The 'tsrules' property is deprecated. Please use 'tslint.rules' instead"),o.rules={...r.tsrules,...o.rules});let i=t.diag&&r.watch&&r.clear,s=be(r),l=`${s||r.cwd}`,u=$r.get(l);if(u)return a.debug(()=>"tslint sharing process (no new process created)"),[u,!0];let c={colors:$.ncolors>0,quiet:r.quiet,mode:n,...o,watch:r.watch,cwd:r.cwd,clearScreen:i,srcdir:dt(r.entryPoints[0]),tsconfigFile:s,onRestart(){a.debug("tsc restarting")}};a.debug(()=>`starting tslint with options ${(0,x.repr)(c)}`);let g=nt(c);return $r.set(l,g),[g,!1]}function jr(e){e.length>0&&a.warn("[warn] "+e.map(t=>t.text).join(`
`))}function $n(){return vr({[Ue]:1}).catch(e=>{console.error(le.red(K+": "+(e?e.stack||e:"error")));let t=process.exitCode||0;process.exit(t>0?t:1)}).then(e=>{let t=process.exitCode||0;process.exit(e||t>0?t:1)})}function Rr(){R["no-color"]&&(R.color=!1),R["no-diag"]&&(R.diag=!1),a.colorMode=R.color,$.reconfigure(process.stdout,R.color),le.reconfigure(process.stderr,R.color),R.color!==void 0,R["estrella-version"]&&(console.log("estrella 1.3.2"),process.exit(0)),R["estrella-debug"]&&(a.level=a.DEBUG),R.diag&&R.run&&(a.info("Disabling -run since -diag is set"),R.run=void 0),a.debug(()=>`Parsed initial CLI arguments: ${(0,x.repr)({options:R,args:V},2)}`)}module.id=="."||process.mainModule&&Ir(process.mainModule.filename||"")=="estrella.js"?([R,V]=Oe(process.argv.slice(2),In),Rr(),$n()):([R,V]=Oe(process.argv.slice(2),{...we,unknownFlagAsArg:!0,help(e,t,r){ft=new Promise(n=>{process.nextTick(()=>{console.log(Je(e,we.usage,we.trailer)),process.exit(0),n()})})}}),Rr(),V.length>0&&ft.then(()=>{V.length>0&&ze(V)}),R.parse=(...e)=>{a.debug(()=>`Parsing custom CLI arguments ${(0,x.json)(V.join)} via cliopts.parse(`+(0,x.repr)(e)+")");let t=Oe(V,{...we,flags:we.flags.concat(e)});return a.debug(()=>"Parsed extra CLI arguments: "+(0,x.json)({options:t[0],args:t[1]},2)),V.splice(0,V.length),t});function Ar(e,t,r){return Xe().watch(e,t,r)}function Rn(e,t,r,n){return a.info(()=>"estrella.watchdir is deprecated. Please use estrella.watch instead"),n===void 0&&(r===void 0?(n=t,r={}):(n=r,r={...r,filter:t},r.recursive!==void 0&&(r.recursive||(r.depth=0),delete r.recursive))),Ar(e,r,n)}var pt;module.exports={version:"1.3.2",prog:K,cliopts:R,cliargs:V,dirname:dt,basename:Ir,watch:Ar,watchdir:Rn,scandir:Sr,tslint:nt,defaultTSRules:rt,termStyle:ke,stdoutStyle:$,stderrStyle:le,chmod:A.chmod,editFileMode:A.editMode,fmtDuration:x.fmtDuration,tildePath:x.tildePath,findInPATH:x.findInPATH,tsconfig:_e,tsconfigFile:be,glob:fe.glob,globmatch:fe.match,file:A,sha1:De,log:a,get ts(){return pt===void 0&&(pt=hr()),pt},build:vr};
//# sourceMappingURL=estrella.js.map
