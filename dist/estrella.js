#!/usr/bin/env node
var Hr=Object.create;var _e=Object.defineProperty,Kr=Object.defineProperties,zr=Object.getOwnPropertyDescriptor,Jr=Object.getOwnPropertyDescriptors,Vr=Object.getOwnPropertyNames,Pt=Object.getOwnPropertySymbols,Xr=Object.getPrototypeOf,Ct=Object.prototype.hasOwnProperty,Zr=Object.prototype.propertyIsEnumerable;var Tt=(e,t,r)=>t in e?_e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,q=(e,t)=>{for(var r in t||(t={}))Ct.call(t,r)&&Tt(e,r,t[r]);if(Pt)for(var r of Pt(t))Zr.call(t,r)&&Tt(e,r,t[r]);return e},be=(e,t)=>Kr(e,Jr(t)),Qr=e=>_e(e,"__esModule",{value:!0});var en=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),tn=(e,t)=>{for(var r in t)_e(e,r,{get:t[r],enumerable:!0})},rn=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Vr(t))!Ct.call(e,o)&&(r||o!=="default")&&_e(e,o,{get:()=>t[o],enumerable:!(n=zr(t,o))||n.enumerable});return e},_=(e,t)=>rn(Qr(_e(e!=null?Hr(Xr(e)):{},"default",!t&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var $t=en(Rt=>{var _t=Object.defineProperty,nn=e=>_t(e,"__esModule",{value:!0}),on=(e,t)=>{nn(e);for(var r in t)_t(e,r,{get:t[r],enumerable:!0})};on(Rt,{PatternError:()=>ce,glob:()=>ln,match:()=>ze});var{readdirSync:Et,statSync:He}=require("fs"),ae=(()=>{try{return require("path").sep}catch{return"/"}})(),K=ae.charCodeAt(0),sn=ae==":"?/\:+/g:ae=="\\"?/\\+/g:/\/+/g,Ee=process.platform=="win32",ce=class extends Error{constructor(){super("bad pattern")}};function ln(e){if(e.indexOf("**")<0)return Ke(e);let t=[],r=new Set;return kt("",e.split(/\*{2,}/),0,t,r),t}var an=Ee?e=>{if(e.length<2)return 0;let t=e[0];return e[1]==":"&&("a"<=t&&t<="z"||"A"<=t&&t<="Z")?2:0}:e=>0,un=Ee?(e,t)=>{let r=t(e);return e==""?[0,"."]:r+1==e.length&&It(e,e.length-1)?[r+1,e]:r==e.length&&e.length==2?[r,e+"."]:(r>=e.length&&(r=e.length-1),[r,e.substr(0,e.length-1)])}:(e,t)=>e==""?[t,"."]:e==ae?[t,e]:[t,e.substr(0,e.length-1)];function It(e,t){return e.charCodeAt(t)===K}function dn(e){let t=e.length-1,r=t;for(;e.charCodeAt(r)===K;)r--;return r!=t?e.substr(0,r+1):e}function cn(e){let t=0,r=t;for(;e.charCodeAt(r)===K;)r++;return r!=t?e.substr(r):e}function kt(e,t,r,n,o){r>=t.length&&(r=t.length-1);let i=t[r],s=i;r===0?i.charCodeAt(i.length-1)!=K&&(s+="*"):r===t.length-1?i.charCodeAt(0)!=K&&(s="*"+s):(i.charCodeAt(0)!=K&&(s="*"+s),i.charCodeAt(i.length-1)!=K&&(s+="*"));function l(g){return o.has(g)?!1:(o.add(g),!0)}function d(g){let x=g,S=x.lastIndexOf(ae);S!=-1&&(x=x.substr(S+1));let A=Math.min(r+1,t.length-1),G=t.slice(A).join("*");G.charCodeAt(0)==K?G=cn(G):G[0]!="*"&&(G="*"+G),ze(G,x)&&n.push(g)}e&&(s[0]!=ae?s=e+ae+s:s=e+s);let u=!1;s.charCodeAt(s.length-1)===K&&(u=!0,s=dn(s));let c=Ke(s);for(let g of c)He(g).isDirectory()?l(g)&&fn(g,(S,A)=>{l(S)&&(A.isDirectory()?kt(S,t,r+1,n,o):d(S))}):!u&&l(g)&&d(g);return n}function fn(e,t){e=gn(e);let r=He(e);r.isDirectory()&&Ft(e,t,new Set([r.ino]))}function Ft(e,t,r){for(let n of Et(e)){let o=At(e,n),i=Je(o),s=t(o,i);(s||s===void 0)&&i&&i.isDirectory()&&!r.has(i.ino)&&(r.add(i.ino),Ft(o,t,r))}}function Ke(e){let t=[];if(!vt(e))return Je(e)?[e]:t;let r=an(e),n=e.length-1;for(;n>=r&&!It(e,n);)n--;let o=e.substr(0,n+1),i=e.substr(n+1);if([r,o]=un(o,r),!vt(o.substr(r)))Ot(o,i,t);else{if(o==e)throw new ce;let s=Ke(o);for(let l of s)Ot(l,i,t)}return t}function Ot(e,t,r){let n=Je(e);if(n===null||!n.isDirectory())return;let o;try{o=Et(e)}catch{return}o.sort();for(let i of o)ze(t,i)&&r.push(At(e,i))}function vt(e){for(let t=0;t<e.length;++t)switch(e.charCodeAt(t)){case 42:case 63:case 91:case 123:return!0}return!1}function pn(e,t){for(let r=0;r<e.length;++r)if(e.charCodeAt(r)===t)return!0;return!1}function ze(e,t){e:for(;e.length>0;){let r=!1,n="",o=e;if([r,n,e]=mn(e),r&&n=="")return!pn(t,K);let[i,s]=Bt(n,t);if(s&&(i.length==0||e.length>0)){t=i;continue}if(r){for(let l=0;l<t.length&&t.charCodeAt(l)!=K;l++)if([i,s]=Bt(n,t.substr(l+1)),s){if(e.length==0&&i.length>0)continue;t=i;continue e}}return!1}return t.length==0}function mn(e){let t=!1;for(;e.length>0&&e.charCodeAt(0)==42;)e=e.substr(1),t=!0;let r=!1,n=0>>0;e:for(;n<e.length;n++)switch(e.charCodeAt(n)){case 92:Ee||n+1<e.length&&n++;break;case 91:r=!0;break;case 93:r=!1;break;case 42:if(!r)break e;break}return[t,e.substr(0,n),e.substr(n)]}function Bt(e,t){for(;e.length>0;){if(t.length==0)return["",!1];switch(e.charCodeAt(0)){case 91:{let o=t.codePointAt(0),i=o<=65535?1:2;if(t=t.substr(i),e=e.substr(1),o.toString(16),e.length==0)throw new ce;let s=e.charCodeAt(0)==94;s&&(e=e.substr(1));let l=!1,d=0;for(;;){if(e.length>0&&e.charCodeAt(0)==93&&d>0){e=e.substr(1);break}let u,c,g=e;if([c,e,u]=jt(e),!u)return["",!1];let x=c;if(e.charCodeAt(0)==45&&([x,e,u]=jt(e.substr(1)),!u))return["",!1];c<=o&&o<=x&&(l=!0),d++}if(l==s)return["",!1];break}case 63:if(t.charCodeAt(0)==K)return["",!1];let r=t.codePointAt(0),n=r<=65535?1:2;t=t.substr(n),e=e.substr(1);break;case 92:if(!Ee&&(e=e.substr(1),e.length==0))throw new ce;default:if(e.charCodeAt(0)!=t.charCodeAt(0))return e[0],t[0],e.charCodeAt(0).toString(16),t.charCodeAt(0).toString(16),["",!1];t=t.substr(1),e=e.substr(1);break}}return[t,!0]}function jt(e){let t=0,r="",n=e.charCodeAt(0);if(e.length==0||n==45||n==93)throw new ce;if(n==92&&!Ee&&(e=e.substr(1),e.length==0))throw new ce;t=e.codePointAt(0);let o=t<=65535?1:2;if(t==65535&&o==1)throw new ce;if(r=e.substr(o),r.length==0)throw new ce;return[t,r,!0]}function Je(e){try{return He(e)}catch{}return null}function At(e,t){return e=="."||e==""?t:e+ae+t}function gn(e){let t=e.length-1,r=t;for(;r&&e.charCodeAt(r)===K;)--r;return r!=t&&(e=e.substr(0,r+1)),e.split(sn).join(ae)}});var $r=_(require("esbuild")),te=_(require("fs"));var he=_(require("path")),ye=_($t());function Lt(e,t,r){}Lt.throws=!1;global.assert=Lt;var Vt=_(require("path"));var re=_(require("fs")),V=_(require("path")),Ie=_(require("os")),Wt=require("perf_hooks");function Mt(e,t){let r=0;if(t===!0){let n=process.env.TERM||"";r=n&&["xterm","screen","vt100"].some(o=>n.indexOf(o)!=-1)?n.indexOf("256color")!=-1?8:4:2}else t!==!1&&e.isTTY&&(r=e.getColorDepth());return r}function Be(e,t){return Nt(Mt(e,t),t)}function Nt(e,t){let r=i=>`\x1B[${i}m`,n=e>0||t?(i,s)=>{let l=r(i),d=r(s);return u=>l+u+d}:i=>s=>s,o=e>=8?(i,s,l)=>{let d="\x1B["+s+"m",u="\x1B["+l+"m";return c=>d+c+u}:e>0?(i,s,l)=>{let d="\x1B["+i+"m",u="\x1B["+l+"m";return c=>d+c+u}:(i,s,l)=>d=>d;return{_hint:t,ncolors:e,reset:t||e>0?"e[0m":"",bold:n("1","22"),italic:n("3","23"),underline:n("4","24"),inverse:n("7","27"),white:o("37","38;2;255;255;255","39"),grey:o("90","38;5;244","39"),black:o("30","38;5;16","39"),blue:o("34","38;5;75","39"),cyan:o("36","38;5;87","39"),green:o("32","38;5;84","39"),magenta:o("35","38;5;213","39"),purple:o("35","38;5;141","39"),pink:o("35","38;5;211","39"),red:o("31","38;2;255;110;80","39"),yellow:o("33","38;5;227","39"),lightyellow:o("93","38;5;229","39"),orange:o("33","38;5;215","39"),reconfigure(i,s){let l=Mt(i,s);return l!=this.ncolors&&s!=this._hint&&Object.assign(this,Nt(l,s)),this}}}var R=Be(process.stdout),ue=Be(process.stderr);var Dt=require("util"),$=(e,t,r)=>JSON.stringify(e,r,t),ne=()=>Wt.performance.now(),ge=process.platform.startsWith("win"),xe=Symbol("TYPE");function Ve(e){try{return require(e)}catch{return null}}Ve.resolve=e=>{try{return require.resolve(e)}catch{return""}};var je=module.id=="."||process.mainModule.filename==__filename;function N(e,t){let r={colors:R.ncolors>0};return typeof t=="object"?r=q({},t):t!==void 0&&(r.compact=!t),(0,Dt.inspect)(e,r)}var Xe="";function Ae(){return Xe||(Xe=re.realpathSync.native(Ie.tmpdir())),Xe}function Re(e){return e>=59500?(e/6e4).toFixed(0)+"min":e>=999.5?(e/1e3).toFixed(1)+"s":e.toFixed(2)+"ms"}function Ut(e){return e>=1024*1e3?(e/(1024*1e3)).toFixed(1)+"MB":e>=1e3?(e/1024).toFixed(1)+"kB":e+"B"}function $e(e){let t=ge?4294967295:re.constants.X_OK,r=new Set((process.env.PATH||"").split(V.delimiter));for(let n of r){let o=V.join(V.resolve(n),e);for(ge&&(o+=".cmd");;){try{let i=re.statSync(o);if(i.isSymbolicLink()){o=re.realpathSync.native(o);continue}else if(i.isFile()&&i.mode&t)return o}catch{if(ge&&o.endsWith(".cmd")){o=V.join(V.resolve(n),e)+".exe";continue}}break}}return null}function Ze(e,t){try{return JSON.parse($)}catch{return require("vm").runInNewContext("("+e+")",{},{filename:t,displayErrors:!0})}}function Gt(e){let t=re.readFileSync(e,"utf8");try{return Ze(t)}catch(r){throw new Error(`failed to parse ${e}: ${r.message||r}`)}}function qt(e){let t=Ie.homedir();return e=="~"?t:e.startsWith("~"+V.sep)?t+e.substr(1):e}function fe(e){let t=V.resolve(e),r=Ie.homedir();return t.startsWith(r)?"~"+t.substr(r.length):t}var Yt=require("console");var z=_(require("path"));var X=(()=>{let e=process.env._,t=process.argv[1];if(!t)return e||process.argv[0];if(e&&!z.isAbsolute(e))return e;let r="";if(e){let n=z.basename(process.execPath);e.endsWith(z.sep+n)&&(r=n+" ")}if(t.startsWith(process.cwd())){let n=z.relative(process.cwd(),t);if(!n.startsWith("node_modules"+z.sep)&&n.indexOf(z.sep+"node_modules"+z.sep)==-1)return z.sep=="/"&&(n="./"+n),n}return r+z.basename(t)})();function Le(e,t){let[r,n]=hn(t.flags.filter(u=>u)),o={},i=!1,s=[],l=0,d=()=>{s.push(e.splice(l,1)[0]),l--};for(;l<e.length;l++){let u=e[l];if(u=="--"){l++;break}if(u[0]!="-"||u=="-"){d();continue}u=u.replace(/^\-+/,"");let c=u.indexOf("="),g;c!=-1&&(g=u.substr(c+1),u=u.substr(0,c));let x=r.get(u);if(!x){if(u=="h"||u=="help")i=!0,t.help||(console.log(et(n,t.usage,t.trailer)),process.exit(0));else if(t.unknownFlagAsArg){d();continue}else Qe([e[l]]);break}let S=!0;if(x.valueName){if(g===void 0)if(g=e[l+1],g!==void 0&&g[0]!="-")l++;else{console.error(`missing value for option -${u} (see ${X} -help)`),process.exit(1);break}try{S=x.valueParser?x.valueParser(g):g}catch(A){console.error(`invalid value for option -${u} (${A.message})`)}}else g!==void 0&&(console.error(`unexpected value provided for flag -${u}`),process.exit(1));o[u]=S;for(let A of x.names)A!=u&&(o[A]=S)}return l<e.length&&(s=s.concat(e.slice(l))),i&&t.help&&t.help(n,o,s),[o,s]}function Qe(e){console.error(`unknown option${e.length>1?"s":""} ${e.join(", ")} (see ${X} -help)`),process.exit(1)}function hn(e){let t=new Map,r=[];for(let n of e){let o=yn(n);r.push(o);for(let i of o.names){if(t.has(i))throw new Error(`duplicate CLI flag ${$(i)} in definition ${$(n)}`);t.set(i,o)}}return[t,r]}function yn(e){let t=o=>o.replace(/(?:^|[\s,])\-+/g,""),r=o=>o.split(/\s*,\s*/);if(typeof e=="string")return{names:r(t(e))};let n={names:typeof e[0]=="string"?r(t(e[0])):e[0].map(t),description:e[1]||void 0};if(e[2]){let[o,i]=e[2].replace(/^[<>]+|[<>]+$/g,"").split(/:/,2);if(i)switch(i.toLowerCase()){case"string":case"str":i="string";break;case"bool":case"boolean":i="boolean",n.valueParser=s=>(s=s.toLowerCase(),s!="false"&&s!="0"&&s!="no"&&s!="off");break;case"number":case"num":case"float":case"int":i="number",n.valueParser=s=>{let l=Number(s);if(isNaN(l))throw new Error(`${$(s)} is not a number`);return l};break;default:throw new Error(`invalid argument type "${i}"`)}else i="string";n.valueName=o||i,n.valueType=i}return n}function et(e,t,r){let n={prog:X,"0":X},o=s=>s.replace(/\$(\w+)/g,(l,d)=>{let u=n[d];if(!u)throw new Error(`unknown variable $${d} (to print a dollar sign, use '\\$')`);return u}),i=o(t?typeof t=="function"?t():String(t):e.length>0?"Usage: $prog [options]":"Usage: $prog");if(e.length>0){i+=`
options:
`;let s=0,l=[];for(let d of e){let u="  -"+(d.valueName?d.names.join("=,-")+"="+(d.valueType=="boolean"?"on|off":"<"+d.valueName+">"):d.names.join(", -"));s=Math.max(s,u.length),l.push(u)}for(let d=0;d<e.length;d++){let u=e[d],c=l[d],g=u.description;u.description||(g=u.valueType?"Set ":"Enable "+u.names.reduce((x,S)=>S.length>x.length?S:x,"")),i+=`${c.padEnd(s," ")}  ${g}`,d+1<e.length&&(i+=`
`)}}return r&&(i+=`
`+o(r.replace(/[\n\s]+$/,""))),i}var we=console,tt,pe=new class{constructor(){this.SILENT=-1;this.ERROR=0;this.WARN=1;this.INFO=2;this.DEBUG=3;this.level=2;this.infoOnce=this.info;this.debug=xn}error(...t){pe.level>=0&&(Me(t),we.error(ue.red(`${X}:`),...t))}warn(...t){pe.level>=1&&(Me(t),we.error(ue.magenta(`${X}:`),...t))}info(...t){pe.level>=2&&(Me(t),we.log(...t))}get colorMode(){return tt}set colorMode(t){tt!==t&&(tt=t,t===void 0?we=console:we=new Yt.Console({stdout:process.stdout,stderr:process.stderr,colorMode:t}))}},a=pe;function Me(e){typeof e[0]=="function"&&(e[0]=e[0]())}function xn(...e){if(pe.level>=3){let t="";if(Me(e),e.length==0||e.length==1&&(e[0]===""||e[0]===void 0))return;we.log(R.bold(R.blue(`[DEBUG${t}]`)),...e)}}var ot={};tn(ot,{_ts_check_file:()=>Pn,file:()=>j,fileModificationLog:()=>rt,fileModificationLogAppend:()=>Se,fileWasModifiedRecentlyByUser:()=>Sn,scandir:()=>nt});var Y=_(require("fs")),H=_(require("path")),Jt=_(require("crypto"));var oe=_(require("fs"));var Ht=String.fromCharCode,wn=(e,t)=>e.charCodeAt(t||0);function Kt(e,t){if(typeof t=="number")return oe.chmodSync(e,t),t;let r=oe.statSync(e).mode,n=Ne(r,t);return r!=n&&oe.chmodSync(e,n),n}function zt(e,t){return new Promise((r,n)=>{if(typeof t=="number")return oe.chmod(e,t,o=>{o?n(o):r(t)});oe.stat(e,(o,i)=>{if(o)return n(o);let s=Ne(i.mode,t);if(i.mode==s)return r(s);oe.chmod(e,s,l=>{l?n(l):r(s)})})})}function Ne(e,t){let r="Expected format: [ugoa]*[+-=][rwx]+",n=(i,s)=>new Error(`${i} in modifier ${$(s)}. ${r}`),o=[];for(let i of Array.isArray(t)?t:[t])o=o.concat(i.trim().split(/\s*,+\s*/));for(let i of o){let s=[],l=!1,d=0,u=0;for(let g=0;g<i.length;g++){let x=wn(i,g);if(d==0)switch(x){case 117:case 103:case 111:l||s.push(x);break;case 97:s=[117,103,111],l=!0;break;case 43:case 45:case 61:d=x;break;default:if(d==0)throw n(`Invalid target or operation ${$(Ht(x))}`,i);break}else switch(x){case 114:u|=4;break;case 119:u|=2;break;case 120:u|=1;break;default:throw n(`Invalid permission ${$(Ht(x))}`,i)}}if(d==0)throw n("Missing operation",i);s.length==0&&(s=[117]),u==0&&(u=4|2|1);let c=0;for(let g of s)switch(g){case 117:c|=u<<6;break;case 103:c|=u<<3;break;case 111:c|=u;break}switch(d){case 43:e|=c;break;case 45:e&=~c;break;case 61:e=c;break}}return e}var Q=Y.promises,rt={};function Se(e){rt[H.resolve(String(e))]=ne()}function Sn(e){let t=3e4,r=rt[H.resolve(e)];return r!==void 0&&ne()-r<=t}var Pn=j;function j(e,t){return Q.readFile(e,t)}j.editMode=Ne;j.chmod=(e,t)=>(Se(e),zt(e,t));function Cn(e,t){return Q.readFile(e,t)}j.read=Cn;function Tn(e,t){return Y.readFileSync(e,t)}j.readSync=Tn;j.stat=Q.stat;function _n(...e){return Promise.all(e.map(t=>Q.stat(t).then(r=>r.mtimeMs).catch(r=>null))).then(t=>t.length==1?t[0]:t)}j.mtime=_n;j.readall=(...e)=>Promise.all(e.map(t=>Q.readFile(t)));j.readallText=(e,...t)=>Promise.all(t.map(r=>Q.readFile(r,{encoding:e||"utf8"})));j.write=async(e,t,r)=>{Se(e);let n=r&&typeof r=="object"?r:{};try{await Q.writeFile(e,t,r)}catch(o){if(!n.mkdirOff&&o.code=="ENOENT")await j.mkdirs(H.dirname(String(e)),n.mkdirMode),await Q.writeFile(e,t,r);else throw o}if(n.log){let o=H.relative(process.cwd(),String(e));o.startsWith(".."+H.sep)&&(o=fe(e)),a.info(R.green(`Wrote ${o}`))}};j.writeSync=(e,t,r)=>{Se(e),Y.writeFileSync(e,t,r)};function En(e,t){return new Promise((r,n)=>{let o=Y.createReadStream(e),i=Jt.createHash("sha1");o.on("error",n),o.on("end",()=>{i.end(),r(t?i.digest(t):i.digest())}),o.pipe(i)})}j.sha1=En;j.copy=(e,t,r)=>{let n=Y.constants.COPYFILE_FICLONE;return r&&(n|=Y.constants.COPYFILE_EXCL),Se(t),Q.copyFile(e,t,n)};j.move=(e,t)=>(Se(t),Q.rename(e,t));j.mkdirs=(e,t)=>Q.mkdir(e,{recursive:!0,mode:t}).then(r=>!!r&&r.length>0);async function nt(e,t,r){if(r||(r={}),!Y.promises||!Y.promises.opendir)throw new Error("scandir not implemented for nodejs <12.12.0");let n=[],o=new Set,i=r.recursive!==void 0?r.recursive?1/0:0:r.depth!==void 0?r.depth:1/0;async function s(d,u,c){if(o.has(d))return;o.add(d);let g=await Y.promises.opendir(d);for await(let x of g){let S=x.name;x.isDirectory()?i<c&&await s(H.join(d,S),H.join(u,S),c+1):(x.isFile()||x.isSymbolicLink())&&t&&t.test(S)&&n.push(H.join(u,S))}}let l=Array.isArray(e)?e:[e];return Promise.all(l.map(d=>s(H.resolve(d),".",0))).then(()=>n.sort())}var In=__dirname;function Xt(e){let t=null;return function(){return t||(pe.debug(`loading ${e} module`),t=Ve(Vt.join(In,e)),t.initModule(pe.level,ot)),t}}var Pe=Xt("debug.js"),it=Xt("watch.js");var de=class extends Error{constructor(t){super(t);this.name="UserError"}};function Zt(e,t){return Pe().bugReportMessage(e,t)}function Qt(e,t){return Pe().printErrorAndExit(e,t)}function er(e,t){Error.prepareStackTrace=void 0;try{if(Pe().installSourceMapSupport(),Error.prepareStackTrace!==er)return Error.prepareStackTrace(e,t)}catch{}return e.stack||String(e)}Error.prepareStackTrace=er;process.on("uncaughtException",Qt);process.on("unhandledRejection",(e,t)=>{Qt(e||"PromiseRejection","unhandledRejection")});var Io=Symbol("isMemoized");var tr=!!process.stdout.isTTY,kn=!!process.stderr.isTTY,ie={width:60,height:20,clear(){},banner(e){return e||(e="-"),e.repeat(Math.floor((ie.width-1)/e.length))}};if(tr||kn){let e=tr&&process.stdout||process.stderr,t=()=>{ie.width=e.columns,ie.height=e.rows};e.on("resize",t),t(),ie.clear=()=>{e.write("\x1Bc")}}var Fe=_(require("path"));var sr=require("child_process");var U=_(require("path")),rr=_(require("fs"));var nr=Symbol("TS_CONFIG_FILE"),or=Symbol("TS_CONFIG"),{dirname:Fn,basename:Bo}=U;function ir(e){let t="",r=process.cwd(),n=ge?"tsc.cmd":"tsc";e&&process.chdir(e);try{t=require.resolve("typescript")}catch{}if(e&&process.chdir(r),t){let o=U.sep+"node_modules"+U.sep,i=t.indexOf(o);if(i!=-1)return U.join(t.substr(0,i+o.length-U.sep.length),".bin",n)}return n}function lt(e,t){for(let r of at(e,t))try{if(rr.statSync(r).isFile())return r}catch{}return null}function*at(e,t){e=U.resolve(e);let r=U.parse(e).root;for(t=t?U.resolve(t):r;yield U.join(e,"tsconfig.json"),!(e==t||(e=Fn(e),e==r)););}function ut(e){let t=e.cwd||process.cwd();if(e.entryPoints&&Object.keys(e.entryPoints).length>0){let r="";if(Array.isArray(e.entryPoints))r=e.entryPoints[0];else for(let n of Object.keys(e.entryPoints)){r=e.entryPoints[n];break}t=U.resolve(t,U.dirname(r))}return t}function Ce(e){let t=e[nr];if(t===void 0){if(e.tslint==="off"||e.tslint===!1||e.tsc==="off"||e.tsc===!1)t=null;else{let r=ut(e);t=lt(r,e.cwd)}Object.defineProperty(e,nr,{value:t})}return t}function ke(e){let t=e[or];if(t===void 0){let r=Ce(e);if(r)try{t=Gt(r)}catch(n){a.warn(()=>`failed to parse ${r}: ${n.stack||n}`)}t||(t=null),Object.defineProperty(e,or,{value:t})}return t}var{dirname:vn,basename:Do}=Fe,dt={6031:"IGNORE",6194:"IGNORE",6133:"WARNING",2531:"WARNING",7006:"WARNING",7015:"WARNING",7053:"WARNING"},lr=0,ar=1,ur=2,Bn=3,dr={IGNORE:lr,INFO:ar,WARNING:ur,ERROR:Bn};function cr(e,t){for(let r of Object.keys(t)){let n=dr[String(t[r]).toUpperCase()];if(n===void 0)throw new de(`Invalid value for TS rule ${r}: ${$(n)} -- expected value to be one of: `+Object.keys(dr).map($).join(", "));e[r]=n}}function ct(e){e||(e={});let t={cancelled:!1,cancel(){}},r=new Promise((n,o)=>{if(e.mode=="off")return n(!0);let i=e.cwd||process.cwd(),s=e.tsconfigFile;if(s===void 0&&(s=lt(e.srcdir?Fe.resolve(i,e.srcdir):i)),e.mode!="on"&&!s)return n(!0);let l=e.format?e.format.toLowerCase():"",d=l.startsWith("short"),u=l.startsWith("short"),c=l=="short-all",g=ir(e.cwd);if(g=="tsc"&&e.mode!="on"&&!(g=$e(g)))return a.warn("tsc not found in node_modules or PATH. However a tsconfig.json file was found in "+Fe.relative(process.cwd(),vn(s))+'. Set tslint options.tslint="off" or pass -no-diag on the command line to disable tsc.'),n(!0);let x={};cr(x,dt),e.rules&&cr(x,e.rules);let S=["--noEmit",e.colors&&"--pretty",e.watch&&"--watch",s&&"--project",s].concat(e.args||[]).filter(b=>b);a.debug(()=>`spawning process ${g} ${$(S,2)}`);let A=(0,sr.spawn)(g,S,{stdio:["inherit","pipe","inherit"],cwd:i}),G=()=>{try{A.kill()}catch{}};process.on("exit",G),t.cancel=()=>{A.kill()};let p=b=>b,y=R.orange,h=R.red,I=R.green,E=Buffer.from(" TS"),C=Buffer.from("Found "),k=Buffer.from("\x1Bc"),v=Buffer.from("tarting compilation"),D=Buffer.from("tarting incremental compilation"),M=[],J=0,m=!1,f={errors:0,warnings:0,other:0,reset(){this.errors=0,this.warnings=0,this.other=0}},w=!1;function T(){if(!e.quiet||f.errors>=0){e.watch&&console.log(ie.banner("\u2014"));let b=[];f.errors>0?b.push(h("TS: "+se("$ error","$ errors",f.errors))):b.push(I("TS: OK")),f.warnings>0&&b.push(y(se("$ warning","$ warnings",f.warnings))),f.other>0&&b.push(se("$ message","$ messages",f.other)),console.log(b.join("   ")),e.watch&&console.log(ie.banner("\u2014"))}m=f.errors>0,e.onEnd&&e.onEnd(f),f.reset(),w=!0}function P(b){let O=M.slice();if(M.length=0,J==0){let B=0,W=O[B++];for(;W.length==0||W[0]==10&&B<O.length;)W=O[B++];if(W.includes(v)||W.includes(D))return f.reset(),b&&T();if(O.every(le=>le.length<=1))return b&&T()}else{let B=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m|)/g,W=O.shift().toString("utf8");switch(x[J]){case lr:return b&&T();case ar:W=W.replace(B,p("info")),d?O=[]:F(O,p),f.other++;break;case ur:W=W.replace(B,y("warning")),u?O=[]:F(O,y),f.warnings++;break;default:c&&(O=[]),B.test(W)?f.errors++:f.other++;break}process.stdout.write(W)}O.forEach(B=>process.stdout.write(B)),b&&T()}function F(b,O){for(let B=1;B<b.length;B++){let W=b[B];if(W.includes(126)){let le=W.toString("utf8");le=le.replace(/\x1b\[\d+m(\s*~+)/g,O("$1")),b[B]=le}}}function se(b,O,B){return(B==1?b:O).replace(/\$/g,B)}An(A.stdout,(b,O)=>{if(e.clearScreen||(b=St(b)),O){b.length>0&&M.push(b),M.length>0&&P();return}if(w&&b.length>1&&(w=!1,e.onRestart&&e.onRestart()),b.includes(C)){let B=me(b.toString("utf8"));if(/^(?:\[[^\]]+\] |[\d\:PAM \-]+|)Found \d+ error/.test(B)){P(!0),J=0;return}else P(!1);J=0}else if(b.includes(E)){let B=b.toString("utf8"),W=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m\x1b\[\d+m|) TS(\d+)\:/.exec(B),le=W?parseInt(W[1]):0;le>0&&!isNaN(le)&&(M.length>0&&P(),J=le)}M.push(b)}),A.on("close",b=>{process.removeListener("exit",G),n(!m)});function me(b){return b.replace(/\x1b\[\d+m/g,"")}function St(b){let O=b.indexOf(k);return O==-1?b:O==0?b.subarray(3):Buffer.concat([b.subarray(0,O),b.subarray(O+3)],b.length-3)}});return r.cancel=()=>(t.cancelled||(t.cancelled=!0,t.cancel()),r),r}var jn=Buffer.allocUnsafe(0);function An(e,t){let r=[],n=0,o=s=>{let l=0;for(;;){let d=s.indexOf(10,l);if(d==-1){if(l<s.length-1){let c=s.subarray(l);r.push(c),n+=c.length}break}d++;let u=s.subarray(l,d);n>0&&(u=Buffer.concat(r.concat(u),n+u.length),r.length=0,n=0),t(u,!1),l=d}},i=()=>{r.length>0?t(Buffer.concat(r,n),!0):t(jn,!0)};e.on("data",o),e.on("close",i),e.on("end",i)}var _r=_(require("fs"));var ee=_(require("fs")),xr=_(require("os")),wr=_(require("child_process")),Sr=require("stream");function fr(e){return e&&e.read}function pr(e){return e&&e.write}var ft=Buffer.allocUnsafe(0);function mr(e){return e&&typeof e=="object"&&e[xe]=="Reader"}function We(e){return e?new gr(e):Rn}function pt(e){return e?{[xe]:"Writer",stream:e}:$n}var qo,Rn=new class{constructor(){this[qo]="Reader"}_E(){return new Error("stream not readable")}get stream(){throw this._E()}[(qo=xe,Symbol.asyncIterator)](){throw this._E()}read(){return Promise.reject(this._E())}},Yo,yr,$n=new(yr=class{constructor(){this[Yo]="Writer"}_E(){return new Error("stream not writable")}get stream(){throw this._E()}},Yo=xe,yr),Ho,gr=class{constructor(t){this[Ho]="Reader";this._ended=!1;this.stream=t,t.pause(),t.once("end",()=>{this._ended=!0})}[(Ho=xe,Symbol.asyncIterator)](){return this.stream[Symbol.asyncIterator]()}async read(t,r){let n=this.stream;if(n.pause(),typeof t=="string")r=t,t=Number.MAX_SAFE_INTEGER;else if(t==null||t<0)t=Number.MAX_SAFE_INTEGER;else if(t==0)return r?"":ft;if(n.readable){let l=n.read(this._ended?void 0:t);if(l)return r?l.toString(r):l}if(this._ended)return r?"":ft;let o=[],i=0;if(n.readable){let l=n.read();l&&(o.push(l),i+=l.length)}for(;i<t&&!this._ended;){await new Promise((d,u)=>{n.once("error",u),n.once("end",d),n.once("readable",d)});let l=n.read(t-i);l||(l=n.read()),l&&(o.push(l),i+=l.length)}let s=hr(o);return r?s.toString(r):s}};function hr(e,t){return e.length==0?ft:e.length==1?e[0]:Buffer.concat(e,t)}function mt(){let e=[],t=0,r=e.push;return e.push=n=>(t+=n.length,r.call(e,n)),e.buffer=()=>hr(e,t),e}function gt(e){return Pe().libuv_errors[e]||""}function br(e,t,r){let n=setTimeout(()=>{let o=new Error("timeout");o.name="Timeout",r(o)},t);return e.then(o=>(clearTimeout(n),o),o=>{throw clearTimeout(n),o})}var Pr="process not started",De=class{constructor(t,...r){this.dir="";this.env=q({},process.env);this.shell=!1;this.stdin=null;this.stdout=null;this.stderr=null;this.extraFiles=[];this.windowsHide=!0;this.process=null;this.running=!1;this.pid=0;this.exitCode=-1;this._resolve=()=>{};this._reject=()=>{};this._onerror=t=>{a.debug(()=>`${this} error:
${t.stack||t}`),this._reject(t)};this._onexit=(t,r)=>{let n=this;a.debug(()=>`${n} exited status=${t} signal=${r}`),n.running=!1,t===null||r!==null?(assert(typeof r=="string"),n.exitCode=-(xr.constants.signals[r]||1)):n.exitCode=t||0,n._resolve(n.exitCode)};this.command=t,this.args=r,this.promise=Promise.reject(new Error(Pr)),this.promise.catch(n=>{})}start(){return null}run(t){return this.start(),this.wait(t)}output(t,r){this.stdout="pipe",this.stderr||(this.stderr="pipe");let{stdout:n,stderr:o}=this.start(),i=mt(),s=mt();return n.stream.on("data",l=>{i.push(l)}),o&&o.stream.on("data",l=>{s.push(l)}),this.wait(r||0).then(l=>{if(l!=0){let u="",c=s.buffer();try{u=c.toString("utf8")}catch{u=c.toString("ascii")}throw u.length>0&&(u=`. stderr output:
`+u),new Error(`command exited with status ${l}${u}`)}let d=i.buffer();return t?d.toString(t):d})}wait(t,r){return t===void 0||t<=0?this.promise:this._waitTimeout(t,(n,o,i)=>(a.debug(()=>`${this} wait timeout reached; killing process`),n.message="Cmd.wait timeout",this.kill(r).then(()=>i(n))))}signal(t,r){let n=this._checkproc();if(r=="group")try{return process.kill(-n.pid,t),!0}catch{}return n.kill(t)}async kill(t="SIGTERM",r=500,n){let o=this._checkproc();return this.signal(t,n||"group")?r<=0?this.promise:this._waitTimeout(r,(i,s)=>(a.debug(()=>`${this} kill timeout reached; sending SIGKILL`),o.kill("SIGKILL"),this.promise.then(s))):o.exitCode||0}toString(){return this.process?`Cmd[${this.pid}]`:"Cmd"}_checkproc(){if(!this.process)throw new Error(Pr);return this.process}_rejectAndKill(t){this._reject(t)}_waitTimeout(t,r){return new Promise((n,o)=>{let i=!1;return this.promise.then(s=>{i||n(s)}),br(this.promise,t,s=>{i=!0,r(s,n,o)})})}};De.prototype.start=function(){let t=this;if(t.running)throw new Error("start() called while command is running");t.exitCode=-1,t.promise=new Promise((l,d)=>{t._resolve=l,t._reject=d});let r=null,n=null;t.stdin instanceof Buffer?r="pipe":mr(t.stdin)?typeof t.stdin.stream.fd=="string"?r=t.stdin.stream:(r="pipe",n=t.stdin.stream):r=t.stdin;let o={stdio:[r||"ignore",t.stdout===process.stdout?1:t.stdout||"ignore",t.stderr===process.stderr?2:t.stderr?t.stderr:"ignore",...t.extraFiles],cwd:t.dir?qt(t.dir):void 0,env:t.env,shell:t.shell,windowsHide:t.windowsHide,detached:!ge},i=wr.spawn(t.command,t.args,o);if(i.pid===void 0){t.process=null,t.pid=0;let l=Mn(t);throw t._reject(l),l}if(t.running=!0,t.process=i,t.pid=i.pid,i.on("exit",t._onexit),i.on("error",t._reject),a.debug(()=>`${t} started (${N(t.command)})`),i.stdin)if(t.stdin instanceof Buffer){let l=new Sr.PassThrough;l.end(t.stdin),l.pipe(i.stdin),i.stdin=null}else n&&(n.pipe(i.stdin),i.stdin=null);return!i.stdin&&!i.stdout&&!i.stderr&&i.stdio.length<4?null:{stdin:i.stdin?pt(i.stdin):null,stdout:i.stdout?We(i.stdout):null,stderr:i.stderr?We(i.stderr):null,extraFiles:i.stdio.slice(3).map(l=>fr(l)?We(l):pr(l)?pt(l):null)}};function Mn(e){let t="",r="unspecified error";if(e.shell==!1){try{ee.accessSync(e.dir,ee.constants.R_OK|ee.constants.X_OK),(ee.statSync(e.command).mode&ee.constants.S_IFREG)==0?t="EACCES":t="EIO"}catch(o){t=o.code||"ENOENT"}r=gt(t)||r}if(!t){try{ee.accessSync(e.dir,ee.constants.R_OK|ee.constants.X_OK),t="EIO"}catch(o){t=o.code||"ENOENT"}r=gt(t)||r,t&&(r=r+"; cmd.dir="+N(e.dir))}t||(t="UNKNOWN");let n=new Error(`failed to spawn process ${N(e.command)} (${t} ${r})`);return n.code=t,n}var ht=_(require("fs")),Cr=_(require("os")),Tr=new Map;function Oe(e,t){let r=o=>ht.writeSync(process.stderr.fd,o+`
`),n=Tr.get(e);if(n)n.listeners.add(t);else{let o=new Set([t]),i=s=>{s=="SIGINT"&&ht.writeSync(1,`
`);try{for(let l of o)l(s)}catch(l){r(`error in signal listener: ${l.stack||l}`)}process.exit(-(Cr.constants.signals[s]||1))};process.on(e,i),Tr.set(e,{rootListener:i,listeners:o})}}var Er=!1,Ir=!1,Ue=new Set;function Wn(){if(Er)return;Er=!0,process.on("beforeExit",t=>yt(!1)),process.on("exit",t=>yt(!1));let e=t=>yt(!1);Oe("SIGINT",e),Oe("SIGHUP",e),Oe("SIGTERM",e),Oe("SIGPIPE",e)}function yt(e){if(Ir)return;Ir=!0;let t=r=>_r.writeSync(process.stderr.fd,r+`
`);try{for(let r of Ue)if(r.cmd.running)try{r.cmd.signal("SIGTERM")}catch{}Ue.clear()}catch(r){t(`ignoring error in run.atexit: ${r.stack||r}`)}}function kr(e){if(!e.run)return;a.debug(()=>`run.configure run=${N(e.run)}`);let t=new Or(e);Ue.add(t);let r=e.onEnd;e.onEnd=async(n,o,i)=>{let s;return typeof r=="function"&&(s=r(n,o,i),s instanceof Promise&&(s=await s)),await t.onEndBuild(o),s},Wn()}function Fr(){return Promise.all(Array.from(Ue).map(e=>e.cmd.promise)).then(e=>e.reduce((t,r)=>Math.max(t,r),0))}var Or=class{constructor(t){this._logOnExit=!0;if(this.config=t,this.cmd=new De(""),this.cmd.stdout="inherit",this.cmd.stderr="inherit",this.cmd.env.ESTRELLA_PATH=__filename,this.cmd.env.ESTRELLA_VERSION="1.4.1",typeof t.run=="string")this.cmd.command=t.run,this.cmd.shell=!0,this.cmdname=t.run;else if(typeof t.run=="boolean"){if(!t.outfile)throw new de("please set config.outfile=<file> or config.run=<file>");this.cmd.command=process.execPath,this.cmd.args=[t.outfileAbs],this.cmdname=t.outfile}else{if(!t.run||t.run.length==0)throw new de("config.run is an empty list");this.cmd.command=t.run[0],this.cmd.args=t.run.slice(1),this.cmdname=t.run.join(" "),this.cmdname.length>60&&(this.cmdname=this.cmdname.substr(0,57)+"...")}}async onEndBuild(t){if(t.errors.length>0)return;let r=this.cmd,n=R.pink,o=r.running;r.running&&(this._logOnExit=!1,a.debug(()=>`Stopping ${this.cmdname} [${r.pid}] ...`),await r.kill()),a.debug(()=>`Starting command ${N([r.command,...r.args])}`),r.start(),this.config.watch&&(a.info(()=>n(`${o?"Restarted":"Running"} ${this.cmdname} [${r.pid}]`)),this._logOnExit=!0,r.promise.then(i=>{this._logOnExit&&a.info(()=>n(`${this.cmdname} exited (${i})`))}))}};function vr(e){let t=e;if(!t){a.debug("typescript API requested; attempting to load typescript module");try{let p=require;if(t=p("typescript"),parseFloat(t.versionMajorMinor)<3.5)return a.warn(`typescript ${t.version} is too old; disabling "ts" API.
  You are seeing this message because you are importing the ts API.
  Either install a more recent version of typescript or remove the ts import.`),null;a.debug(()=>`loaded typescript ${t.version} from ${fe(p.resolve("typescript"))}`)}catch{return a.debug(()=>"failed to load typescript; module unavailable"),null}}let r=new Map;function n(p){let y=$(Object.keys(p).sort().map(C=>[C,p[C]])),h=r.get(y);if(h)return a.debug("ts.getCompilerHost cache hit"),h;p=q({newLine:t.NewLineKind.LineFeed},p);let E=[t.createCompilerHost(p,!0),p];return r.set(y,E),a.debug("ts.getCompilerHost cache miss"),E}async function o(p,y){let h=typeof p=="string"?{"/<source>/a.ts":p}:p,I=Object.keys(h),[E,C]=n(y||{}),k=E.readFile;E.readFile=M=>M in h?h[M]:k(M);let v=t.createProgram(I,C,E);if(typeof p=="string")return v.getSourceFile(I[0]);let D={};for(let M of I)D[M]=v.getSourceFile(M);return D}async function i(p,y){return s(p,y)}function s(p,y){let[h,I]=n(y||{}),C=t.createProgram([p],I,h).getSourceFile(p);if(!C)throw new Error(`${p}: file not found`);return C}function l(p,y,h){return d(p,[y],h).then(I=>I[0])}async function d(p,y,h){let I=s(p,h);return u(I,y)}function u(p,y){let h=S(p),I=new Map,E=[];for(let C of y||h.keys()){let k=h.get(C);if(!k){E.push(null);continue}E.push(c(p,k,h,I))}return E}function c(p,y,h,I){let E=I.get(y);if(E)return E;let C={heritage:[],name:y.name.escapedText,props:{},computedProps(){let k={};for(let v of C.heritage)Object.assign(k,v.props);return Object.assign(k,C.props),k},lookupProp(k){let v=C.props[k];if(!v){for(let D of C.heritage)if(v=D.lookupProp(k))break}return v}};if(I.set(y,C),y.heritageClauses)for(let k of y.heritageClauses)for(let v of k.types){let D=v.expression;if(t.isIdentifier(D)){let M=h.get(D.escapedText);M&&C.heritage.push(c(p,M,h,I))}}return y.forEachChild(k=>{if(t.isPropertySignature(k)){let v=g(k,p,C);C.props[v.name]=v}}),C}function g(p,y,h){let I=t.getLineAndCharacterOfPosition(y,p.pos),E=null,C=p.type,v={name:x(p.name),type:C,get typestr(){return E===null&&(E=C?G(C,y):"any"),Object.defineProperty(v,"typestr",{enumerable:!0,value:E}),E},srcfile:y.fileName,srcline:I.line,srccol:I.character,parent:h};return v}function x(p){switch(p.kind){case t.SyntaxKind.Identifier:case t.SyntaxKind.PrivateIdentifier:return p.escapedText;case t.SyntaxKind.StringLiteral:case t.SyntaxKind.NumericLiteral:return p.text;case t.SyntaxKind.ComputedPropertyName:return"[computed]";default:return"?"}}function S(p){let y=new Map;return t.forEachChild(p,h=>{h.kind==t.SyntaxKind.InterfaceDeclaration&&y.set(h.name.escapedText,h)}),y}let A=t.createPrinter({removeComments:!0,newLine:t.NewLineKind.LineFeed,omitTrailingSemicolon:!0,noEmitHelpers:!0});function G(p,y){if(!y){let h=p;for(;h.kind!=t.SyntaxKind.SourceFile;)if(h=h.parent,!h)throw new Error("node without SourceFile parent (provide file to ts.fmt)");y=h}return A.printNode(t.EmitHint.Unspecified,p,y)}return{ts:t,getCompilerHost:n,parse:o,parseFile:i,interfaceInfo:l,interfacesInfo:d,interfacesInfoAST:u,fmt:G}}var Br={version:"0.14.14",BuildOptions:new Set(["sourcemap","legalComments","sourceRoot","sourcesContent","format","globalName","target","drop","minify","minifyWhitespace","minifyIdentifiers","minifySyntax","charset","treeShaking","ignoreAnnotations","jsx","jsxFactory","jsxFragment","define","pure","keepNames","color","logLevel","logLimit","bundle","splitting","preserveSymlinks","outfile","metafile","outdir","outbase","platform","external","loader","resolveExtensions","mainFields","conditions","write","allowOverwrite","tsconfig","outExtension","publicPath","entryNames","chunkNames","assetNames","inject","banner","footer","incremental","entryPoints","stdin","plugins","absWorkingDir","nodePaths","watch"])},jr={BuildConfig:new Set(["entry","debug","watch","cwd","quiet","silent","clear","tslint","onStart","onEnd","outfileMode","run","tsc","tsrules","title"])};var ve=_(require("path"));var Ar=_(require("crypto"));function Ge(e,t){let r=Ar.createHash("sha1").update(e);return t?r.digest(t):r.digest()}function qn(e){return Object.keys(e).map(t=>t+":"+e[t])}function Rr(e,t){let r=!1,n=!1,o=!1,i=!1,s="";function l(c){let g=[c.cwd,c.outfile||"",...Array.isArray(c.entryPoints)?c.entryPoints:typeof c.entryPoints=="object"?qn(c.entryPoints):c.entryPoints?[c.entryPoints]:[]].join(ve.delimiter);return Yn(Ge(Buffer.from(g,"utf8")))}let d="",u=Object.create({get outfileAbs(){return s},setOutfile(c){u.outfile=c,s=c&&c!="-"?ve.resolve(u.cwd,c):""},get projectID(){return d},updateProjectID(){return d=l(u),d},get buildIsCancelled(){return r},set buildIsCancelled(c){r=c},get outfileIsTemporary(){return n},set outfileIsTemporary(c){n=c},get outfileCopyToStdout(){return o},set outfileCopyToStdout(c){o=c},get metafileIsTemporary(){return i},set metafileIsTemporary(c){i=c}});return Object.assign(u,e),u.cwd=e.cwd?ve.resolve(e.cwd):!je&&process.mainModule?process.mainModule.path:t,u.setOutfile(e.outfile||""),u.updateProjectID(),u}function Yn(e){let t="";for(let r=0;r<e.length;r+=4)t+=e.readUInt32LE(r).toString(36);return t}var{dirname:qe,basename:Hn}=he,Te={usage:"usage: $0 [options]",flags:[["-w, watch","Watch source files for changes and rebuild."],["-g, debug","Do not optimize and define DEBUG=true."],["-r, run","Run the output file after a successful build."],["-sourcemap","Generate sourcemap."],["-inline-sourcemap","Generate inline sourcemap."],["-no-color","Disable use of colors."],["-no-clear","Disable clearing of the screen, regardless of TTY status."],["-no-diag","Disable TypeScript diagnostics."],["-color","Color terminal output, regardless of TTY status."],["-diag","Only run TypeScript diagnostics (no esbuild.)"],["-quiet","Only log warnings and errors but nothing else."],["-silent","Don't log anything, not even errors."],["-estrella-version","Print version of estrella and exit 0."],["-estrella-debug","Enable debug logging of estrella itself."]]},Kn={usage:"usage: $0 [options] <srcfile> ...",flags:Te.flags.concat([["-o, outfile","Write output to <file> instead of stdout.","<file>"],["-bundle","Include all dependencies."],["-minify","Simplify and compress generated code."],["-outdir","Write output to <dir> instead of stdout.","<dir>"],["-esbuild","Pass arbitrary JSON to esbuild's build function.","<json>"]]),trailer:`
<srcfile> is a filename, or "-" for stdin.

Example of using estrella without a build script:
  $0 -o out/app.js main.ts
    This compile main.ts and writes the output to out/app.js

Example of using estrella with a build script:
  1. Create a file called build.js with the following contents:
       #!/usr/bin/env node
       const { build } = require("estrella")
       build({
         entry: "main.ts",
         outfile: "out/main.js",
       })
  2. Make that file executable and run it:
       chmod +x build.js
       ./build.js
  You can now customize your build behavior by changing build.js.
  Try ./build.js -help

See https://github.com/rsms/estrella#readme for documentation.
  `},bt=Promise.resolve(),L={},Z=[],Ye=Symbol("IS_MAIN_CALL");var Lr=!1;function Mr(e){if(!Lr){Lr=!0;let t=e||1;process.exitCode=t,process.on("exit",r=>{process.exit(r||t)})}}function xt(e){switch(typeof e){case"object":return Array.isArray(e)?e.length:Object.keys(e).length;case"string":return e.length;default:return 0}}function zn(e){if(a.debug(()=>`input config ${N(e)}`),e.entryPoints||(e.entryPoints=[]),e.entry)if(Array.isArray(e.entry))e.entryPoints=e.entryPoints.concat(e.entry);else if(typeof e.entry=="object"){if(e.entryPoints.length!=0)throw new de("Both config.entryPoints and .entry can not be set when .entry is an object");e.entryPoints=e.entry}else e.entryPoints.push(e.entry);if(delete e.entry,xt(e.entryPoints)==0&&!e.stdin&&(a.debug(()=>"missing entryPoints; attempting inference"),e.entryPoints=Nr(e),e.entryPoints.length==0)){let r=ke(e)?" (could not guess from tsconfig.json)":"";throw new de(`config.entryPoints is empty or not set${r}`)}if(e.sourcemap?e.sourcemap!="inline"&&e.sourcemap!="external"&&(e.sourcemap=!0):e.sourcemap=!1,!e.outfile&&!e.outdir){e.setOutfile("-");let r=e.updateProjectID();e.setOutfile(he.join(Ae(),`esbuild.${r}.out.js`)),e.outfileIsTemporary=!0}e.updateProjectID(),a.debug(()=>`effective config for project#${e.projectID}: ${N(e)}`)}function Jn(e,t){let r=ne(),n=JSON.parse(te.readFileSync(e));for(let o in t){let i=t[o];i===void 0?delete n[o]:(typeof i=="function"&&(i=i(n[o])),n[o]=i)}te.writeFileSync(e,JSON.stringify(n)),a.debug(()=>`patched source map ${e} with overrides ${N(t)} (${Re(ne()-r)})`)}function Nr(e){let t=ke(e);if(t){if(a.debug(()=>`tsconfig file found at ${Ce(e)}`),t.files)return t.files;if(t.include){let r=[];for(let n of t.include)a.debug(`guessing entry points: glob.glob(${n}) =>`,ye.glob(n)),r=r.concat(ye.glob(n));if(t.exclude)for(let n of t.exclude)r=r.filter(o=>!ye.match(n,o));return r.slice(0,1)}}return[]}function Vn(e){let t={},r={},n={name:"globalName"};for(let o of Object.keys(e))jr.BuildConfig.has(o)||(Br.BuildOptions.has(o)||(r[o]=e[o]),o=n[o]||o,t[o]=e[o]);return Object.keys(r).length>0&&a.info(`Notice: Potentially invalid esbuild.BuildOption(s): ${N(r)}
`+Zt("guess",$(Object.keys(r)))),t.outfile||delete t.outfile,t}var Wr=new Set;function Xn(...e){if(a.level>=a.INFO){let t=e.join(" ");Wr.has(t)||(Wr.add(t),a.info(...e))}}function Dr(e){e=Rr(e||{},e[Ye]?process.cwd():process.mainModule&&qe(process.mainModule.filename)||__dirname);let t={resolve(){},reject(){}},r=[];function n(l){e.isCancelled?l():r.push(l)}function o(l){if(!e.isCancelled){a.debug("build cancelled",{reason:l}),e.isCancelled=!0;for(let d of r)d&&d();r.length=0,l?t.reject(l):t.resolve(!0)}}let i={addCancelCallback:n,buildCounter:0,rebuild(){return a.warn("rebuild() called before initial build completed. Ignoring"),Promise.resolve(!0)}},s=bt.then(()=>new Promise((l,d)=>{if(e.isCancelled)return a.debug("build cancelled immediately"),!1;t.resolve=l,t.reject=d,Zn(e,i).then(l).catch(d)}));return s.rebuild=()=>i.rebuild(),Object.defineProperty(s,"buildCounter",{get(){return i.buildCounter}}),s.cancel=o,s}async function Zn(e,t){let r=Ye in e;delete e[Ye];let n=L,o=Z;if(e.run===void 0&&(e.run=n.run),e.outfile=="-"||n.outfile=="-"||r&&!n.outfile&&!n.outdir){e.setOutfile("-");let m=e.updateProjectID();n.outfile=he.join(Ae(),`esbuild.${m}.out.js`),e.setOutfile(n.outfile),e.outfileIsTemporary=!0,e.outfileCopyToStdout=!0}if(!r)zn(e);else{if(o.length==0)if(!process.stdin.isTTY)o=["-"];else{let m=Nr(e);a.debug(()=>`no input files provided; best guess: ${N(m)}`),m.length==0&&(a.error(`missing <srcfile> argument (see ${X} -help)`),process.exit(1)),o.splice(o.length-1,0,...m);let f=ke(e);!n.outfile&&!n.outdir&&f&&(n.outfile=f.outFile,n.outfile||(n.outdir=f.outDir)),o.length==0&&(a.error(`missing <srcfile> argument (see ${X} -help)`),process.exit(1))}if(o=o.filter(m=>m!="-"?!0:(e.stdin||(e.stdin={contents:te.readFileSync(0,"utf8"),sourcefile:"stdin",resolveDir:process.cwd(),loader:"ts"}),!1)),e.setOutfile(n.outfile||void 0),o.length>0&&(e.entryPoints=o),n.outdir&&(e.outdir=n.outdir),n.bundle&&(e.bundle=n.bundle),n.minify&&(e.minify=n.minify),n.esbuild){let m=Ze(n.esbuild,"-esbuild");if(!m||typeof m!="object")return a.error(`-esbuild needs a JS object, for example '{key:"value"}'. Got ${typeof m}.`),!1;a.debug(()=>`applying custom esbuild config ${N(m)}`);for(let f in m)e[f]=m[f]}}let i=e.debug=n.debug=!!(n.debug||e.debug),s=e.silent=n.silent=!!(n.silent||e.silent),l=e.quiet=n.quiet=s||!!(n.quiet||e.quiet);n.watch=!!(n.watch||e.watch),(!e.watch||typeof e.watch!="object")&&(e.watch=n.watch),e.color!==void 0&&(a.colorMode=e.color,R.reconfigure(process.stdout,e.color),ue.reconfigure(process.stderr,e.color)),l&&a.level<a.DEBUG&&(a.level=s?a.SILENT:a.WARN),e.sourcemap=n["inline-sourcemap"]?"inline":n.sourcemap?!0:e.sourcemap,e.outfileIsTemporary&&e.outfileCopyToStdout&&e.sourcemap===!0&&(e.sourcemap="inline"),e.clear=n["no-clear"]?!1:e.clear===void 0?!!process.stdout.isTTY:e.clear,a.debug(()=>`project directory ${N(e.cwd)} (config.cwd)`),e.title||(e.title=e.name||fe(e.cwd));let d=n.diag===!0?"on":n.diag===!1?"off":"auto";d!=="off"&&(!e.entryPoints||xt(e.entryPoints)==0)?(a.debug("disabling tslint (no entryPoints)"),d="off"):d!=="off"&&(e.tsc!==void 0&&(a.info("the 'tsc' property is deprecated. Please rename to 'tslint'."),e.tslint===void 0&&(e.tslint=e.tsc)),e.tslint&&e.tslint!=="auto"&&(d=e.tslint),d==="auto"||typeof d=="object"&&(e.tslint.mode==="auto"||!e.tslint.mode)?Ce(e)||(a.debug(()=>{let f=ut(e);return`skipping tslint in auto mode since no tsconfig.json file was found in project.
Tried the following filenames:${Array.from(at(f,e.cwd)).map(T=>`
  ${fe(T)}`)}`}),d="off"):e.tslint!==void 0&&e.tslint!=="auto"&&(d=e.tslint)),e.run&&kr(e);let u=0;function c(){ie.clear(),u=ne()}let g=!1,x=e.onEnd,S=x?async(m,f)=>{g=!0;let w;try{let P=x(e,m,t);w=P instanceof Promise?await P:P}catch(P){throw a.debug(()=>`error in onEnd handler: ${P.stack||P}`),P}finally{g=!1}return w===void 0?f:!!w}:(m,f)=>f;function A(m){let f=S;S=async(w,T)=>{let P=await m(w,T);return P!==void 0&&(T=P),f(w,T)}}e.outfileMode&&e.outfile&&A(async(m,f)=>{if(a.debug("onEnd chmod"),m.errors.length==0)try{Kt(e.outfileAbs,e.outfileMode)}catch(w){a.error("configuration error: outfileMode: "+w.message),Mr(1)}}),e.outfileCopyToStdout&&!e.run&&e.write!==!1&&A(async(m,f)=>{if(a.debug("onEnd copyToStdout"),m.errors.length==0)return new Promise((w,T)=>{let P=te.createReadStream(e.outfileAbs);P.on("end",()=>w(f)),P.on("error",T),P.pipe(process.stdout)})}),e.outfileIsTemporary&&!e.outfileCopyToStdout&&e.write!==!1&&A(async(m,f)=>{if(a.debug("onEnd load results"),m.js=te.readFileSync(e.outfile,{encoding:"utf8"}),e.sourcemap===!0){try{m.map=te.readFileSync(e.outfile+".map",{encoding:"utf8"})}catch(T){a.debug(`failed to load temporary source map at ${e.outfile}.map: ${T.stack||T}`)}let w=m.js.lastIndexOf(`
//# sourceMappingURL`);w!=-1&&(m.js=m.js.substr(0,w+1))}}),e.watch&&A(async(m,f)=>{Xn("Watching files for changes...")});let G=q({DEBUG:i?"true":"false"},e.define||{}),p=be(q({minify:!i,sourcemap:e.sourcemap,sourcesContent:!1,color:ue.ncolors>0,logLevel:a.level==a.DEBUG?"info":e.silent?"silent":e.quiet?"error":"warning"},Vn(e)),{define:G}),y=null,h={warnings:[],errors:[],metafile:null};if(e.watch){let m=e.projectID;if(p.incremental=!0,p.metafile=!0,(!p.outfile&&!p.outdir||p.write===!1)&&(p.outfile=he.join(Ae(),`esbuild.${m}.out.js`),e.outfileIsTemporary=!0,delete p.write),t.addCancelCallback(()=>{y&&y.rebuild&&y.rebuild.dispose()}),e.entryPoints&&xt(e.entryPoints)>0)if(h.metafile={inputs:{},outputs:{}},Array.isArray(e.entryPoints))for(let f of e.entryPoints)h.metafile.inputs[f]={};else for(let f of Object.keys(e.entryPoints)){let w=e.entryPoints[f];h.metafile.inputs[w]={}}}t.rebuild=()=>k([]).then(m=>(g&&a.warn("waiting for rebuild() inside onEnd handler may cause a deadlock"),m));function I(m,f){a.debug("esbuild finished with result",f),y=f,Gr(f.warnings||[]);let w=Re(ne()-m);if(!e.outfile)a.info(R.green(e.outdir?`Wrote to dir ${e.outdir} (${w})`:`Finished (write=false, ${w})`));else{let T=e.outfile;e.sourcemap&&e.outfileIsTemporary&&e.sourcemap!="inline"&&e.write!==!1&&Jn(e.outfileAbs+".map",{sources:F=>F&&F.map(se=>he.relative(e.cwd,se))});let P=0;try{P=te.statSync(e.outfileAbs).size}catch{}e.outfileIsTemporary||a.info(R.green(`Wrote ${T}`)+` (${Ut(P)}, ${w})`)}return h.warnings=f.warnings,h.errors=[],h.metafile=f.metafile||null,S(h,!0)}let E=!0;function C(m,f){a.debug("esbuild finished with error:",f?f.stack||f:null);let w=f.warnings||[],T=f.errors||[];return T.length==0&&(a.error(f.message),T.push({text:String(f),location:null})),Gr(w),h.warnings=w,h.errors=T,E?E=!1:h.metafile=null,S(h,!1)}async function k(m){e.watch&&e.clear&&c();let f=[];for(let F of m)if(F.type=="move"){let se=!1;if(Array.isArray(e.entryPoints)){let me=e.entryPoints?e.entryPoints.indexOf(F.name):-1;me!=-1&&(a.debug("detected entryPoint file rename",F.name,"->",F.newname),e.entryPoints[me]=F.newname,se=!0)}else for(let me of Object.keys(entryPoints))if(entryPoints[me]==F.name){entryPoints[me]=F.newname,se=!0;break}se&&(p.entryPoints=e.entryPoints,y=null),f.push(F.newname)}else f.push(F.name);if(e.entry=e.entryPoints,e.onStart)try{let F=e.onStart(e,f,t);F instanceof Promise&&await F}catch(F){throw a.debug(()=>`error in onStart handler: ${F.stack||F}`),F}if(e.isCancelled)return;let w=!!(y&&y.rebuild);a.debug(()=>`invoking ${w?"esbuildResult.rebuild":"esbuild.build"} in ${process.cwd()} with options: ${N(p)}`);let T=process.cwd();process.chdir(e.cwd);let P=w?y.rebuild():$r.build(p);return process.chdir(T),P.then(I.bind(null,ne()),C.bind(null,ne()))}let v=n.diag?null:k([]),[D,M]=d!=="off"?Qn(d,n,e):[null,!1];D&&!M&&(D.catch(m=>(a.error(m.stack||String(m)),!1)),t.addCancelCallback(()=>{D.cancel()}),L.diag&&e.watch&&e.clear&&ie.clear());let J=!0;if(v&&(a.debug("awaiting esbuild"),J=await v,e.isCancelled))return!1;if(e.watch){let m=function(){return h.metafile};return await it().watchFiles(e,m,t,f=>{let w=f.length,T=f.map(P=>P.type=="move"?P.newname:P.name);return a.info(`${w} ${w>1?"files":"file"} changed: ${T.join(", ")}`),k(f)}),a.debug("fswatch ended"),!0}if(D){let m=null;J?(a.debug("awaiting eslint"),!M&&!n.diag&&(m=setTimeout(()=>a.info("Waiting for TypeScript... (^C to skip)"),1e3)),J=await D.catch(()=>!1)):(a.debug("cancelling eslint since esbuild reported an error"),D.cancel()),clearTimeout(m)}if(!e.isCancelled&&!J&&Mr(),J){let m=await Fr();process.exitCode=m}return J}var Ur=new Map;function Qn(e,t,r){let n=e,o={};if(e&&typeof e=="object"&&(n=void 0,o=e,o.mode=="off"))return a.debug(()=>'tslint disabled by tslint config {mode:"off"}'),[null,!1];r.tsrules&&r.tsrules.length&&(a.info("The 'tsrules' property is deprecated. Please use 'tslint.rules' instead"),o.rules=q(q({},r.tsrules),o.rules));let i=t.diag&&r.watch&&r.clear,s=Ce(r),l=`${s||r.cwd}`,d=Ur.get(l);if(d)return a.debug(()=>"tslint sharing process (no new process created)"),[d,!0];let u=r.cwd;if(r.entryPoints)if(Array.isArray(r.entryPoints))r.entryPoints.length>0&&(u=qe(r.entryPoints[0]));else for(let x of Object.keys(r.entryPoints)){u=qe(r.entryPoints[x]);break}let c=be(q({colors:R.ncolors>0,quiet:r.quiet,mode:n},o),{watch:r.watch,cwd:r.cwd,clearScreen:i,srcdir:u,tsconfigFile:s,onRestart(){a.debug("tsc restarting")}});a.debug(()=>`starting tslint with options ${N(c)}`);let g=ct(c);return Ur.set(l,g),[g,!1]}function Gr(e){e.length>0&&a.warn("[warn] "+e.map(t=>t.text).join(`
`))}function eo(){return Dr({[Ye]:1}).catch(e=>{console.error(ue.red(X+": "+(e?e.stack||e:"error")));let t=process.exitCode||0;process.exit(t>0?t:1)}).then(e=>{let t=process.exitCode||0;process.exit(e||t>0?t:1)})}function qr(){L["no-color"]&&(L.color=!1),L["no-diag"]&&(L.diag=!1),a.colorMode=L.color,R.reconfigure(process.stdout,L.color),ue.reconfigure(process.stderr,L.color),L.color!==void 0,L["estrella-version"]&&(console.log("estrella 1.4.1"),process.exit(0)),L["estrella-debug"]&&(a.level=a.DEBUG),L.diag&&L.run&&(a.info("Disabling -run since -diag is set"),L.run=void 0),a.debug(()=>`Parsed initial CLI arguments: ${N({options:L,args:Z},2)}`)}je?([L,Z]=Le(process.argv.slice(2),Kn),qr(),eo()):([L,Z]=Le(process.argv.slice(2),be(q({},Te),{unknownFlagAsArg:!0,help(e,t,r){bt=new Promise(n=>{process.nextTick(()=>{console.log(et(e,Te.usage,Te.trailer)),process.exit(0),n()})})}})),qr(),Z.length>0&&bt.then(()=>{Z.length>0&&Qe(Z)}),L.parse=(...e)=>{a.debug(()=>`Parsing custom CLI arguments ${$(Z.join)} via cliopts.parse(`+N(e)+")");let t=Le(Z,be(q({},Te),{flags:Te.flags.concat(e)}));return a.debug(()=>"Parsed extra CLI arguments: "+$({options:t[0],args:t[1]},2)),Z.splice(0,Z.length),t});function Yr(e,t,r){return it().watch(e,t,r)}function to(e,t,r,n){return a.info(()=>"estrella.watchdir is deprecated. Please use estrella.watch instead"),n===void 0&&(r===void 0?(n=t,r={}):(n=r,r=be(q({},r),{filter:t}),r.recursive!==void 0&&(r.recursive||(r.depth=0),delete r.recursive))),Yr(e,r,n)}var wt;module.exports={version:"1.4.1",prog:X,cliopts:L,cliargs:Z,dirname:qe,basename:Hn,watch:Yr,watchdir:to,scandir:nt,tslint:ct,defaultTSRules:dt,termStyle:Be,stdoutStyle:R,stderrStyle:ue,chmod:j.chmod,editFileMode:j.editMode,fmtDuration:Re,tildePath:fe,findInPATH:$e,tsconfig:ke,tsconfigFile:Ce,glob:ye.glob,globmatch:ye.match,file:j,sha1:Ge,log:a,get ts(){return wt===void 0&&(wt=vr()),wt},build:Dr};
//# sourceMappingURL=estrella.js.map
