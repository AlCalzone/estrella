#!/usr/bin/env node
var Ge=Object.defineProperty,Cr=Object.prototype.hasOwnProperty,Tr=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),vr=e=>Ge(e,"__esModule",{value:!0}),kr=(e,t)=>{if(vr(e),typeof t=="object"||typeof t=="function")for(let r in t)!Cr.call(e,r)&&r!=="default"&&Ge(e,r,{get:()=>t[r],enumerable:!0});return e},E=e=>e&&e.__esModule?e:kr(Ge({},"default",{value:e,enumerable:!0}),e);var ft=Tr((ke,dt)=>{!function(e,t){typeof ke=="object"&&typeof dt!="undefined"?t(ke):typeof define=="function"&&define.amd?define(["exports"],t):t(e.miniglob={})}(ke,function(e){"use strict";const{readdirSync:t,statSync:r}=require("fs"),n=(()=>{try{return require("path").sep}catch(i){return"/"}})(),o=n.charCodeAt(0),a=n==":"?/\:+/g:n=="\\"?/\\+/g:/\/+/g,s=process.platform=="win32";class u extends Error{constructor(){super("bad pattern")}}const d=s?i=>{if(i.length<2)return 0;let c=i[0];return i[1]==":"&&("a"<=c&&c<="z"||"A"<=c&&c<="Z")?2:0}:i=>0,m=s?(i,c)=>{const y=c(i);return i==""?[0,"."]:y+1==i.length&&P(i,i.length-1)?[y+1,i]:y==i.length&&i.length==2?[y,i+"."]:(y>=i.length&&(y=i.length-1),[y,i.substr(0,i.length-1)])}:(i,c)=>i==""?[c,"."]:i==n?[c,i]:[c,i.substr(0,i.length-1)];function P(i,c){return i.charCodeAt(c)===o}function I(i,c){i=function(l){let p=l.length-1,h=p;for(;h&&l.charCodeAt(h)===o;)--h;return h!=p&&(l=l.substr(0,h+1)),l.split(a).join(n)}(i);let y=r(i);y.isDirectory()&&function l(p,h,g){for(let T of t(p)){let N=k(p,T),j=B(N),R=h(N,j);(R||R===void 0)&&j&&j.isDirectory()&&!g.has(j.ino)&&(g.add(j.ino),l(N,h,g))}}(i,c,new Set([y.ino]))}function v(i){let c=[];if(!G(i))return B(i)?[i]:c;let y=d(i),l=i.length-1;for(;l>=y&&!P(i,l);)l--;let p=i.substr(0,l+1),h=i.substr(l+1);if([y,p]=m(p,y),G(p.substr(y))){if(p==i)throw new u;const g=v(p);for(let T of g)$(T,h,c)}else $(p,h,c);return c}function $(i,c,y){const l=B(i);if(l===null)return;if(!l.isDirectory())return;let p;try{p=t(i)}catch(h){return}p.sort();for(let h of p)b(c,h)&&y.push(k(i,h))}function G(i){for(let c=0;c<i.length;++c)switch(i.charCodeAt(c)){case 42:case 63:case 91:case 123:return!0}return!1}function A(i,c){for(let y=0;y<i.length;++y)if(i.charCodeAt(y)===c)return!0;return!1}function b(i,c){e:for(;i.length>0;){let y=!1,l="";if([y,l,i]=x(i),y&&l=="")return!A(c,o);let[p,h]=C(l,c);if(!h||!(p.length==0||i.length>0)){if(y){for(let g=0;g<c.length&&c.charCodeAt(g)!=o;g++)if([p,h]=C(l,c.substr(g+1)),h){if(i.length==0&&p.length>0)continue;c=p;continue e}}return!1}c=p}return c.length==0}function x(i){let c=!1;for(;i.length>0&&i.charCodeAt(0)==42;)i=i.substr(1),c=!0;let y=!1,l=0;e:for(;l<i.length;l++)switch(i.charCodeAt(l)){case 92:s||l+1<i.length&&l++;break;case 91:y=!0;break;case 93:y=!1;break;case 42:if(!y)break e}return[c,i.substr(0,l),i.substr(l)]}function C(i,c){for(;i.length>0;){if(c.length==0)return["",!1];switch(i.charCodeAt(0)){case 91:{let l=c.codePointAt(0),p=l<=65535?1:2;if(c=c.substr(p),i=i.substr(1),l.toString(16),i.length==0)throw new u;let h=i.charCodeAt(0)==94;h&&(i=i.substr(1));let g=!1,T=0;for(;;){if(i.length>0&&i.charCodeAt(0)==93&&T>0){i=i.substr(1);break}let N,j;if([j,i,N]=F(i),!N)return["",!1];let R=j;if(i.charCodeAt(0)==45&&([R,i,N]=F(i.substr(1)),!N))return["",!1];j<=l&&l<=R&&(g=!0),T++}if(g==h)return["",!1];break}case 63:if(c.charCodeAt(0)==o)return["",!1];let y=c.codePointAt(0)<=65535?1:2;c=c.substr(y),i=i.substr(1);break;case 92:if(!s&&(i=i.substr(1)).length==0)throw new u;default:if(i.charCodeAt(0)!=c.charCodeAt(0))return i[0],c[0],i.charCodeAt(0).toString(16),c.charCodeAt(0).toString(16),["",!1];c=c.substr(1),i=i.substr(1)}}return[c,!0]}function F(i){let c=0,y="",l=i.charCodeAt(0);if(i.length==0||l==45||l==93)throw new u;if(l==92&&!s&&(i=i.substr(1)).length==0)throw new u;let p=(c=i.codePointAt(0))<=65535?1:2;if(c==65535&&p==1)throw new u;if((y=i.substr(p)).length==0)throw new u;return[c,y,!0]}function B(i){try{return r(i)}catch(c){}return null}function k(i,c){return i=="."||i==""?c:i+n+c}e.PatternError=u,e.glob=function(i){if(i.indexOf("**")<0)return v(i);let c=[],y=new Set;return function l(p,h,g,T,N){g>=h.length&&(g=h.length-1);let j=h[g],R=j;function ue(S){return!N.has(S)&&(N.add(S),!0)}function Ce(S){let _=S,O=_.lastIndexOf(n);O!=-1&&(_=_.substr(O+1));let H=Math.min(g+1,h.length-1),ce=h.slice(H).join("*");ce.charCodeAt(0)==o?ce=function(We){let ve=0;for(;We.charCodeAt(ve)===o;)ve++;return ve!=0?We.substr(ve):We}(ce):ce[0]!="*"&&(ce="*"+ce),b(ce,_)&&T.push(S)}g===0?j.charCodeAt(j.length-1)!=o&&(R+="*"):g===h.length-1?j.charCodeAt(0)!=o&&(R="*"+R):(j.charCodeAt(0)!=o&&(R="*"+R),j.charCodeAt(j.length-1)!=o&&(R+="*")),p&&(R=R[0]!=n?p+n+R:p+R);let Te=!1;R.charCodeAt(R.length-1)===o&&(Te=!0,R=function(S){let _=S.length-1,O=_;for(;S.charCodeAt(O)===o;)O--;return O!=_?S.substr(0,O+1):S}(R));let w=v(R);for(let S of w){let _=r(S);_.isDirectory()?ue(S)&&I(S,(O,H)=>{ue(O)&&(H.isDirectory()?l(O,h,g+1,T,N):Ce(O))}):!Te&&ue(S)&&Ce(S)}return T}("",i.split(/\*{2,}/),0,c,y),c},e.match=b,Object.defineProperty(e,"__esModule",{value:!0})})});function pt(e,t,r){}pt.throws=!1;global.assert=pt;function mt(e,t){let r=0;if(t===!0){let n=process.env.TERM||"";r=n&&["xterm","screen","vt100"].some(o=>n.indexOf(o)!=-1)?n.indexOf("256color")!=-1?8:4:2}else t!==!1&&e.isTTY&&(r=e.getColorDepth());return r}function Ee(e,t){return gt(mt(e,t),t)}function gt(e,t){const r=a=>`[${a}m`,n=e>0||t?(a,s)=>{const u=r(a),d=r(s);return m=>u+m+d}:a=>s=>s,o=e>=8?(a,s,u)=>{let d="["+s+"m",m="["+u+"m";return P=>d+P+m}:e>0?(a,s,u)=>{let d="["+a+"m",m="["+u+"m";return P=>d+P+m}:(a,s,u)=>d=>d;return{_hint:t,ncolors:e,reset:t||e>0?"e[0m":"",bold:n("1","22"),italic:n("3","23"),underline:n("4","24"),inverse:n("7","27"),white:o("37","38;2;255;255;255","39"),grey:o("90","38;5;244","39"),black:o("30","38;5;16","39"),blue:o("34","38;5;75","39"),cyan:o("36","38;5;87","39"),green:o("32","38;5;84","39"),magenta:o("35","38;5;213","39"),purple:o("35","38;5;141","39"),pink:o("35","38;5;211","39"),red:o("31","38;2;255;110;80","39"),yellow:o("33","38;5;227","39"),lightyellow:o("93","38;5;229","39"),orange:o("33","38;5;215","39"),reconfigure(a,s){const u=mt(a,s);return u!=this.ncolors&&s!=this._hint&&Object.assign(this,gt(u,s)),this}}}const M=Ee(process.stdout),se=Ee(process.stderr);const te=E(require("fs")),V=E(require("path")),we=E(require("os")),ht=E(require("perf_hooks")),bt=E(require("util")),L=(e,t,r)=>JSON.stringify(e,r,t),ae=()=>ht.performance.now(),Ue=process.platform.startsWith("win"),me=Symbol("TYPE"),yt=eval("require");function U(e,t){let r={colors:M.ncolors>0};return typeof t=="object"?r={...t}:t!==void 0&&(r.compact=!t),bt.inspect(e,r)}let ze="";function Ie(){return ze||(ze=te.realpathSync.native(we.tmpdir())),ze}function _e(e){return e>=59500?(e/6e4).toFixed(0)+"min":e>=999.5?(e/1e3).toFixed(1)+"s":e.toFixed(2)+"ms"}function wt(e){return e>=1024*1e3?(e/(1024*1e3)).toFixed(1)+"MB":e>=1e3?(e/1024).toFixed(1)+"kB":e+"B"}function Oe(e){const t=Ue?4294967295:te.constants.X_OK,r=new Set((process.env.PATH||"").split(V.delimiter));for(let n of r){let o=V.join(V.resolve(n),e);for(Ue&&(o+=".cmd");;){try{let a=te.statSync(o);if(a.isSymbolicLink()){o=te.realpathSync.native(o);continue}else if(a.isFile()&&a.mode&t)return o}catch(a){if(Ue&&o.endsWith(".cmd")){o=V.join(V.resolve(n),e)+".exe";continue}}break}}return null}function Ke(e,t){try{return JSON.parse(L)}catch(r){return require("vm").runInNewContext("("+e+")",{},{filename:t,displayErrors:!0})}}function Fe(e){const t=te.readFileSync(e,"utf8");try{return Ke(t)}catch(r){throw new Error(`failed to parse ${e}: ${r.message||r}`)}}function xt(e){const t=we.homedir();return e=="~"?t:e.startsWith("~"+V.sep)?t+e.substr(1):e}function le(e){const t=V.resolve(e),r=we.homedir();return t.startsWith(r)?"~"+t.substr(r.length):t}const Y=E(require("path")),X=(()=>{const e=process.env._,t=process.argv[1];if(!t)return e||process.argv[0];if(e&&!Y.isAbsolute(e))return e;let r="";if(e){const n=Y.basename(process.execPath);e.endsWith(Y.sep+n)&&(r=n+" ")}if(t.startsWith(process.cwd())){let n=Y.relative(process.cwd(),t);if(!n.startsWith("node_modules"+Y.sep)&&n.indexOf(Y.sep+"node_modules"+Y.sep)==-1)return Y.sep=="/"&&(n="./"+n),n}return r+Y.basename(t)})();function Be(e,t){let[r,n]=Er(t.flags.filter(m=>m)),o={},a=!1,s=[],u=0;const d=()=>{s.push(e.splice(u,1)[0]),u--};for(;u<e.length;u++){let m=e[u];if(m=="--"){u++;break}if(m[0]!="-"){d();continue}m=m.replace(/^\-+/,"");let P=m.indexOf("="),I;P!=-1&&(I=m.substr(P+1),m=m.substr(0,P));let v=r.get(m);if(!v){if(m=="h"||m=="help")a=!0,t.help||(console.log(He(n,t.usage,t.trailer)),process.exit(0));else if(t.unknownFlagAsArg){d();continue}else qe([e[u]]);break}let $=!0;if(v.valueName){if(I===void 0)if(I=e[u+1],I!==void 0&&I[0]!="-")u++;else{console.error(`missing value for option -${m} (see ${X} -help)`),process.exit(1);break}try{$=v.valueParser?v.valueParser(I):I}catch(G){console.error(`invalid value for option -${m} (${G.message})`)}}else I!==void 0&&(console.error(`unexpected value provided for flag -${m}`),process.exit(1));o[m]=$;for(let G of v.names){if(G==m)continue;o[G]=$}}return u<e.length&&(s=s.concat(e.slice(u))),a&&t.help&&t.help(n,o,s),[o,s]}function qe(e){console.error(`unknown option${e.length>1?"s":""} ${e.join(", ")} (see ${X} -help)`),process.exit(1)}function Er(e){let t=new Map,r=[];for(let n of e){let o=Ir(n);r.push(o);for(let a of o.names){if(t.has(a))throw new Error(`duplicate CLI flag ${L(a)} in definition ${L(n)}`);t.set(a,o)}}return[t,r]}function Ir(e){const t=o=>o.replace(/(?:^|[\s,])\-+/g,""),r=o=>o.split(/\s*,\s*/);if(typeof e=="string")return{names:r(t(e))};let n={names:typeof e[0]=="string"?r(t(e[0])):e[0].map(t),description:e[1]||void 0};if(e[2]){let[o,a]=e[2].replace(/^[<>]+|[<>]+$/g,"").split(/:/,2);if(a)switch(a.toLowerCase()){case"string":case"str":a="string";break;case"bool":case"boolean":a="boolean",n.valueParser=s=>(s=s.toLowerCase(),s!="false"&&s!="0"&&s!="no"&&s!="off");break;case"number":case"num":case"float":case"int":a="number",n.valueParser=s=>{let u=Number(s);if(isNaN(u))throw new Error(`${L(s)} is not a number`);return u};break;default:throw new Error(`invalid argument type "${a}"`)}else a="string";n.valueName=o||a,n.valueType=a}return n}function He(e,t,r){let n={prog:X,"0":X};const o=s=>s.replace(/\$(\w+)/g,(u,d)=>{let m=n[d];if(!m)throw new Error(`unknown variable $${d} (to print a dollar sign, use '\\$')`);return m});let a=o(t?typeof t=="function"?t():String(t):e.length>0?"Usage: $prog [options]":"Usage: $prog");if(e.length>0){a+=`
options:
`;let s=0,u=[];for(let d of e){let m="  -"+(d.valueName?d.names.join("=,-")+"="+(d.valueType=="boolean"?"on|off":"<"+d.valueName+">"):d.names.join(", -"));s=Math.max(s,m.length),u.push(m)}for(let d=0;d<e.length;d++){let m=e[d],P=u[d],I=m.description;m.description||(I=m.valueType?"Set ":"Enable "+m.names.reduce((v,$)=>$.length>v.length?$:v,"")),a+=`${P.padEnd(s," ")}  ${I}`,d+1<e.length&&(a+=`
`)}}return r&&(a+=`
`+o(r.replace(/[\n\s]+$/,""))),a}const St=E(require("console"));var re;(function(e){e[e.Error=0]="Error",e[e.Warn=1]="Warn",e[e.Info=2]="Info",e[e.Debug=3]="Debug"})(re||(re={}));let ge=console,Ye;const de=new class{constructor(){this.ERROR=0;this.WARN=1;this.INFO=2;this.DEBUG=3;this.level=2;this.infoOnce=this.info;this.debug=_r}error(...t){je(t),ge.error(se.red(`${X}:`),...t)}warn(...t){de.level>=1&&(je(t),ge.error(se.magenta(`${X}:`),...t))}info(...t){de.level>=2&&(je(t),ge.log(...t))}get colorMode(){return Ye}set colorMode(t){if(Ye===t)return;Ye=t,t===void 0?ge=console:ge=new St.Console({stdout:process.stdout,stderr:process.stderr,colorMode:t})}};var f=de;function je(e){typeof e[0]=="function"&&(e[0]=e[0]())}function _r(...e){if(de.level>=3){let t="";if(je(e),e.length==0||e.length==1&&(e[0]===""||e[0]===void 0))return;ge.log(M.bold(M.blue(`[DEBUG${t}]`)),...e)}}const Pt=E(require("path"));let Or=__dirname;function Ct(e){let t=null;return function(){return t||(de.debug(`loading ${e} module`),t=yt(Pt.join(Or,e)),t.initModule(de.level)),t}}const he=Ct("debug.js"),Je=Ct("watch.js");class fe extends Error{constructor(e){super(e);this.name="UserError"}}function Tt(e,t){return he().bugReportMessage(e,t)}function vt(e,t){return he().printErrorAndExit(e,t)}function kt(e,t){Error.prepareStackTrace=void 0;try{if(he().installSourceMapSupport(),Error.prepareStackTrace!==kt)return Error.prepareStackTrace(e,t)}catch(r){}return e.stack||String(e)}Error.prepareStackTrace=kt;process.on("uncaughtException",vt);process.on("unhandledRejection",(e,t)=>{vt(e||"PromiseRejection","unhandledRejection")});const kn=new Map,En=Symbol("isMemoized");const Et=!!process.stdout.isTTY,Fr=!!process.stderr.isTTY,ne={width:60,height:20,clear(){},banner(e){return e||(e="-"),e.repeat(Math.floor((ne.width-1)/e.length))}};if(Et||Fr){const e=Et&&process.stdout||process.stderr,t=()=>{ne.width=e.columns,ne.height=e.rows};e.on("resize",t),t(),ne.clear=()=>{e.write("c")}}const K=E(require("path")),It=E(require("fs")),_t=Symbol("TS_CONFIG_FILE"),Ot=Symbol("TS_CONFIG"),{dirname:Br,basename:Bn}=K;function Ft(e){let t="",r=process.cwd();e&&process.chdir(e);try{t=require.resolve("typescript")}catch(n){}finally{e&&process.chdir(r)}if(t){const n=K.sep+"node_modules"+K.sep;let o=t.indexOf(n);if(o!=-1)return K.join(t.substr(0,o+n.length-K.sep.length),".bin","tsc")}return"tsc"}function Xe(e,t){for(let r of Ve(e,t))try{const n=It.statSync(r);if(n.isFile())return r}catch(n){}return null}function*Ve(e,t){e=K.resolve(e);const r=K.parse(e).root;for(t=t?K.resolve(t):r;!(yield K.join(e,"tsconfig.json"),e==t);)if(e=Br(e),e==r)break}function Ze(e){let t=e.cwd||process.cwd();return e.entryPoints&&e.entryPoints.length>0&&(t=K.resolve(t,K.dirname(e.entryPoints[0]))),t}function be(e){let t=e[_t];if(t===void 0){if(e.tslint==="off"||e.tslint===!1||e.tsc==="off"||e.tsc===!1)t=null;else{let r=Ze(e);t=Xe(r,e.cwd)}Object.defineProperty(e,_t,{value:t})}return t}function xe(e){let t=e[Ot];if(t===void 0){const r=be(e);if(r)try{t=Fe(r)}catch(n){f.warn(()=>`failed to parse ${r}: ${n.stack||n}`)}t||(t=null),Object.defineProperty(e,Ot,{value:t})}return t}const Se=E(require("path")),Rn=E(require("fs")),Bt=E(require("child_process")),{dirname:jr,basename:Un}=Se,Qe={6031:"IGNORE",6194:"IGNORE",6133:"WARNING",2531:"WARNING",7006:"WARNING",7015:"WARNING",7053:"WARNING"},jt=0,Rt=1,At=2,Rr=3,$t={IGNORE:jt,INFO:Rt,WARNING:At,ERROR:Rr};function Nt(e,t){for(let r of Object.keys(t)){let n=$t[String(t[r]).toUpperCase()];if(n===void 0)throw new fe(`Invalid value for TS rule ${r}: ${L(n)} -- expected value to be one of: `+Object.keys($t).map(L).join(", "));e[r]=n}}function et(e){e||(e={});let t={cancelled:!1,cancel(){}},r=new Promise((n,o)=>{if(e.mode=="off")return n(!0);const a=e.cwd||process.cwd();let s=e.tsconfigFile;if(s===void 0&&(s=Xe(e.srcdir?Se.resolve(a,e.srcdir):a)),e.mode!="on"&&!s)return n(!0);const u=e.format?e.format.toLowerCase():"",d=u.startsWith("short"),m=u.startsWith("short"),P=u=="short-all";let I=Ft(e.cwd);if(I=="tsc"&&e.mode!="on"&&!(I=Oe(I)))return f.warn("tsc not found in node_modules or PATH. However a tsconfig.json file was found in "+Se.relative(process.cwd(),jr(s))+'. Set tslint options.tslint="off" or pass -no-diag on the command line to disable tsc.'),n(!0);const v={};Nt(v,Qe),e.rules&&Nt(v,e.rules);let $=["--noEmit",e.colors&&"--pretty",e.watch&&"--watch",s&&"--project",s].concat(e.args||[]).filter(w=>w);f.debug(()=>`spawning process ${I} ${L($,2)}`);const G=Bt.spawn(I,$,{stdio:["inherit","pipe","inherit"],cwd:a}),A=()=>{try{G.kill()}catch(w){}};process.on("exit",A),t.cancel=()=>{G.kill()};const b=w=>w,x=M.orange,C=M.red,F=M.green,B=Buffer.from(" TS"),k=Buffer.from("Found "),i=Buffer.from("c"),c=Buffer.from("tarting compilation"),y=Buffer.from("tarting incremental compilation"),l=[];let p=0,h=!1,g={errors:0,warnings:0,other:0,reset(){this.errors=0,this.warnings=0,this.other=0}},T=!1;function N(){if(!e.quiet||g.errors>=0){e.watch&&console.log(ne.banner("—"));let w=[];g.errors>0?w.push(C("TS: "+ue("$ error","$ errors",g.errors))):w.push(F("TS: OK")),g.warnings>0&&w.push(x(ue("$ warning","$ warnings",g.warnings))),g.other>0&&w.push(ue("$ message","$ messages",g.other)),console.log(w.join("   ")),e.watch&&console.log(ne.banner("—"))}h=g.errors>0,e.onEnd&&e.onEnd(g),g.reset(),T=!0}function j(w){let S=l.slice();if(l.length=0,p==0){let _=0,O=S[_++];for(;O.length==0||O[0]==10&&_<S.length;)O=S[_++];if(O.includes(c)||O.includes(y))return g.reset(),w&&N();if(S.every(H=>H.length<=1))return w&&N()}else{const _=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m|)/g;let O=S.shift().toString("utf8");switch(v[p]){case jt:return w&&N();case Rt:O=O.replace(_,b("info")),d?S=[]:R(S,b),g.other++;break;case At:O=O.replace(_,x("warning")),m?S=[]:R(S,x),g.warnings++;break;default:P&&(S=[]),_.test(O)?g.errors++:g.other++;break}process.stdout.write(O)}S.forEach(_=>process.stdout.write(_)),w&&N()}function R(w,S){for(let _=1;_<w.length;_++){let O=w[_];if(O.includes(126)){let H=O.toString("utf8");H=H.replace(/\x1b\[\d+m(\s*~+)/g,S("$1")),w[_]=H}}}function ue(w,S,_){return(_==1?w:S).replace(/\$/g,_)}Ar(G.stdout,(w,S)=>{if(e.clearScreen||(w=Te(w)),S){w.length>0&&l.push(w),l.length>0&&j();return}if(T&&w.length>1&&(T=!1,e.onRestart&&e.onRestart()),w.includes(k)){let _=Ce(w.toString("utf8"));if(/^(?:\[[^\]]+\] |[\d\:PAM \-]+|)Found \d+ error/.test(_)){j(!0),p=0;return}else j(!1);p=0}else if(w.includes(B)){const _=w.toString("utf8"),O=/(?:\x1b\[\d+m|)error(?:\x1b\[\d+m\x1b\[\d+m|) TS(\d+)\:/.exec(_);let H=O?parseInt(O[1]):0;H>0&&!isNaN(H)&&(l.length>0&&j(),p=H)}l.push(w)}),G.on("close",w=>{process.removeListener("exit",A),n(!h)});function Ce(w){return w.replace(/\x1b\[\d+m/g,"")}function Te(w){let S=w.indexOf(i);return S==-1?w:S==0?w.subarray(3):Buffer.concat([w.subarray(0,S),w.subarray(S+3)],w.length-3)}});return r.cancel=()=>(t.cancelled||(t.cancelled=!0,t.cancel()),r),r}const $r=Buffer.allocUnsafe(0);function Ar(e,t){let r=[],n=0;const o=s=>{let u=0;for(;;){let d=s.indexOf(10,u);if(d==-1){if(u<s.length-1){const P=s.subarray(u);r.push(P),n+=P.length}break}d++;let m=s.subarray(u,d);n>0&&(m=Buffer.concat(r.concat(m),n+m.length),r.length=0,n=0),t(m,!1),u=d}},a=()=>{r.length>0?t(Buffer.concat(r,n),!0):t($r,!0)};e.on("data",o),e.on("close",a),e.on("end",a)}const Nr=E(require("fs"));function Lt(e){return e&&e.read}function Mt(e){return e&&e.write}const tt=Buffer.allocUnsafe(0);function Dt(e){return e&&typeof e=="object"&&e[me]=="Reader"}function Re(e){return e?new Mr(e):Lr}function rt(e){return e?{[me]:"Writer",stream:e}:Dr}var Hn;const Lr=new class{constructor(){this[Hn]="Reader"}_E(){return new Error("stream not readable")}get stream(){throw this._E()}[(Hn=me,Symbol.asyncIterator)](){throw this._E()}read(){return Promise.reject(this._E())}};var Yn,Wt;const Dr=new(Wt=class{constructor(){this[Yn]="Writer"}_E(){return new Error("stream not writable")}get stream(){throw this._E()}},Yn=me,Wt);var Jn;class Mr{constructor(e){this[Jn]="Reader";this._ended=!1;this.stream=e,e.pause(),e.once("end",()=>{this._ended=!0})}[(Jn=me,Symbol.asyncIterator)](){return this.stream[Symbol.asyncIterator]()}async read(e,t){const r=this.stream;if(r.pause(),typeof e=="string")t=e,e=Number.MAX_SAFE_INTEGER;else if(e==null||e<0)e=Number.MAX_SAFE_INTEGER;else if(e==0)return t?"":tt;if(r.readable){let s=r.read(this._ended?void 0:e);if(s)return t?s.toString(t):s}if(this._ended)return t?"":tt;const n=[];let o=0;if(r.readable){const s=r.read();s&&(n.push(s),o+=s.length)}for(;o<e&&!this._ended;){await new Promise((u,d)=>{r.once("error",d),r.once("end",u),r.once("readable",u)});let s=r.read(e-o);s||(s=r.read()),s&&(n.push(s),o+=s.length)}const a=Gt(n);return t?a.toString(t):a}}function Gt(e,t){return e.length==0?tt:e.length==1?e[0]:Buffer.concat(e,t)}function nt(){const e=[];let t=0;const r=e.push;return e.push=n=>(t+=n.length,r.call(e,n)),e.buffer=()=>Gt(e,t),e}function ot(e){const t=he().libuv_errors;return t[e]||""}function Ut(e,t,r){const n=setTimeout(()=>{const o=new Error("timeout");o.name="Timeout",r(o)},t);return e.then(o=>(clearTimeout(n),o),o=>{throw clearTimeout(n),o})}const Q=E(require("fs")),zt=E(require("os")),Kt=E(require("child_process")),qt=E(require("stream")),Ht="process not started";class it{constructor(e,...t){this.dir="";this.env={...process.env};this.shell=!1;this.stdin=null;this.stdout=null;this.stderr=null;this.extraFiles=[];this.windowsHide=!0;this.process=null;this.running=!1;this.pid=0;this.exitCode=-1;this._resolve=()=>{};this._reject=()=>{};this._onerror=e=>{f.debug(()=>`${this} error:
${e.stack||e}`),this._reject(e)};this._onexit=(e,t)=>{const r=this;f.debug(()=>`${r} exited status=${e} signal=${t}`),r.running=!1,e===null||t!==null?(assert(typeof t=="string"),r.exitCode=-(zt.constants.signals[t]||1)):r.exitCode=e||0,r._resolve(r.exitCode)};this.command=e,this.args=t,this.promise=Promise.reject(new Error(Ht)),this.promise.catch(r=>{})}start(){return null}run(e){return this.start(),this.wait(e)}output(e,t){this.stdout="pipe",this.stderr||(this.stderr="pipe");const{stdout:r,stderr:n}=this.start(),o=nt(),a=nt();return r.stream.on("data",s=>{o.push(s)}),n&&n.stream.on("data",s=>{a.push(s)}),this.wait(t||0).then(s=>{if(s!=0){let d="";const m=a.buffer();try{d=m.toString("utf8")}catch(P){d=m.toString("ascii")}throw d.length>0&&(d=`. stderr output:
`+d),new Error(`command exited with status ${s}${d}`)}const u=o.buffer();return e?u.toString(e):u})}wait(e,t){return e===void 0||e<=0?this.promise:this._waitTimeout(e,(r,n,o)=>(f.debug(()=>`${this} wait timeout reached; killing process`),r.message="Cmd.wait timeout",this.kill(t).then(()=>o(r))))}signal(e,t){const r=this._checkproc();if(t=="group")try{return process.kill(-r.pid,e),!0}catch(n){}return r.kill(e)}async kill(e="SIGTERM",t=500,r){const n=this._checkproc();return this.signal(e,r||"group")?t<=0?this.promise:this._waitTimeout(t,(o,a)=>(f.debug(()=>`${this} kill timeout reached; sending SIGKILL`),n.kill("SIGKILL"),this.promise.then(a))):n.exitCode||0}toString(){return this.process?`Cmd[${this.pid}]`:"Cmd"}_checkproc(){if(!this.process)throw new Error(Ht);return this.process}_rejectAndKill(e){this._reject(e)}_waitTimeout(e,t){return new Promise((r,n)=>{let o=!1;return this.promise.then(a=>{o||r(a)}),Ut(this.promise,e,a=>{o=!0,t(a,r,n)})})}}it.prototype.start=function(){const t=this;if(t.running)throw new Error("start() called while command is running");t.exitCode=-1,t.promise=new Promise((s,u)=>{t._resolve=s,t._reject=u});let r=null,n=null;t.stdin instanceof Buffer?r="pipe":Dt(t.stdin)?typeof t.stdin.stream.fd=="string"?r=t.stdin.stream:(r="pipe",n=t.stdin.stream):r=t.stdin;const o=Kt.spawn(t.command,t.args,{stdio:[r,t.stdout===process.stdout?1:t.stdout||"ignore",t.stderr===process.stderr?2:t.stderr?t.stderr:"ignore",...t.extraFiles],cwd:t.dir?xt(t.dir):void 0,env:t.env,shell:t.shell,windowsHide:t.windowsHide,detached:!0});if(o.pid===void 0){t.process=null,t.pid=0;const s=Wr(t);throw t._reject(s),s}if(t.running=!0,t.process=o,t.pid=o.pid,o.on("exit",t._onexit),o.on("error",t._reject),f.debug(()=>`${t} started (${U(t.command)})`),o.stdin)if(t.stdin instanceof Buffer){const s=new qt.PassThrough;s.end(t.stdin),s.pipe(o.stdin),o.stdin=null}else n&&(n.pipe(o.stdin),o.stdin=null);if(!o.stdin&&!o.stdout&&!o.stderr&&o.stdio.length<4)return null;const a={stdin:o.stdin?rt(o.stdin):null,stdout:o.stdout?Re(o.stdout):null,stderr:o.stderr?Re(o.stderr):null,extraFiles:o.stdio.slice(3).map(s=>Lt(s)?Re(s):Mt(s)?rt(s):null)};return a};function Wr(e){let t="",r="unspecified error";if(e.shell==!1){try{Q.accessSync(e.dir,Q.constants.R_OK|Q.constants.X_OK);const o=Q.statSync(e.command);(o.mode&Q.constants.S_IFREG)==0?t="EACCES":t="EIO"}catch(o){t=o.code||"ENOENT"}r=ot(t)||r}if(!t){try{Q.accessSync(e.dir,Q.constants.R_OK|Q.constants.X_OK),t="EIO"}catch(o){t=o.code||"ENOENT"}r=ot(t)||r,t&&(r=r+"; cmd.dir="+U(e.dir))}t||(t="UNKNOWN");const n=new Error(`failed to spawn process ${U(e.command)} (${t} ${r})`);return n.code=t,n}const st=E(require("fs")),Yt=E(require("os")),Jt=new Map;function Pe(e,t){const r=o=>st.writeSync(process.stderr.fd,o+`
`);let n=Jt.get(e);if(n)n.listeners.add(t);else{const o=new Set([t]),a=s=>{s=="SIGINT"&&st.writeSync(1,`
`);try{for(let u of o)u(s)}catch(u){r(`error in signal listener: ${u.stack||u}`)}process.exit(-(Yt.constants.signals[s]||1))};process.on(e,a),Jt.set(e,{rootListener:a,listeners:o})}}const Vt=E(require("path")),Xt=E(require("fs"));let Zt=!1,Qt=!1,Ae=new Set;function Gr(){if(Zt)return;Zt=!0,process.on("beforeExit",t=>at(!1)),process.on("exit",t=>at(!1));const e=t=>at(!1);Pe("SIGINT",e),Pe("SIGHUP",e),Pe("SIGTERM",e),Pe("SIGPIPE",e)}function at(e){if(Qt)return;Qt=!0;const t=r=>Xt.writeSync(process.stderr.fd,r+`
`);try{if(!1)for(let n of Ae);for(let r of Ae)if(r.cmd.running)try{r.cmd.signal("SIGTERM")}catch(n){}Ae.clear()}catch(r){t(`ignoring error in run.atexit: ${r.stack||r}`)}}function er(e){if(!e.run)return;f.debug(()=>`run.configure run=${U(e.run)}`);const t=new Ur(e);Ae.add(t);const r=e.onEnd;e.onEnd=async(n,o,a)=>{if(await t.onEndBuild(o),typeof r=="function")return r(n,o,a)},Gr()}function tr(){return Promise.all(Array.from(Ae).map(e=>e.cmd.promise)).then(e=>e.reduce((t,r)=>Math.max(t,r),0))}class Ur{constructor(e){this._logOnExit=!0;if(this.config=e,this.cmd=new it(""),this.cmd.stdout="inherit",this.cmd.stderr="inherit",this.cmd.env.ESTRELLA_PATH=__filename,this.cmd.env.ESTRELLA_VERSION="1.2.6",typeof e.run=="string")this.cmd.command=e.run,this.cmd.shell=!0,this.cmdname=e.run;else if(typeof e.run=="boolean"){if(!e.outfile)throw new fe("please set config.outfile=<file> or config.run=<file>");this.cmd.command=process.execPath,this.cmd.args=[Vt.resolve(e.outfile)],this.cmdname=e.outfile}else{if(!e.run||e.run.length==0)throw new fe("config.run is an empty list");this.cmd.command=e.run[0],this.cmd.args=e.run.slice(1),this.cmdname=e.run.join(" "),this.cmdname.length>60&&(this.cmdname=this.cmdname.substr(0,57)+"...")}}async onEndBuild(e){if(e.errors.length>0)return;const t=this.cmd,r=M.pink,n=t.running;t.running&&(this._logOnExit=!1,f.debug(()=>`Stopping ${this.cmdname} [${t.pid}] ...`),await t.kill()),f.debug(()=>`Starting command ${U([t.command,...t.args])}`);let{stdout:o}=t.start();this.config.watch&&(f.info(()=>r(`${n?"Restarted":"Running"} ${this.cmdname} [${t.pid}]`)),this._logOnExit=!0,t.promise.then(a=>{this._logOnExit&&f.info(()=>r(`${this.cmdname} exited (${a})`))}))}}function rr(e){let t=e;if(!t){f.debug("typescript API requested; attempting to load typescript module");try{const b=require;if(t=b("typescript"),parseFloat(t.versionMajorMinor)<3.5)return f.warn(`typescript ${t.version} is too old; disabling "ts" API.
  You are seeing this message because you are importing the ts API.
  Either install a more recent version of typescript or remove the ts import.`),null;f.debug(()=>`loaded typescript ${t.version} from ${le(b.resolve("typescript"))}`)}catch(b){return f.debug(()=>"failed to load typescript; module unavailable"),null}}const r=new Map;function n(b){const x=L(Object.keys(b).sort().map(k=>[k,b[k]])),C=r.get(x);if(C)return f.debug("ts.getCompilerHost cache hit"),C;b={newLine:t.NewLineKind.LineFeed,...b};const F=t.createCompilerHost(b,!0),B=[F,b];return r.set(x,B),f.debug("ts.getCompilerHost cache miss"),B}async function o(b,x){const C=typeof b=="string"?{"/<source>/a.ts":b}:b,F=Object.keys(C),[B,k]=n(x||{}),i=B.readFile;B.readFile=l=>l in C?C[l]:i(l);const c=t.createProgram(F,k,B);if(typeof b=="string")return c.getSourceFile(F[0]);const y={};for(let l of F)y[l]=c.getSourceFile(l);return y}async function a(b,x){return s(b,x)}function s(b,x){const[C,F]=n(x||{}),B=t.createProgram([b],F,C),k=B.getSourceFile(b);if(!k)throw new Error(`${b}: file not found`);return k}function u(b,x,C){return d(b,[x],C).then(F=>F[0])}async function d(b,x,C){const F=s(b,C);return m(F,x)}function m(b,x){const C=$(b),F=new Map,B=[];for(let k of x||C.keys()){const i=C.get(k);if(!i){B.push(null);continue}B.push(P(b,i,C,F))}return B}function P(b,x,C,F){const B=F.get(x);if(B)return B;const k={heritage:[],name:x.name.escapedText,props:{},computedProps(){const i={};for(let c of k.heritage)Object.assign(i,c.props);return Object.assign(i,k.props),i},lookupProp(i){let c=k.props[i];if(!c){for(let y of k.heritage)if(c=y.lookupProp(i))break}return c}};if(F.set(x,k),x.heritageClauses)for(let i of x.heritageClauses)for(let c of i.types){const y=c.expression;if(t.isIdentifier(y)){const l=C.get(y.escapedText);l&&k.heritage.push(P(b,l,C,F))}}return x.forEachChild(i=>{if(t.isPropertySignature(i)){const c=I(i,b,k);k.props[c.name]=c}}),k}function I(b,x,C){const F=t.getLineAndCharacterOfPosition(x,b.pos);let B=null;const k=b.type,i=v(b.name),c={name:i,type:k,get typestr(){return B===null&&(B=k?A(k,x):"any"),Object.defineProperty(c,"typestr",{enumerable:!0,value:B}),B},srcfile:x.fileName,srcline:F.line,srccol:F.character,parent:C};return c}function v(b){switch(b.kind){case t.SyntaxKind.Identifier:case t.SyntaxKind.PrivateIdentifier:return b.escapedText;case t.SyntaxKind.StringLiteral:case t.SyntaxKind.NumericLiteral:return b.text;case t.SyntaxKind.ComputedPropertyName:return"[computed]";default:return"?"}}function $(b){const x=new Map;return t.forEachChild(b,C=>{C.kind==t.SyntaxKind.InterfaceDeclaration&&x.set(C.name.escapedText,C)}),x}const G=t.createPrinter({removeComments:!0,newLine:t.NewLineKind.LineFeed,omitTrailingSemicolon:!0,noEmitHelpers:!0});function A(b,x){if(!x){let C=b;for(;C.kind!=t.SyntaxKind.SourceFile;)if(C=C.parent,!C)throw new Error("node without SourceFile parent (provide file to ts.fmt)");x=C}return G.printNode(t.EmitHint.Unspecified,b,x)}return{ts:t,getCompilerHost:n,parse:o,parseFile:a,interfaceInfo:u,interfacesInfo:d,interfacesInfoAST:m,fmt:A}}const oe=E(require("fs")),nr=String.fromCharCode,zr=(e,t)=>e.charCodeAt(t||0);function or(e,t){if(typeof t=="number")return oe.chmodSync(e,t),t;let r=oe.statSync(e).mode,n=$e(r,t);return r!=n&&oe.chmodSync(e,n),n}function ir(e,t){return new Promise((r,n)=>{if(typeof t=="number")return oe.chmod(e,t,o=>{o?n(o):r(t)});oe.stat(e,(o,a)=>{if(o)return n(o);let s=$e(a.mode,t);if(a.mode==s)return r(s);oe.chmod(e,s,u=>{u?n(u):r(s)})})})}function $e(e,t){const r="Expected format: [ugoa]*[+-=][rwx]+",n=(a,s)=>new Error(`${a} in modifier ${L(s)}. ${r}`);let o=[];for(let a of Array.isArray(t)?t:[t])o=o.concat(a.trim().split(/\s*,+\s*/));for(let a of o){let s=[],u=!1,d=0,m=0;for(let I=0;I<a.length;I++){let v=zr(a,I);if(d==0)switch(v){case 117:case 103:case 111:u||s.push(v);break;case 97:s=[117,103,111],u=!0;break;case 43:case 45:case 61:d=v;break;default:if(d==0)throw n(`Invalid target or operation ${L(nr(v))}`,a);break}else switch(v){case 114:m|=4;break;case 119:m|=2;break;case 120:m|=1;break;default:throw n(`Invalid permission ${L(nr(v))}`,a)}}if(d==0)throw n("Missing operation",a);s.length==0&&(s=[117]),m==0&&(m=4|2|1);let P=0;for(let I of s)switch(I){case 117:P|=m<<6;break;case 103:P|=m<<3;break;case 111:P|=m;break}switch(d){case 43:e|=P;break;case 45:e&=~P;break;case 61:e=P;break}}return e}const q=E(require("fs")),J=E(require("path")),sr=E(require("crypto")),ee=q.promises,Kr={};function Ne(e){Kr[J.resolve(String(e))]=ae()}function z(e,t){return ee.readFile(e,t)}z.editMode=$e;z.chmod=(e,t)=>(Ne(e),ir(e,t));function qr(e,t){return ee.readFile(e,t)}z.read=qr;function Hr(e,t){return q.readFileSync(e,t)}z.readSync=Hr;z.stat=ee.stat;function Yr(...e){return Promise.all(e.map(t=>ee.stat(t).then(r=>r.mtimeMs).catch(r=>null))).then(t=>t.length==1?t[0]:t)}z.mtime=Yr;z.readall=(...e)=>Promise.all(e.map(t=>ee.readFile(t)));z.readallText=(e,...t)=>Promise.all(t.map(r=>ee.readFile(r,{encoding:e||"utf8"})));z.write=async(e,t,r)=>{Ne(e);const n=r&&typeof r=="object"?r:{};try{await ee.writeFile(e,t,r)}catch(o){if(!n.mkdirOff&&o.code=="ENOENT")await z.mkdirs(J.dirname(String(e)),n.mkdirMode),await ee.writeFile(e,t,r);else throw o}if(n.log){let o=J.relative(process.cwd(),String(e));o.startsWith(".."+J.sep)&&(o=le(e)),f.info(M.green(`Wrote ${o}`))}};z.writeSync=(e,t,r)=>{q.writeFileSync(e,t,r)};function Jr(e,t){return new Promise((r,n)=>{const o=q.createReadStream(e),a=sr.createHash("sha1");o.on("error",n),o.on("end",()=>{a.end(),r(t?a.digest(t):a.digest())}),o.pipe(a)})}z.sha1=Jr;z.copy=(e,t,r)=>{let n=q.constants.COPYFILE_FICLONE;return r&&(n|=q.constants.COPYFILE_EXCL),Ne(t),ee.copyFile(e,t,n)};z.move=(e,t)=>(Ne(t),ee.rename(e,t));z.mkdirs=(e,t)=>ee.mkdir(e,{recursive:!0,mode:t}).then(r=>!!r&&r.length>0);async function ar(e,t,r){if(r||(r={}),!q.promises||!q.promises.opendir)throw new Error("scandir not implemented for nodejs <12.12.0");const n=[],o=new Set,a=r.recursive!==void 0?r.recursive?Infinity:0:r.depth!==void 0?r.depth:Infinity;async function s(d,m,P){if(o.has(d))return;o.add(d);const I=await q.promises.opendir(d);for await(const v of I){let $=v.name;v.isDirectory()?a<P&&await s(J.join(d,$),J.join(m,$),P+1):(v.isFile()||v.isSymbolicLink())&&(t&&t.test($)&&n.push(J.join(m,$)))}}const u=Array.isArray(e)?e:[e];return Promise.all(u.map(d=>s(J.resolve(d),".",0))).then(()=>n.sort())}const lr={version:"0.7.7",BuildOptions:new Set(["sourcemap","format","globalName","target","strict","minify","minifyWhitespace","minifyIdentifiers","minifySyntax","jsxFactory","jsxFragment","define","pure","color","logLevel","errorLimit","bundle","splitting","outfile","metafile","outdir","platform","external","loader","resolveExtensions","mainFields","write","tsconfig","outExtension","entryPoints","stdin"])},ur={BuildConfig:new Set(["entry","debug","watch","cwd","quiet","clear","tslint","onStart","onEnd","outfileMode","run","tsc","tsrules","title"])};const cr=E(require("crypto"));function Le(e,t){const r=cr.createHash("sha1").update(e);return t?r.digest(t):r.digest()}const Me=E(require("path"));function dr(e,t){let r=e.cwd||"?",n=!1,o=!1,a=!1;function s(d){const m=[d.cwd,d.outfile||"",...Array.isArray(d.entryPoints)?d.entryPoints:d.entryPoints?[d.entryPoints]:[]].join(Me.delimiter);return Vr(Le(Buffer.from(m,"utf8")))}const u=Object.create({get projectID(){return r},updateProjectID(){return r=s(u),r},get buildIsCancelled(){return n},set buildIsCancelled(d){n=d},get outfileIsTemporary(){return o},set outfileIsTemporary(d){o=d},get metafileIsTemporary(){return a},set metafileIsTemporary(d){a=d}});return Object.assign(u,e),u.cwd=u.cwd?Me.resolve(u.cwd):t,u}function Vr(e){let t="";for(let r=0;r<e.length;r+=4)t+=e.readUInt32LE(r).toString(36);return t}const fr=E(require("esbuild")),ie=E(require("fs")),_o=E(require("os")),D=E(require("path")),pe=E(ft()),{dirname:lt,basename:pr}=D,ye={usage:"usage: $0 [options]",flags:[["-w, watch","Watch source files for changes and rebuild."],["-g, debug","Do not optimize and define DEBUG=true."],["-r, run","Run the output file after a successful build."],["-sourcemap","Generate sourcemap."],["-inline-sourcemap","Generate inline sourcemap."],["-no-color","Disable use of colors."],["-no-clear","Disable clearing of the screen, regardless of TTY status."],["-no-diag","Disable TypeScript diagnostics."],["-color","Color terminal output, regardless of TTY status."],["-diag","Only run TypeScript diagnostics (no esbuild.)"],["-quiet","Only log warnings and errors but nothing else."],["-estrella-version","Print version of estrella and exit 0."],["-estrella-debug","Enable debug logging of estrella itself."]]},Xr={usage:"usage: $0 [options] <srcfile> ...",flags:ye.flags.concat([["-o, outfile","Write output to <file> instead of stdout.","<file>"],["-bundle","Include all dependencies."],["-minify","Simplify and compress generated code."],["-outdir","Write output to <dir> instead of stdout.","<dir>"],["-esbuild","Pass arbitrary JSON to esbuild's build function.","<json>"]]),trailer:`
Example of using estrella without a build script:
  $0 -o out/app.js main.ts
    This compile main.ts and writes the output to out/app.js

Example of using estrella with a build script:
  1. Create a file called build.js with the following contents:
       #!/usr/bin/env node
       const { build } = require("estrella")
       build({
         entry: "main.ts",
         outfile: "out/main.js",
       })
  2. Make that file executable and run it:
       chmod +x build.js
       ./build.js
  You can now customize your build behavior by changing build.js.
  Try ./build.js -help

See https://github.com/rsms/estrella#readme for documentation.
  `};let ut=Promise.resolve(),W={},Z=[];const De=Symbol("IS_MAIN_CALL");let mr=!1;function gr(e){if(!mr){mr=!0;let t=e||1;process.exitCode=t,process.on("exit",r=>{process.exit(r||t)})}}function Zr(e){if(f.debug(()=>`input config ${U(e)}`),e.entryPoints||(e.entryPoints=[]),e.entry&&(Array.isArray(e.entry)?e.entryPoints=e.entryPoints.concat(e.entry):e.entryPoints.push(e.entry)),delete e.entry,e.entryPoints.length==0&&(f.debug(()=>"missing entryPoints; attempting inference"),e.entryPoints=hr(e),e.entryPoints.length==0)){let t=xe(e)?" (could not guess from tsconfig.json)":"";throw new fe(`config.entryPoints is empty or not set${t}`)}e.sourcemap?e.sourcemap!="inline"&&e.sourcemap!="external"&&(e.sourcemap=!0):e.sourcemap=!1,e.updateProjectID(),f.debug(()=>`effective config for project#${e.projectID}: ${U(e)}`)}function Qr(e,t){const r=ae(),n=JSON.parse(ie.readFileSync(e));for(let o in t){const a=t[o];a===void 0?delete n[o]:n[o]=a}ie.writeFileSync(e,JSON.stringify(n)),f.debug(()=>`patched source map ${e} with overrides ${U(t)} (${_e(ae()-r)})`)}function hr(e){const t=xe(e);if(t){if(f.debug(()=>`tsconfig file found at ${be(e)}`),t.files)return t.files;if(t.include){let r=[];for(let n of t.include)f.debug(`guessing entry points: glob.glob(${n}) =>`,pe.glob(n)),r=r.concat(pe.glob(n));if(t.exclude)for(let n of t.exclude)r=r.filter(o=>!pe.match(n,o));return r.slice(0,1)}}return[]}function en(e){let t={},r={};const n={name:"globalName"};for(let o of Object.keys(e)){if(ur.BuildConfig.has(o))continue;lr.BuildOptions.has(o)||(r[o]=e[o]),o=n[o]||o,t[o]=e[o]}return Object.keys(r).length>0&&f.info(`Notice: Potentially invalid esbuild.BuildOption(s): ${U(r)}
`+Tt("guess",L(Object.keys(r)))),t}let br=new Set;function tn(...e){if(f.level>=f.INFO){const t=e.join(" ");br.has(t)||(br.add(t),f.info(...e))}}function yr(e){e=dr(e||{},e[De]?process.cwd():process.mainModule&&lt(process.mainModule.filename)||__dirname);const t={resolve(){},reject(){}},r=[];function n(u){e.isCancelled?u():r.push(u)}function o(u){if(!e.isCancelled){f.debug("build cancelled",{reason:u}),e.isCancelled=!0;for(let d of r)d&&d();r.length=0,u?t.reject(u):t.resolve()}}let a={addCancelCallback:n,buildCounter:0,rebuild(){return f.warn("rebuild() called before initial build completed. Ignoring"),Promise.resolve(!0)}};const s=ut.then(()=>new Promise((u,d)=>{if(e.isCancelled)return f.debug("build cancelled immediately"),!1;t.resolve=u,t.reject=d,rn(e,a).then(u).catch(d)}));return s.rebuild=()=>a.rebuild(),Object.defineProperty(s,"buildCounter",{get(){return a.buildCounter}}),s.cancel=o,s}async function rn(e,t){const r=De in e;delete e[De];let n=W,o=Z;if(e.run===void 0&&(e.run=n.run),!r)Zr(e);else{if(o.length==0){const l=hr(e);f.debug(()=>`no input files provided; best guess: ${U(l)}`),l.length==0&&(f.error(`missing <srcfile> argument (see ${X} -help)`),process.exit(1)),o.splice(o.length-1,0,...l);const p=xe(e);!n.outfile&&!n.outdir&&p&&(n.outfile=p.outFile,n.outfile||(n.outdir=p.outDir)),o.length==0&&(f.error(`missing <srcfile> argument (see ${X} -help)`),process.exit(1))}if(n.outfile=="-"||!n.outfile&&!n.outdir){n.outfile="-";const l=e.updateProjectID();n.outfile=D.join(Ie(),`esbuild.${l}.out.js`),e.outfileIsTemporary=!0}if(e.entryPoints=o,e.outfile=n.outfile||void 0,e.outdir=n.outdir||void 0,e.bundle=n.bundle||void 0,e.minify=n.minify||void 0,n.esbuild){const l=Ke(n.esbuild,"-esbuild");if(!l||typeof l!="object")return f.error(`-esbuild needs a JS object, for example '{key:"value"}'. Got ${typeof l}.`),!1;f.debug(()=>`applying custom esbuild config ${U(l)}`);for(let p in l)e[p]=l[p]}}const a=e.debug=n.debug=!!(n.debug||e.debug),s=e.quiet=n.quiet=!!(n.quiet||e.quiet);n.watch=!!(n.watch||e.watch),(!e.watch||typeof e.watch!="object")&&(e.watch=n.watch),e.color!==void 0&&(f.colorMode=e.color,M.reconfigure(process.stdout,e.color),se.reconfigure(process.stderr,e.color)),s&&(f.level=f.WARN),e.sourcemap=n["inline-sourcemap"]?"inline":n.sourcemap?!0:e.sourcemap,e.clear=n["no-clear"]?!1:e.clear===void 0?!!process.stdout.isTTY:e.clear,f.debug(()=>`project directory ${U(e.cwd)} (config.cwd)`),e.title||(e.title=e.name||le(e.cwd));let u=n.diag===!0?"on":n.diag===!1?"off":"auto";if(u!=="off"){e.tsc!==void 0&&(f.info("the 'tsc' property is deprecated. Please rename to 'tslint'."),e.tslint===void 0&&(e.tslint=e.tsc)),e.tslint&&e.tslint!=="auto"&&(u=e.tslint);const l=u==="auto"||typeof u=="object"&&(e.tslint.mode==="auto"||!e.tslint.mode);l?be(e)||(f.debug(()=>{const p=Ze(e),h=Array.from(Ve(p,e.cwd));return`skipping tslint in auto mode since no tsconfig.json file was found in project.
Tried the following filenames:${h.map(g=>`
  ${le(g)}`)}`}),u="off"):e.tslint!==void 0&&e.tslint!=="auto"&&(u=e.tslint)}e.run&&er(e);let d=0;function m(){ne.clear(),d=ae()}let P=!1;const I=e.onEnd;let v=I?async(l,p)=>{P=!0;let h;try{const T=I(e,l,t);h=T instanceof Promise?await T:T}catch(T){throw f.debug(()=>`error in onEnd handler: ${T.stack||T}`),T}finally{P=!1}const g=h===void 0?p:!!h;return g}:(l,p)=>p;function $(l){let p=v;v=async(h,g)=>{const T=await l(h,g);return T!==void 0&&(g=T),p(h,g)}}e.outfileMode&&e.outfile&&$(async(l,p)=>{if(l.errors.length==0)try{or(e.outfile,e.outfileMode)}catch(h){f.error("configuration error: outfileMode: "+h.message),gr(1)}}),e.outfileIsTemporary&&!e.run&&$(async(l,p)=>{if(l.errors.length==0)return new Promise((h,g)=>{const T=ie.createReadStream(e.outfile);T.on("end",()=>h(p)),T.on("error",g),T.pipe(process.stdout)})}),e.watch&&$(async(l,p)=>{tn("Watching files for changes...")});let G={DEBUG:a,...e.define||{}};for(let l in G)G[l]=L(G[l]);const A={minify:!a,sourcemap:e.sourcemap,color:se.ncolors>0,...en(e),define:G};if(e.watch){const l=e.projectID;if(!A.outfile&&!A.outdir||A.write===!1)A.outfile=D.join(Ie(),`esbuild.${l}.out.js`),A.metafile=D.join(Ie(),`esbuild.${l}.meta.json`),e.outfileIsTemporary=!0,e.metafileIsTemporary=!0,delete A.write;else if(!A.metafile){const p=A.outdir||D.dirname(A.outfile);A.metafile=D.join(p,`.esbuild.${l}.meta.json`),e.metafileIsTemporary=!0}}A.metafile&&f.debug(()=>`writing esbuild meta to ${A.metafile}`),t.rebuild=()=>F([]).then(l=>(P&&f.warn("waiting for rebuild() inside onEnd handler may cause a deadlock"),l));let b={warnings:[],errors:[]};function x(l,{warnings:p}){wr(p||[]);const h=e.outfile,g=_e(ae()-l);if(!h)f.info(M.green(e.outdir?`Wrote to dir ${e.outdir} (${g})`:`Finished (write=false, ${g})`));else{let T=h;if(e.sourcemap&&e.sourcemap!="inline"){const j=D.extname(h),R=D.join(D.dirname(h),D.basename(h,j));T=`${R}.{${j.substr(1)},${j.substr(1)}.map}`,Qr(D.resolve(e.cwd,e.outfile+".map"),{sourcesContent:void 0,sourceRoot:D.relative(D.dirname(e.outfile),e.cwd)})}let N=0;try{N=ie.statSync(h).size}catch(j){}e.outfileIsTemporary||f.info(M.green(`Wrote ${T}`)+` (${wt(N)}, ${g})`)}return b={warnings:p,errors:[]},v(b,!0)}function C(l,p,h){let g=p.warnings||[],T=p.errors||[],N=h&&h.showStackTrace;return T.length==0&&T.push({text:String(N&&p.stack?p.stack:p),location:null}),wr(g),b={warnings:g,errors:T},v(b,!1)}async function F(l){if(e.watch&&e.clear&&m(),e.onStart)try{const g=e.onStart(e,l,t);g instanceof Promise&&await g}catch(g){throw f.debug(()=>`error in onStart handler: ${g.stack||g}`),g}if(e.isCancelled)return;f.debug(()=>`invoking esbuild.build() in ${process.cwd()} with options: ${U(A)}`);const p=process.cwd();process.chdir(e.cwd);const h=fr.build(A);return process.chdir(p),h.then(x.bind(null,ae()),C.bind(null,ae()))}const B=n.diag?null:F([]),[k,i]=u!=="off"?nn(u,n,e):[null,!1];k&&!i&&(k.catch(l=>(f.error(l.stack||String(l)),!1)),t.addCancelCallback(()=>{k.cancel()}),W.diag&&e.watch&&e.clear&&ne.clear());let c=!0;if(B&&(f.debug("awaiting esbuild"),c=await B,e.isCancelled))return!1;if(e.watch){let l={};function y(){try{l=Fe(A.metafile),e.metafileIsTemporary&&(f.debug(()=>`removing temporary esbuild metafile ${A.metafile}`),ie.unlink(A.metafile,()=>{}))}catch(p){if(b.errors.length==0)throw p}return l}return await Je().watchFiles(e,y,t,p=>{const h=p.map(T=>D.relative(e.cwd,T)),g=p.length;return f.info(`${g} ${g>1?"files":"file"} changed: ${h.join(", ")}`),F(p)}),f.debug("fswatch ended"),!0}if(k){let l=null;c?(f.debug("awaiting eslint"),!i&&!n.diag&&(l=setTimeout(()=>f.info("Waiting for TypeScript... (^C to skip)"),1e3)),c=await k.catch(()=>!1)):(f.debug("cancelling eslint since esbuild reported an error"),k.cancel()),clearTimeout(l)}if(!e.isCancelled&&!c&&gr(),c){const l=await tr();process.exitCode=l}return c}const xr=new Map;function nn(e,t,r){let n=e,o={};if(e&&typeof e=="object"&&(n=void 0,o=e,o.mode=="off"))return f.debug(()=>'tslint disabled by tslint config {mode:"off"}'),[null,!1];r.tsrules&&r.tsrules.length&&(f.info("The 'tsrules' property is deprecated. Please use 'tslint.rules' instead"),o.rules={...r.tsrules,...o.rules});const a=t.diag&&r.watch&&r.clear,s=be(r),u=`${s||r.cwd}`,d=xr.get(u);if(d)return f.debug(()=>"tslint sharing process (no new process created)"),[d,!0];const m={colors:M.ncolors>0,quiet:r.quiet,mode:n,...o,watch:r.watch,cwd:r.cwd,clearScreen:a,srcdir:lt(r.entryPoints[0]),tsconfigFile:s,onRestart(){f.debug("tsc restarting")}};f.debug(()=>`starting tslint with options ${U(m)}`);const P=et(m);return xr.set(u,P),[P,!1]}function wr(e){e.length>0&&f.warn("[warn] "+e.map(t=>t.text).join(`
`))}function on(){return yr({[De]:1}).catch(e=>{console.error(se.red(X+": "+(e?e.stack||e:"error")));const t=process.exitCode||0;process.exit(t>0?t:1)}).then(e=>{const t=process.exitCode||0;process.exit(e||t>0?t:1)})}function Sr(){W["no-color"]&&(W.color=!1),W["no-diag"]&&(W.diag=!1),f.colorMode=W.color,M.reconfigure(process.stdout,W.color),se.reconfigure(process.stderr,W.color),W.color!==void 0,W["estrella-version"]&&(console.log("estrella 1.2.6"),process.exit(0)),W["estrella-debug"]&&(f.level=f.DEBUG),W.diag&&W.run&&(f.info("Disabling -run since -diag is set"),W.run=void 0),f.debug(()=>`Parsed initial CLI arguments: ${U({options:W,args:Z},2)}`)}module.id=="."||process.mainModule&&pr(process.mainModule.filename||"")=="estrella.js"?([W,Z]=Be(process.argv.slice(2),Xr),Sr(),on()):([W,Z]=Be(process.argv.slice(2),{...ye,unknownFlagAsArg:!0,help(e,t,r){ut=new Promise(n=>{process.nextTick(()=>{console.log(He(e,ye.usage,ye.trailer)),process.exit(0),n()})})}}),Sr(),Z.length>0&&ut.then(()=>{Z.length>0&&qe(Z)}),W.parse=(...e)=>{f.debug(()=>`Parsing custom CLI arguments ${L(Z.join)} via cliopts.parse(`+U(e)+")");const t=Be(Z,{...ye,flags:ye.flags.concat(e)});return f.debug(()=>"Parsed extra CLI arguments: "+L({options:t[0],args:t[1]},2)),Z.splice(0,Z.length),t});function Pr(e,t,r){return Je().watch(e,t,r)}function sn(e,t,r,n){return f.info(()=>"estrella.watchdir is deprecated. Please use estrella.watch instead"),n===void 0&&(r===void 0?(n=t,r={}):(n=r,r={...r,filter:t},r.recursive!==void 0&&(r.recursive||(r.depth=0),delete r.recursive))),Pr(e,r,n)}let ct;module.exports={version:"1.2.6",prog:X,cliopts:W,cliargs:Z,dirname:lt,basename:pr,watch:Pr,watchdir:sn,scandir:ar,tslint:et,defaultTSRules:Qe,termStyle:Ee,stdoutStyle:M,stderrStyle:se,chmod:z.chmod,editFileMode:z.editMode,fmtDuration:_e,tildePath:le,findInPATH:Oe,tsconfig:xe,tsconfigFile:be,glob:pe.glob,globmatch:pe.match,file:z,sha1:Le,log:f,get ts(){return ct===void 0&&(ct=rr()),ct},build:yr};
//# sourceMappingURL=estrella.js.map
